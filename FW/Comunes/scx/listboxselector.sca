SCCTEXT Version 4.0.0.2
PLATFORM C(8,0),UNIQUEID C(10,0),TIMESTAMP N(10,0),CLASS M(4,0),CLASSLOC M(4,0),BASECLASS M(4,0),OBJNAME M(4,0),PARENT M(4,0),PROPERTIES M(4,0),PROTECTED M(4,0),METHODS M(4,0),OBJCODE M(4,0),OLE M(4,0),OLE2 M(4,0),RESERVED1 M(4,0),RESERVED2 M(4,0),RESERVED3 M(4,0),RESERVED4 M(4,0),RESERVED5 M(4,0),RESERVED6 M(4,0),RESERVED7 M(4,0),RESERVED8 M(4,0),USER M(4,0)
1252

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] Screen    
[START RESERVED1]
VERSION =   3.00[END RESERVED1]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2SX0TWJXS
[CLASS] dataenvironment
[BASECLASS] dataenvironment
[OBJNAME] Dataenvironment
[START PROPERTIES]
Top = 0
Left = 0
Width = 0
Height = 0
DataSource = .NULL.
Name = "Dataenvironment"
[END PROPERTIES]
[START RESERVED2]
1[END RESERVED2]
[START RESERVED4]
1[END RESERVED4]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2SX0TWJXT
[CLASS] form
[BASECLASS] form
[OBJNAME] ListBox_Selector
[START PROPERTIES]
BorderStyle = 2
Top = 0
Left = 0
Height = 360
Width = 204
ShowWindow = 1
DoCreate = .T.
Caption = "Seleccione Una Opcion"
ControlBox = .F.
Closable = .F.
FontBold = .F.
FontItalic = .F.
FontName = "Arial"
FontSize = 9
MaxButton = .F.
MinButton = .F.
MinHeight = 120
MinWidth = 120
KeyPreview = .T.
TitleBar = 0
WindowType = 1
AlwaysOnTop = .T.
nitem = 0
_memberdata =      653<VFPData><memberdata name="nitem" display="nItem"/><memberdata name="ocolitems" display="oColItems"/><memberdata name="aitems" display="aItems"/><memberdata name="fontname" display="FontName"/><memberdata name="fontname_assign" display="FontName_Assign"/><memberdata name="fontsize" display="FontSize"/><memberdata name="fontsize_assign" display="FontSize_Assign"/><memberdata name="fontbold" display="FontBold"/><memberdata name="fontbold_assign" display="FontBold_Assign"/><memberdata name="fontitalic" display="FontItalic"/><memberdata name="fontitalic_assign" display="FontItalic_Assign"/><memberdata name="nselected" display="nSelected"/></VFPData>
ocolitems = .NULL.
nselected = 0
Name = "ListBox_Selector"
[END PROPERTIES]
[START METHODS]
PROCEDURE Init
Lparameters oColItems As Collection

Local lnLen As Integer,;
	lnLengh As Integer,;
	lnWidth As Integer,;
	i As Integer,;
	lnOrder As Integer

Local loItem As Object
Local loLB As ListBox

Try

	* Validar colección
	If !Pemstatus( oColItems, "nTop", 5 )
		AddProperty( oColItems, "nTop", -1 )
	Endif

	If !Pemstatus( oColItems, "nLeft", 5 )
		AddProperty( oColItems, "nLeft", -1 )
	EndIf

	If !Pemstatus( oColItems, "nHeight", 5 )
		AddProperty( oColItems, "nHeight", -1 )
	EndIf

	If !Pemstatus( oColItems, "cCaption", 5 )
		AddProperty( oColItems, "cCaption", "" )
	Endif

	If !Pemstatus( oColItems, "lMultiSelect", 5 )
		AddProperty( oColItems, "lMultiSelect", .F. )
	Endif

	If !Pemstatus( oColItems, "lAutoCenter", 5 )
		AddProperty( oColItems, "lAutoCenter", ( oColItems.nTop = -1 Or oColItems.nLeft = -1 ) )
	Endif

	If !Pemstatus( oColItems, "nColumnCount", 5 )
		AddProperty( oColItems, "nColumnCount", 2 )
	Endif

	If !Pemstatus( oColItems, "lColumnLines", 5 )
		AddProperty( oColItems, "lColumnLines", .F. )
	Endif

	If !Pemstatus( oColItems, "cColumnWidths", 5 )
		AddProperty( oColItems, "cColumnWidths", "300, 000" )
	Endif

	If !Pemstatus( oColItems, "lBoundTo", 5 )
		AddProperty( oColItems, "lBoundTo", .T. )
	Endif

	If !Pemstatus( oColItems, "nBoundColumn", 5 )
		AddProperty( oColItems, "nBoundColumn", 2 )
	Endif

	If !Pemstatus( oColItems, "nWidth", 5 )
		AddProperty( oColItems, "nWidth", 300 )
	Endif

	If !Pemstatus( oColItems, "nHight", 5 )
		AddProperty( oColItems, "nHight", -1 )
	Endif

	If !Pemstatus( oColItems, "nSelected", 5 )
		AddProperty( oColItems, "nSelected", 1 )
	Endif

	Thisform.TitleBar = Iif( Empty( oColItems.cCaption ), 0, 1 )
	Thisform.Caption = oColItems.cCaption

	loLB = Thisform.lstItems
	loLB.BoundColumn 	= oColItems.nBoundColumn
	loLB.BoundTo 		= oColItems.lBoundTo
	loLB.ColumnCount 	= oColItems.nColumnCount
	loLB.RowSourceType 	= 0
	loLB.RowSource 		= ""
	loLB.Width 			= oColItems.nWidth
	loLB.ColumnLines 	= oColItems.lColumnLines
	loLB.ColumnWidths 	= oColItems.cColumnWidths
	loLB.MultiSelect 	= oColItems.lMultiSelect

	lnLen = oColItems.Count

	For i = 1 To lnLen
		loItem = oColItems.Item( i )

		If !Pemstatus( loItem, "cCaption", 5 )
			AddProperty( loItem, "cCaption", "\-" )
		Endif

		If !Pemstatus( loItem, "nId", 5 )
			AddProperty( loItem, "nId", i )
		Endif

		If !Pemstatus( loItem, "lVisible", 5 )
			AddProperty( loItem, "lVisible", .T. )
		Endif

		If !Pemstatus( loItem, "nOrder", 5 )
			AddProperty( loItem, "nOrder", i )
		Endif

		If !Pemstatus( loItem, "cPicture", 5 )
			AddProperty( loItem, "cPicture", "" )
		Endif


		loLB.AddItem( loItem.cCaption )

		If loItem.cCaption # "\-"
			For j = 2 To oColItems.nColumnCount
				If j = oColItems.nBoundColumn
					loLB.List[ loLB.NewIndex, j ] = Transform( loItem.nId )

				Else
					loLB.List[ loLB.NewIndex, j ] = Evaluate( "loItem.cCaption" + Transform( j ) )

				Endif

			Endfor


		Endif

		If !Empty( loItem.cPicture )
			loLB.Picture[ i ] = loItem.cPicture
		Endif

		loItem = Null


	Endfor

	loLB.Selected( oColItems.nSelected ) = .T.
	Thisform.Width = loLB.Width

	If oColItems.nHeight = -1
		loLB.Height = ( ( Min( lnLen, 20 ) + 1 ) * Fontmetric( 1, loLB.FontName, loLB.FontSize ) ) + Iif( Thisform.TitleBar = 1, 50, 30 )

	Else
		loLB.Height = oColItems.nHeight

	Endif

	Thisform.Height = loLB.Height

	If Thisform.TitleBar = 1
		Thisform.Width = Max( Thisform.Width, Max( Thisform.TextWidth( Replicate( "W", Len( Thisform.Caption ))), Thisform.lstItems.Width ))
	Endif

	loLB.Width = Thisform.Width
	loLB.Anchor = 15

	Thisform.oColItems = oColItems

	Thisform.AutoCenter = oColItems.lAutoCenter

	If !Thisform.AutoCenter
		Thisform.Top	= oColItems.nTop
		Thisform.Left 	= oColItems.nLeft
	Endif


Catch To oErr
	Local loError As Errorhandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"

	loError = Newobject( "Errorhandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Process( oErr )

Finally
	loLB = Null

Endtry


ENDPROC
PROCEDURE KeyPress
Lparameters nKeyCode, nShiftAltCtrl

#INCLUDE "FW\Comunes\Include\Praxis.h"

Do Case
	Case nKeyCode = KEY_ESCAPE
		Thisform.nItem = 0
		_Screen.oApp.nKeyCode = nKeyCode
		Thisform.Release()

	Case nKeyCode = KEY_ENTER
		
		If !Empty( Thisform.lstItems.ListItemId )
			Thisform.nItem = Thisform.lstItems.ListItemId
			
		Else
			Thisform.nItem = Thisform.nSelected
			
		EndIf

		If !Empty( Thisform.nSelected ) Or !Empty( Thisform.nItem )
			_Screen.oApp.nKeyCode = nKeyCode
			Thisform.Release()
		EndIf		

	Case nKeyCode = KEY_FLECHA_IZQUIERDA
		If !Empty( Thisform.lstItems.ListItemId )
			Thisform.nItem = Thisform.lstItems.ListItemId
			
		Else
			Thisform.nItem = Thisform.nSelected
			
		EndIf
		
		_Screen.oApp.nKeyCode = KEY_FLECHA_ARRIBA
		Thisform.Release()

	Otherwise

Endcase

ENDPROC
PROCEDURE Unload

Local lcCommand As String
Local lnItem As Integer,;
	i As Integer

Local loColItems As Collection
Local loItem As Object

Try

	lcCommand = ""
	lnItem = Thisform.nItem
	loColItems = Thisform.oColItems

	* RA 2013-08-05(10:54:33)
	* nItem trae el valor de loItem.Order
	* hay que devolver el subindice de la coleccion
	For i = 1 To loColItems.Count
		loItem = loColItems.Item( i )

		If loItem.nOrder = lnItem
			Thisform.nItem = loItem.nId
		Endif
	Endfor

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )

Finally


Endtry

Return This.nItem

ENDPROCPROCEDURE fontbold_assign
lparameters tFontBold
This.FontBold = tFontBold
ThisForm.lstItems.FontBold = tFontBold
ENDPROC
PROCEDURE fontitalic_assign
lparameters tFontItalic
This.FontItalic = tFontItalic
ThisForm.lstItems.FontItalic = tFontItalic
ENDPROC
PROCEDURE fontname_assign
lparameters tFontName
This.FontName = tFontName
ThisForm.lstItems.FontName = tFontName
ENDPROC
PROCEDURE fontsize_assign
lparameters tFontSize
This.FontSize = tFontSize
ThisForm.lstItems.FontSize = tFontSize
ENDPROC
[END METHODS]
[START RESERVED3]
nitem
_memberdata XML Metadata for customizable properties
ocolitems
nselected Valor inicial del ListBox
^aitems[1,1] 
*fontname_assign 
*fontsize_assign 
*fontbold_assign 
*fontitalic_assign 
[END RESERVED3]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2SX0WPVNP
[CLASS] listbox
[BASECLASS] listbox
[OBJNAME] lstItems
[PARENT] ListBox_Selector
[START PROPERTIES]
Anchor = 15
BoundColumn = 2
Height = 360
Left = 0
Top = 0
Width = 204
IntegralHeight = .T.
ItemTips = .T.
BoundTo = .T.
AutoHideScrollbar = 1
Name = "lstItems"
[END PROPERTIES]
[START METHODS]
PROCEDURE DblClick
Thisform.nItem = Thisform.lstItems.ListItemId
Thisform.Release()

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] RESERVED  
[START PROPERTIES]
Arial, 0, 9, 5, 15, 12, 32, 3, 0
[END PROPERTIES]
[START RESERVED1]
  ..\include\praxis.hVõÑ–3S ..\include\foxpro.h^öÊrûF ..\include\strings.hf÷ZŠOJ* ..\..\..\tools\namespaces\include\system.hnø±ÙF[END RESERVED1]
[EOF]
