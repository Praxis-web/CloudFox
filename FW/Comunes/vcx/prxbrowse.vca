SCCTEXT Version 4.0.0.2
PLATFORM C(8,0),UNIQUEID C(10,0),TIMESTAMP N(10,0),CLASS M(4,0),CLASSLOC M(4,0),BASECLASS M(4,0),OBJNAME M(4,0),PARENT M(4,0),PROPERTIES M(4,0),PROTECTED M(4,0),METHODS M(4,0),OBJCODE M(4,0),OLE M(4,0),OLE2 M(4,0),RESERVED1 M(4,0),RESERVED2 M(4,0),RESERVED3 M(4,0),RESERVED4 M(4,0),RESERVED5 M(4,0),RESERVED6 M(4,0),RESERVED7 M(4,0),RESERVED8 M(4,0),USER M(4,0)
1252

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] Class     
[START RESERVED1]
VERSION =   3.00[END RESERVED1]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SW11AE9O
[CLASS] form
[BASECLASS] form
[OBJNAME] browseform
[START PROPERTIES]
Height = 480
Width = 528
DoCreate = .T.
ShowTips = .T.
AutoCenter = .T.
Caption = "Tablas"
MaxButton = .F.
MinButton = .F.
MinWidth = 360
Enabled = .T.
KeyPreview = .T.
WindowType = 1
BindControls = .T.
_memberdata =     4141<VFPData><memberdata name="cancelar" display="Cancelar"/><memberdata name="armargrilla" display="ArmarGrilla"/><memberdata name="configurar" display="Configurar"/><memberdata name="cmaincursorname" display="cMainCursorName"/><memberdata name="cmaincursorname_access" display="cMainCursorName_Access"/><memberdata name="oparam" display="oParam"/><memberdata name="aceptar" display="Aceptar"/><memberdata name="crearcursordetrabajo" display="CrearCursorDeTrabajo"/><memberdata name="ccursordetrabajo" display="cCursorDeTrabajo"/><memberdata name="actualizarcursorprincipal" display="ActualizarCursorPrincipal"/><memberdata name="borrar" display="Borrar"/><memberdata name="agregar" display="Agregar"/><memberdata name="recuperar" display="Recuperar"/><memberdata name="synchronizebuttons" display="SynchronizeButtons"/><memberdata name="obiz" display="oBiz"/><memberdata name="obiz_access" display="oBiz_Access"/><memberdata name="lreleaseaftersave" display="lReleaseAfterSave"/><memberdata name="allowexit" display="AllowExit"/><memberdata name="oreturn" display="oReturn"/><memberdata name="ngap" display="nGap"/><memberdata name="lgridloaded" display="lGridLoaded"/><memberdata name="cargargrilla" display="CargarGrilla"/><memberdata name="editar" display="Editar"/><memberdata name="ledit" display="lEdit"/><memberdata name="ledit_assign" display="lEdit_Assign"/><memberdata name="updatetable" display="UpdateTable"/><memberdata name="reverttable" display="RevertTable"/><memberdata name="lusenamespaces" display="lUseNameSpaces"/><memberdata name="lusenamespaces_access" display="lUseNameSpaces_Access"/><memberdata name="nbufferingcursortrabajo" display="nBufferingCursorTrabajo"/><memberdata name="lexit" display="lExit"/><memberdata name="lexit_assign" display="lExit_Assign"/><memberdata name="vaciargrilla" display="VaciarGrilla"/><memberdata name="leditonload" display="lEditOnLoad"/><memberdata name="lhasfilters" display="lHasFilters"/><memberdata name="wclav" display="WCLAV"/><memberdata name="lingtip" display="lIngTip" favorites="True"/><memberdata name="lingtipactivo" display="lIngTipActivo" favorites="True"/><memberdata name="ningtip1" display="nIngTip1" favorites="True"/><memberdata name="ningtip2" display="nIngTip2" favorites="True"/><memberdata name="ningtipaction" display="nIngTipAction" favorites="True"/><memberdata name="ningtipstatus" display="nIngTipStatus" favorites="True"/><memberdata name="i_ingtip" display="I_IngTip"/><memberdata name="wclav_assign" display="WCLAV_Assign"/><memberdata name="lingtipactivo_assign" display="lIngTipActivo_Assign"/><memberdata name="loldlkeypreview" display="lOldlKeyPreview"/><memberdata name="inicializar" display="Inicializar"/><memberdata name="clave" display="CLAVE"/><memberdata name="oparametros" display="oParametros"/><memberdata name="lgridempty" display="lGridEmpty"/><memberdata name="autosize" display="Autosize"/><memberdata name="ofilters" display="oFilters"/><memberdata name="addfilter" display="AddFilter"/><memberdata name="removefilter" display="RemoveFilter"/><memberdata name="filtrar" display="Filtrar"/><memberdata name="afterbindcontrols" display="AfterBindControls"/><memberdata name="cerrar" display="Cerrar"/><memberdata name="initializecontrols" display="InitializeControls"/><memberdata name="on_ctrl_f10" display="On_Ctrl_F10"/><memberdata name="process" display="Process"/><memberdata name="bindcontrols" display="BindControls"/><memberdata name="bindcontrols_assign" display="BindControls_Assign"/><memberdata name="enabled" display="Enabled"/><memberdata name="enabled_assign" display="Enabled_Assign"/><memberdata name="ccursordetrabajo_access" display="cCursorDeTrabajo_Access"/><memberdata name="irpagina" display="IrPagina"/><memberdata name="lopenloaded" display="lOpenLoaded"/><memberdata name="ncolumna" display="nColumna"/><memberdata name="switcheditmode" display="SwitchEditMode"/><memberdata name="ctitulodelprograma" display="cTituloDelPrograma"/><memberdata name="oregistro" display="oRegistro"/><memberdata name="hookafterinit" display="HookAfterInit"/><memberdata name="ofilters_access" display="oFilters_Access"/></VFPData>
cmaincursorname = 
oparam = .NULL.
ccursordetrabajo = 
obiz = .NULL.
lreleaseaftersave = .F.
oreturn = .NULL.
ngap = 12
lgridloaded = .F.
ledit = .T.
lusenamespaces = .NULL.
nbufferingcursortrabajo = 5
lexit = .F.
leditonload = .F.
lhasfilters = .F.
wclav = A
lingtip = .F.
lingtipactivo = .F.
ningtip1 = -8
ningtip2 = -9
ningtipaction = 1
ningtipstatus = 0
loldlkeypreview = .F.
clave = 5
oparametros = .NULL.
lgridempty = .F.
ofilters = .NULL.
lopenloaded = .T.
ncolumna = 0
ctitulodelprograma = 
oregistro = .NULL.
Name = "browseform"
[END PROPERTIES]
[START METHODS]
PROCEDURE Destroy
Local lcCommand as String

Try

	lcCommand = ""
	
	Use in Select( This.cCursorDeTrabajo )
	Use in Select( This.cMainCursorName )
	
	If PemStatus( Thisform.oParam, "oBiz", 5 )
		Thisform.oParam.oBiz = Null
	EndIf
	Thisform.oParam = Null

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )

Finally
	
	
EndTry

ENDPROC
PROCEDURE Init
Lparameters oParam As Object

Local lcCommand As String
Local loReturn As Object,;
    loBiz As oModelo Of "FrontEnd\Prg\Modelo.prg",;
    loReg As Object
Local llOk As Boolean,;
    llAutocenter As Boolean

Local loControl As ControlNameSpace Of 'Tools\Namespaces\Prg\ControlNameSpace.prg'

Try

    lcCommand = ""
    llOk = .F.
    This.lExit = .T.
    Thisform.BorderStyle = 2

    loReturn = Createobject( "Empty" )
    AddProperty( loReturn, "Status", 0 )

    Thisform.oReturn 		= loReturn
    Thisform.oParam 		= oParam
    Thisform.Grid.oParam 	= oParam
    *!*	    loReg = CreateObject( "Empty" )
    *!*	    AddProperty( loReg, "ABM", 0 )
    Thisform.oRegistro = Createobject( "Empty" )
    AddProperty( Thisform.oRegistro, "ABM", 0 )

    loBiz = Thisform.oBiz
    loBiz.cTrace = Thisform.Name

    *!*	    Thisform.cntTitulo.lblTitulo.Caption = loBiz.cTituloEnGrilla
    *!*	    Thisform.cntTitulo.LblFecha.Caption = F_Today( FECHAHOY )
    Thisform.cTituloDelPrograma = loBiz.cTituloEnGrilla

    *!*	    loControl = Newobject( "ControlNameSpace", 'Tools\Namespaces\Prg\ControlNameSpace.prg' )
    *!*	    loControl.TextProperties( Thisform.cntTitulo.lblTitulo )
    *!*	    loControl.TextProperties( Thisform.cntTitulo.LblFecha )

    If Inlist( .T., loBiz.lCanCreate, loBiz.lCanDelete, loBiz.lCanUpdate )
        Thisform.Botones.Visible 			= .T.
        *ThisForm.chkEditarEnGrilla.Visible 	= .T.

        Thisform.Botones.CmdAgregar.Visible 	= loBiz.lCanCreate
        Thisform.Botones.CmdBorrar.Visible 		= loBiz.lCanDelete
        Thisform.Botones.CmdRecuperar.Visible 	= loBiz.lCanDelete
        Thisform.Botones.CmdEdit.Visible 		= loBiz.lCanUpdate
        *Thisform.Botones.CmdFiltrar.Visible 	= .T.

    Else
        Thisform.Botones.Visible 					= .F.
        Thisform.chkEditarEnGrilla.Visible 			= .F.
        Thisform.chkMuestraCamposEspeciales.Visible = .F.

    Endif

    If Thisform.lIngTip = .T. And Thisform.CLAVE > 0
        Thisform.CmdAceptar.Visible = .F.
        Thisform.cmdIngTip.Visible = .T.
        Thisform.I_IngTip()
        Thisform.CargarGrilla()
        Thisform.Ledit = .F.

    Else
        Thisform.lOldlKeyPreview = Thisform.KeyPreview
        Thisform.CmdAceptar.Visible = .T.
        Thisform.cmdIngTip.Visible = .F.
        Thisform.WCLAV = "A"

    EndIf

    If !Thisform.lOpenLoaded
        loFilter = Createobject( "Empty" )
        AddProperty( loFilter, "Nombre", "Empty" )
        AddProperty( loFilter, "FieldName", "empty" )
        AddProperty( loFilter, "FieldRelation", "==" )
        AddProperty( loFilter, "FieldValue", "True" )

        Thisform.AddFilter( loFilter )

    Endif

    Thisform.chkActivos.InteractiveChange()

    If loReturn.Status >= 0

        Thisform.InitializeControls()

*!*	        For Each loColumn In Thisform.Grid.Columns
*!*	            loColumn.ReadOnly 	= .T.
*!*	            loColumn.Enabled 	= .F.
*!*	        Endfor

        Thisform.Refresh()

        If _Screen.WindowState = 0

            llAutocenter = .F.
            If Thisform.Height > _Screen.Height - ( Thisform.nGap * 4 )
                _Screen.Height = Thisform.Height + ( Thisform.nGap * 4 )
                llAutocenter = .T.
            Endif

            If Thisform.Width > _Screen.Width - ( Thisform.nGap * 4 )
                _Screen.Width = Thisform.Width + ( Thisform.nGap * 4 )
                llAutocenter = .T.
            Endif

            If llAutocenter
                _Screen.AutoCenter = .T.
            Endif
        Endif

        Thisform.Ledit = .F.

        *!*	        Thisform.cntTitulo.LblFecha.Left = Thisform.Width - Thisform.cntTitulo.LblFecha.Width - 05

        Thisform.Visible = .T.

        *!*	    If Thisform.cntSearch.Visible
        *!*	        Thisform.cntsearch.SetFocus()
        *!*	    Endif

        llOk = .T.

        Thisform.HookAfterInit()

    Else
        llOk = .F.

    Endif

Catch To oErr
    Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
    loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
    loError.Cremark = lcCommand
    loError.Process( oErr )
    Throw loError

Finally
    loParametros = Null
    loReturn = Null
    loBiz = Null
    oParam = Null
    loControl = Null

Endtry

Return llOk

ENDPROC
PROCEDURE KeyPress
#INCLUDE "FW\Comunes\Include\Praxis.h"

Lparameters nKeyCode, nShiftAltCtrl
Local lcCommand As String

Try

	lcCommand = ""
	
	If nShiftAltCtrl = KEY_CTRL_DOWN
	
		Do Case
		Case nKeyCode = KEY_CTRL_F10
			Thisform.On_Ctrl_F10()

		Case nKeyCode = KEY_CTRL_F4
			Thisform.Cancelar()

		EndCase

	Else
		If Thisform.lIngTipActivo
			If Inlist( nKeyCode, Thisform.nIngTip1, Thisform.nIngTip2 )


				*Wait WINDOW noclear nowait "Se apreto " + Transform( nKeyCode )
				Do Case
					Case Thisform.nIngTipStatus = 0	&& h00
						* Es la primer Tecla presionada
						If nKeyCode = Thisform.nIngTip1
							Thisform.nIngTipStatus = 2	&&	h10

						Else
							Thisform.nIngTipStatus = 1	&&	h01

							If Thisform.nIngTipAction = 1
								* Solo vale la primer tecla presionada primero
								* Limpiar buffer de IngTip
								Thisform.nIngTipStatus = 0

							Endif

						Endif

					Case Thisform.nIngTipStatus = 1	&& h01

						If nKeyCode = Thisform.nIngTip1
							* Se completo el orden Segunda + Primera

							Thisform.WCLAV = "M"
							Thisform.lIngTipActivo = .F.

						Else
							* Se presiono 2 veces la Segunda
							* Limpiar buffer de IngTip
							Thisform.nIngTipStatus = 0

						Endif

					Case Thisform.nIngTipStatus = 2	&& h10
						If nKeyCode = Thisform.nIngTip2
							* Se completo el orden Primera + Segunda

							Thisform.WCLAV = "B"
							Thisform.lIngTipActivo = .F.

						Else
							* Se presiono 2 veces la Primera
							* Limpiar buffer de IngTip
							Thisform.nIngTipStatus = 0

						Endif

				Endcase

			Else
				* Limpiar buffer de IngTip
				Thisform.nIngTipStatus = 0	&& h00
				*Wait WINDOW noclear nowait "Se apreto " + Transform( nKeyCode )

			Endif

		Else
			Do Case
			Case Thisform.lEdit = .F.
				
				Do Case
				Case nKeyCode = KEY_ESCAPE
					Thisform.Cancelar()
					
				Case nShiftAltCtrl = KEY_CTRL_DOWN And nKeyCode = KEY_CTRL_N
					Thisform.Agregar()

				Case nShiftAltCtrl = KEY_CTRL_DOWN ;
					And InList( nKeyCode, KEY_CTRL_O, KEY_CTRL_A )
					Thisform.Editar()

				Case nShiftAltCtrl = KEY_SUPR
					Thisform.Borrar()
					
				Otherwise

				EndCase

			Otherwise

			EndCase
		Endif
	Endif

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally


Endtry

ENDPROC
PROCEDURE Load
#INCLUDE "FW\Comunes\Include\Praxis.h"

If !IsRuntime()
	Set Datasession To
EndIf

Thisform.BindControls = .F.
Thisform.Visible = .F.
Thisform.MaxWidth = Sysmetric( SYSMETRIC_SCREENWIDTH ) - ( 2 * Sysmetric( SYSMETRIC_VSCROLLBARWIDTH ) )

If Vartype( CLAVE ) # "N"
	CLAVE = 5
Endif

This.CLAVE = CLAVE

Thisform.oParametros = Createobject( "Empty" )
AddProperty( Thisform.oParametros, "WCLAV", "A" )


ENDPROC
PROCEDURE MouseDown
Lparameters nButton, nShift, nXCoord, nYCoord

Do Case
	Case nButton = 2 And nShift = 0 && Right Click
		Text To lcMsg NoShow TextMerge Pretext 03
		[Ctrl][O]: Abrir / Editar
		[Ctrl][A]: Abrir / Editar
		[Ctrl][N]: Nuevo / Agregar
		[Ctrl][S]: Guardar
		EndText


		Inform( lcMsg, "Atajos", -1 )

Endcase

ENDPROC
PROCEDURE QueryUnload
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lcCommand As String

Try

	lcCommand = ""
	
	If !Thisform.AllowExit()
		NoDefault
		Wait Window NoWait "Cierre cancelado ..."
	EndIf

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )

Finally

Endtry


ENDPROC
PROCEDURE Unload
Use in Select( Thisform.cCursorDeTrabajo )
Return This.oReturn
ENDPROC
PROCEDURE aceptar
Local lcCommand As String,;
	lcPKField As String
Local lnId As Integer

Try

	lcCommand 	= ""
	lnId 		= 0
	lcPKField 	= Thisform.oBiz.cPKField

	If !Empty( lcPKField )
		lnId = Evaluate( Thisform.cCursorDeTrabajo + "." + lcPKField )
	Endif

	Thisform.ActualizarCursorPrincipal()

	Wait Window Nowait "Aplicando actualizaciones ..."
	If Thisform.oBiz.GuardarVarios( Thisform.cMainCursorName )

		If Thisform.lReleaseAfterSave
			Wait Clear
			Thisform.oReturn.Status = 0
			Thisform.Cerrar()

		Else
			Thisform.CargarGrilla()
			If lnId > 0
				Select Alias( Thisform.cCursorDeTrabajo )
				
				Text To lcCommand NoShow TextMerge Pretext 15
				Locate For <<lcPKField>> = <<lnId>>
				EndText

				&lcCommand

			EndIf
			
			Wait Window Nowait "Actualizaciones aplicadas ..."
			Thisform.Ledit = .F.

		Endif

	Else
		Wait Clear

		*Thisform.RevertTable( .T., This.cMainCursorName )
		* RA 14/09/2021(08:58:38)
		* Mostrar los errores
		* Volver a editar, con los registros procesados bloqueados

		Select Alias( This.cCursorDeTrabajo )
		Locate

		Thisform.Ledit = .T.

	Endif

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally


Endtry

ENDPROC
PROCEDURE actualizarcursorprincipal
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lcCommand As String,;
	lcPKField As String

Local lnRecno As Integer,;
	lnId As Integer

Local loRegistro As Object

Try

	lcCommand 	= ""
	lcPKField 	= Thisform.oBiz.cPKField
	lnId 		= 0
	

	* RA 2014-08-30(16:03:12)
	* Esto es necesario para que tome las modificaciones
	* del registro actual
	Thisform.Grid.lPerdiendoElFoco = .T.
	ThisForm.Grid.BeforeRowColChange( ThisForm.Grid.ActiveColumn )
	
	If .T. && Thisform.oBiz.lCanUpdate And InList( CursorGetProp("Buffering", Thisform.cMainCursorName ), 3, 5 )
		Select Alias( Thisform.cCursorDeTrabajo )
		
		Thisform.UpdateTable( .T., .T., Thisform.cCursorDeTrabajo )

		Locate
		Scan For Evaluate( Thisform.cCursorDeTrabajo + ".ABM" ) = ABM_MODIFICACION
			lnRecno = Recno()

			If !Empty( lcPKField )
				lnId = Evaluate( Thisform.cCursorDeTrabajo + "." + lcPKField )
			Endif

			Scatter Memo Name loRegistro

			Select Alias( Thisform.cMainCursorName )

			If !Empty( lcPKField )

				If lnId < 1
					* Si la PK esta en 0 o negativo, significa que es un alta
					* que luego se modificó, y por eso que marcado
					* como ABM_MODIFICACION
					Append Blank
					Gather Memo Name loRegistro
					Replace ABM With ABM_ALTA

				Else
					TEXT To lcCommand NoShow TextMerge Pretext 15
					Locate For <<lcPKField>> = <<lnId>>
					ENDTEXT

					&lcCommand

					Gather Memo Name loRegistro

				Endif

			Else
				If lnRecno > 0
					Goto lnRecno
					Gather Memo Name loRegistro

				Else
					* Si el registro es negativo, significa que es un alta
					* que luego se modificó, y por eso que marcado
					* como ABM_MODIFICACION

					Append Blank
					Gather Memo Name loRegistro
					Replace ABM With ABM_ALTA

				Endif
			Endif


			Select Alias( Thisform.cCursorDeTrabajo )

		Endscan

		Locate
		Scan For Evaluate( Thisform.cCursorDeTrabajo + ".ABM" ) = ABM_BAJA
			lnRecno = Recno()
			If !Empty( lcPKField )
				lnId = Evaluate( Thisform.cCursorDeTrabajo + "." + lcPKField )
			Endif

			Scatter Memo Name loRegistro

			Select Alias( Thisform.cMainCursorName )

			If !Empty( lcPKField )

				If lnId > 0
					TEXT To lcCommand NoShow TextMerge Pretext 15
					Locate For <<lcPKField>> = <<lnId>>
					ENDTEXT

					&lcCommand

					Gather Memo Name loRegistro

				Endif

			Else
				If lnRecno > 0
					Goto lnRecno
					Gather Memo Name loRegistro
					
				Endif
			Endif

			Delete

			Select Alias( Thisform.cCursorDeTrabajo )

		Endscan

		Locate
		Scan For Evaluate( Thisform.cCursorDeTrabajo + ".ABM" ) = ABM_ALTA
			
			Scatter Memo Name loRegistro

			Select Alias( Thisform.cMainCursorName )

			Append Blank
			Gather Memo Name loRegistro

			Select Alias( Thisform.cCursorDeTrabajo )

		Endscan

	EndIf
	
Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally


Endtry

ENDPROC
PROCEDURE addfilter
Lparameters loFilter as Object
Local lcCommand as String
Local loFiltros As CollectionBase Of Tools\Namespaces\Prg\CollectionBase.Prg

Try

	lcCommand = ""
	This.RemoveFilter( loFilter.Nombre )
	loFiltros = Thisform.oFilters
	loFiltros.AddItem( loFilter, loFilter.Nombre )

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally
	loFilter 	= Null
	loFiltros 	= Null


EndTry

ENDPROC
PROCEDURE afterbindcontrols
Local lcCommand as String

Try

	lcCommand = ""

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


EndTry

ENDPROC
PROCEDURE agregar
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lcCommand As String
Local lnRecordOrder As Integer,;
    lnId As Integer
Local loTable As Archivo Of "Clientes\Utiles\Prg\utRutina.prg"
Local loColFields As oColFields Of "Tools\DataDictionary\prg\oColFields.prg"
Local loField As oField Of "Tools\DataDictionary\prg\oField.prg"
Local loBiz As oModelo Of "FrontEnd\Prg\Modelo.prg"
Local loColumn As Column
Local luValue As Variant

Local loColumn As Column


Try

    lcCommand 	= ""

    loTable 	= Thisform.Grid.oTable
    loBiz		= Thisform.oBiz

    If Thisform.chkEditarEnGrilla.Value = .F. And !loBiz.lCreateInBrowse

        Select Alias( Thisform.cCursorDeTrabajo )
        Scatter Memo Blank Name loRegistro
        lnId = loRegistro.Id
        loReg = loTable.SetDefaults( loRegistro, loBiz )
        AddProperty( loReg, "ABM", ABM_ALTA )

        If Thisform.oBiz.LaunchEditForm( loReg )
            Thisform.Refresh()
            *Thisform.chkActivos.InteractiveChange()
            Thisform.CargarGrilla()
        Endif

        Select Alias( Thisform.cCursorDeTrabajo )
        Locate For Id = loBiz.nId
        If !Found()
            Locate For Id = lnId
        Endif
        If !Found()
            Locate
        Endif

    Else
        If loBiz.ValidarRegistro( Thisform.cCursorDeTrabajo )

            lnRecordOrder = Reccount( Thisform.cCursorDeTrabajo ) + 1

            TEXT To lcCommand NoShow TextMerge Pretext 15
			Insert Into <<Thisform.cCursorDeTrabajo>> (
				ABM,
				_RecordOrder ) Values (
				<<ABM_ALTA>>,
				<<lnRecordOrder>> )
            ENDTEXT

            &lcCommand

            * Poner valores por default

            For Each loField In loTable.oColFields
                If !IsEmpty( loField.Default )

                    If Vartype( loField.Default ) = "C" ;
                            And !Inlist( loField.cFieldType, 'C', 'V', 'M', 'Q' )

                        luValue = Evaluate( loField.Default )

                    Else
                        luValue = loField.Default

                    Endif

                    Try

                        TEXT To lcCommand NoShow TextMerge Pretext 15
					Replace <<loField.Name>>
						With luValue
						In <<This.cCursorDeTrabajo>>
                        ENDTEXT

                        &lcCommand
                        lcCommand = ""


                    Catch To oErr

                    Finally

                    Endtry


                Endif
            Endfor

            Try

                For Each loColumn In Thisform.Grid.Columns
                    lcFieldName = Upper( Getwordnum( loColumn.ControlSource, 2, "." ) )
                    If lcFieldName # "_RECORDORDER"
                        loColumn.ReadOnly = .F.
                    Endif
                Endfor

            Catch To oErr

            Finally

            Endtry

        Endif

        If !Thisform.Ledit
            Thisform.Ledit = .T.
        Endif

        Thisform.Grid.SetFocus()
    Endif

Catch To oErr
    Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
    loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )

    If .F. && oErr.ErrorNo = 1884
        loError.Process( oErr, .F. )

        Do While Vartype( loError.UserValue ) = "O"
            loError = loError.UserValue
        Enddo
        Stop( loError.Message, "Agregar Registros" )
        Thisform.Grid.SetFocus()

    Else
        loError.Cremark = lcCommand
        loError.Process( oErr )

    Endif




Finally
    loTable = Null
    loBiz = Null
    loColFields = Null
    loField = Null

Endtry

ENDPROC
PROCEDURE allowexit
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lcCommand As String,;
	lcMsg As String,;
	lcExcludedFieldList As String

Local llExit As Boolean,;
	llCheckAllTable As Boolean,;
	llDataHasChanges As Boolean

Local lnRecno As Integer

Try

	lcCommand = ""

	If Used( Thisform.cCursorDeTrabajo )

		lnRecno = Recno( Thisform.cCursorDeTrabajo )

		llExit = .F.
		llCheckAllTable = .T.
		llDataHasChanges = DataHasChanges( Thisform.cCursorDeTrabajo,;
			llCheckAllTable,;
			lcExcludedFieldList )

		If !llDataHasChanges
			Select Alias( This.cCursorDeTrabajo )
			Locate For !Empty( ABM )
			llDataHasChanges = Found()

		Endif

		If llDataHasChanges

			TEXT To lcMsg NoShow TextMerge Pretext 03
			Si cierra el formulario
			se perderán la modificaciones
			ENDTEXT

			If Confirm( lcMsg, "¿Pierde los Cambios?", .F., MB_ICONEXCLAMATION )
				llExit = .T.
			Endif

		Else
			llExit = .T.

		Endif

		Try

			Goto Record lnRecno In Alias( This.cCursorDeTrabajo )	

		Catch To oErr

		Finally

		EndTry

		

	Else
		llExit = .T.

	Endif

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )

	* RA 2013-07-05(18:19:23)
	* Permitir cerrar si hay error
	llExit = .T.

Finally

Endtry

Return llExit

ENDPROC
PROCEDURE armargrilla
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lcCommand As String

Local lnGridWidth As Integer,;
	lnFormWidth as Integer,;
	lnGap As Integer

Local loGrid As browsegrid Of fw\comunes\vcx\prxbrowse.vcx,;
loBiz As oModelo Of "FrontEnd\Prg\Modelo.prg"

Try

	lcCommand 	= ""
	lnGap 		= Thisform.nGap
	loGrid 		= Thisform.Grid

	loGrid.Fill()
	
	lnGridWidth = 0
	lnFormWidth = 0
	loGrid.Left = lnGap
	

	For q = 1 To loGrid.ColumnCount
		With loGrid.Columns[ q ] As Column
			If .Visible
				lnGridWidth = lnGridWidth + .Width
			Endif
		Endwith
	Next

	lnFormWidth = lnGridWidth + Thisform.Botones.Width + ( lnGap * 3 )
	lnFormWidth = Max( lnFormWidth, Thisform.MinWidth )

	Thisform.BindControls = .T.
	
	loBiz = This.oBiz
	
	Thisform.cntPagination.Visible = .T.

	Select Alias( This.cCursorDeTrabajo )
	If Reccount() > 0 And Thisform.lHasFilters
		Thisform.lExit = .F.

	Else
		Thisform.lExit = .T.

	Endif

	Locate
	
	Thisform.Grid.Width = lnFormWidth - Thisform.Botones.Width - ( lnGap * 3 )
	Thisform.Width = Min( lnFormWidth + ( lnGap * 2 ), _Screen.Width - ( 2 * Sysmetric( SYSMETRIC_VSCROLLBARWIDTH )))
	Thisform.Width = Thisform.Width + 2
	
	If Thisform.Width < ( Thisform.Grid.Width + ( lnGap * 3 ) + Thisform.Botones.Width )
		Thisform.Grid.Width = Thisform.Width - ( lnGap * 3 ) - Thisform.Botones.Width
		Thisform.Grid.ScrollBars = 1
		Thisform.WindowState = 2
		_Screen.WindowState = 2
	EndIf
	Thisform.AutoCenter = .T.

	Thisform.Refresh()
	loGrid.SetFocus()


Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError


Finally
	loGrid = Null

	Wait Clear
	Thisform.LockScreen = .F.

Endtry

ENDPROC
PROCEDURE autosize
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lcCommand As String
Local lnHeight As Integer,;
    lnAnchor As Integer,;
    lnDiferencia As Integer
Local lLockScreen As Boolean

Try

    lcCommand = ""

    lLockScreen = Thisform.LockScreen

    Thisform.LockScreen 		= .T.
    Thisform.AutoCenter 		= .F.

    Thisform.cntInformacion.Left 	= Thisform.nGap
    Thisform.cntInformacion.Top 	= ThisForm.cntTitulo.Height
    Thisform.cntInformacion.Width 	= ThisForm.Width * ( Thisform.nGap * 2 )
    Thisform.cntInformacion.Autosize()

    Thisform.chkActivos.Top  	= Thisform.cntInformacion.Top + Thisform.cntInformacion.Height + Thisform.nGap
    Thisform.chkActivos.Left 	= Thisform.nGap

    Thisform.cntSearch.Left 	= Thisform.chkActivos.Left + Thisform.chkActivos.Width + Thisform.nGap
    Thisform.cntSearch.Top 		= Thisform.chkActivos.Top

    Thisform.cntFiltros.Top 	= Thisform.chkActivos.Top + Thisform.chkActivos.Height + Thisform.nGap
    Thisform.cntFiltros.Left 	= Thisform.nGap

    If !ThisForm.cntFiltros.Visible
    	Thisform.cntFiltros.Height 	= 0
    	*Thisform.cntFiltros.Top 	= Thisform.chkActivos.Top
    EndIf

    Thisform.Grid.Left 			= Thisform.nGap
    Thisform.Grid.Top 			= Thisform.cntFiltros.Top + Thisform.cntFiltros.Height
    Thisform.Grid.Height 		= ( Thisform.cntPagination.spnPageSize.Value * Thisform.Grid.RowHeight ) + Thisform.Grid.HeaderHeight  + SCROLLBARS_HEIGHT

    Thisform.Botones.Top		= Thisform.Grid.Top + Thisform.Grid.Height - Thisform.Botones.Height
    Thisform.Botones.Left 		= Thisform.Grid.Left + Thisform.Grid.Width + Thisform.nGap

    Thisform.chkEditarEnGrilla.Top 			= Thisform.Botones.Top - ( Thisform.nGap * 3 )
    Thisform.chkEditarEnGrilla.Left 		= Thisform.Botones.Left
    Thisform.chkEditarEnGrilla.Alignment 	= 0

    Thisform.chkMuestraCamposEspeciales.Top 		= Thisform.chkEditarEnGrilla.Top - ( Thisform.nGap * 4 )
    Thisform.chkMuestraCamposEspeciales.Left 		= Thisform.chkEditarEnGrilla.Left
    Thisform.chkMuestraCamposEspeciales.Alignment 	= 0

    Thisform.cntPagination.Top 	= Thisform.Grid.Top + Thisform.Grid.Height + Thisform.nGap
    Thisform.cntpagination.Left = Thisform.nGap

    Thisform.cmdCerrar.Top		= Thisform.cntPagination.Top + Thisform.cntPagination.Height + Thisform.nGap
    Thisform.cmdcerrar.Left 	= Thisform.nGap

    Thisform.CmdAceptar.Top		= Thisform.cmdCerrar.Top
    Thisform.CmdAceptar.Left 	= Thisform.Width - Thisform.nGap - Thisform.cmdaceptar.Width

    Thisform.Height 			= Thisform.cmdCerrar.Top + Thisform.cmdCerrar.Height + Thisform.nGap

    If Thisform.Height > _Screen.Height - ( ThisForm.nGap * 4 )
        lnDiferencia =  Thisform.Height - ( _Screen.Height - ( ThisForm.nGap * 4 ))
        lnTimes =  Ceiling( lnDiferencia / ThisForm.nGap )
        lnDiferencia = ThisForm.nGap * lnTimes

        Thisform.Grid.Height 		= Thisform.Grid.Height - lnDiferencia
        Thisform.Botones.Top		= Thisform.Botones.Top - lnDiferencia
        Thisform.cntPagination.Top 	= Thisform.cntPagination.Top - lnDiferencia
        Thisform.cmdCerrar.Top 		= Thisform.cmdCerrar.Top - lnDiferencia
        Thisform.CmdAceptar.Top		= Thisform.cmdCerrar.Top

        Thisform.chkEditarEnGrilla.Top 			= Thisform.Botones.Top - ( Thisform.nGap * 3 )
        Thisform.chkMuestraCamposEspeciales.Top = Thisform.chkEditarEnGrilla.Top - ( Thisform.nGap * 4 )

        Thisform.Height 			= _Screen.Height - ( ThisForm.nGap * 4 )
    Endif

    Thisform.cntSearch.Width 	= Thisform.Grid.Width - Thisform.cntSearch.Left
    Thisform.cntFiltros.Width 		= Thisform.Grid.Width

    ThisForm.cntTitulo.Autosize()
    Thisform.cntTitulo.Width = Thisform.Width

    Thisform.AutoCenter 		= .T.


Catch To loErr
    Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
    loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
    loError.cRemark = lcCommand
    loError.Process ( m.loErr )
    Throw loError

Finally
    Thisform.LockScreen = lLockScreen


Endtry

ENDPROC
PROCEDURE bindcontrols_assign
lparameters tBindControls
This.BindControls = tBindControls
Thisform.AfterBindControls()

ENDPROC
PROCEDURE borrar
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lcCommand As String
Local loBiz As oModelo Of "FrontEnd\Prg\Modelo.prg"

Try

	lcCommand = ""

	If Thisform.chkEditarEnGrilla.Value = .F.
		Select Alias( Thisform.cCursorDeTrabajo )
		Scatter Memo Name loRegistro
		If Empty( loRegistro.ABM )
			loRegistro.ABM = ABM_BAJA
		Endif

*!*			lnRecno = Recno()

*!*			Thisform.oBiz.LaunchEditForm( loRegistro )
*!*			Select Alias( Thisform.cCursorDeTrabajo )
*!*			Thisform.chkActivos.InteractiveChange()
		
        If Thisform.oBiz.LaunchEditForm( loRegistro )
        	Thisform.Refresh()
            *Thisform.chkActivos.InteractiveChange()
            Thisform.CargarGrilla()
        Endif

        Select Alias( Thisform.cCursorDeTrabajo )
		
		loBiz = This.oBiz
		Locate For id = loBiz.nId
		If !Found()
			Locate
		EndIf
*!*			GotoRecno( lnRecno )
		

	Else

		TEXT To lcCommand NoShow TextMerge Pretext 15
		Replace ABM With <<ABM_BAJA>> in <<Thisform.cCursorDeTrabajo>>
		ENDTEXT

		&lcCommand

		Thisform.UpdateTable( .F., .T., Thisform.cCursorDeTrabajo )

		Thisform.Grid.SetFocus()


		TEXT To lcCommand NoShow TextMerge Pretext 15
		Skip in <<Thisform.cCursorDeTrabajo>>
		ENDTEXT

		&lcCommand

		If Eof()
			TEXT To lcCommand NoShow TextMerge Pretext 15
		Skip -2 in <<Thisform.cCursorDeTrabajo>>
			ENDTEXT

			&lcCommand
		Endif
	Endif

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )


Finally
	loBiz = Null


Endtry

ENDPROC
PROCEDURE cancelar
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lcCommand As String

Try

	lcCommand = ""
	
	If This.lExit
		Thisform.oReturn.Status = -1
		Thisform.Cerrar()
		
	Else
		If Thisform.AllowExit()
			Thisform.VaciarGrilla()

		Else
			Wait Window Nowait "Operación cancelada ..."

		Endif
	Endif



Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )

Finally

Endtry


ENDPROC
PROCEDURE cargargrilla
Local lcCommand As String
Local lnRecords As Integer
Local loParam As Object,;
    loBiz As oModelo Of "FrontEnd\Prg\Modelo.prg",;
    loColumn As PrxColumn Of "Fw\TierAdapter\Comun\prxBaseLibrary.prg",;
    loHeader As PrxHeader Of "Fw\TierAdapter\Comun\prxbaselibrary.prg",;
    loReturn As Object

Try

    lcCommand = ""
    loParam = Createobject( "Empty" )

    AddProperty( loParam, "oFilterCriteria", This.oFilters )

    Thisform.lGridLoaded 	= .F.
    Thisform.lGridEmpty 	= .T.
    Thisform.LockScreen 	= .T.
    Thisform.BindControls 	= .F.
    Thisform.Grid.Empty()
    Thisform.Grid.oTable 	= Null
    Thisform.Grid.oColGridLayout = Null
    Thisform.oBiz.cTrace 	= Program()
    loReturn = Thisform.oBiz.Requery( loParam )

    If loReturn.lOk
        Thisform.CrearCursorDeTrabajo()
        Thisform.ArmarGrilla()

        lnRecords = Reccount( This.cCursorDeTrabajo )

        Thisform.lGridLoaded 	= !Empty( lnRecords )
        Thisform.lGridEmpty 	= Empty( lnRecords )

        This.Ledit = Thisform.lEditOnLoad

        loBiz = This.oBiz
        If !Empty( loBiz.cOrderBy )
            loColumn = Evaluate( "This.Grid." + loBiz.cOrderBy )
            loHeader = loColumn.Controls[1]
            loHeader.CurrentOrder = Iif( loBiz.cOrderPrefix = "", [ASCENDING], [DESCENDING] )

            loColumn.Controls[1].FontBold = .T.

            If loHeader.CurrentOrder = [ASCENDING]
                loColumn.Controls[1].Picture = "v:\CloudFox\FW\Comunes\image\bmp\uparrow.bmp"

            Else
                loColumn.Controls[1].Picture = "v:\CloudFox\FW\Comunes\image\bmp\dnarrow.bmp"

            Endif

            loColumn.FontBold = .T.

        Endif

        Thisform.AutoSize()

        Thisform.RemoveFilter( "Empty" )

        If .F.	&& Thisform.lGridEmpty
            Thisform.Botones.cmdAgregar.SetFocus()

        Else
            Thisform.Grid.SetFocus()

        EndIf

    Else
    	Thisform.Cancelar()

    Endif

Catch To oErr
    Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
    loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
    loError.Cremark = lcCommand
    loError.Process( oErr )
    Throw loError

Finally
    loBiz = Null


Endtry

ENDPROC
PROCEDURE ccursordetrabajo_access
If Empty( This.cCursorDeTrabajo )
	This.cCursorDeTrabajo = "w_" + This.cMainCursorName
EndIf

Return This.cCursorDeTrabajo

ENDPROC
PROCEDURE cerrar
Thisform.Release()
ENDPROC
PROCEDURE cmaincursorname_access
If Empty( This.cMainCursorName )
	This.cMainCursorName = Thisform.oBiz.cMainCursorName
Endif

Return This.cMainCursorName

ENDPROC
PROCEDURE configurar
Local lcCommand As String
Local llModifica As Boolean

Local loColGridLayout As colGridLayout Of "FW\Comunes\Prg\colGridLayout.prg"

Try

	lcCommand = ""
	loColGridLayout = Thisform.Grid.oColGridLayout

	Do Form "Fw\Comunes\Scx\Configurar vista.scx" With This.Grid.oColGridLayout To llModifica

	If llModifica
		Thisform.ArmarGrilla()
	Endif

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )


Finally


Endtry
ENDPROC
PROCEDURE crearcursordetrabajo
Local lcCommand as String

Try

	lcCommand = ""

	If .T. && Thisform.oBiz.lCanUpdate And InList( CursorGetProp("Buffering", Thisform.cMainCursorName ), 3, 5 )

		Thisform.cCursorDeTrabajo = ThisForm.Grid.cCursorDeTrabajo
		
		Use in Select( Thisform.cCursorDeTrabajo )
		
		Text To lcCommand NoShow TextMerge Pretext 15
		Select *
			From <<Thisform.cMainCursorName>>
			With ( Buffering = .T. )
			Into Cursor <<Thisform.cCursorDeTrabajo>> ReadWrite
		EndText

		&lcCommand
		
		CursorSetProp("Buffering", Thisform.nBufferingCursorTrabajo, Thisform.cCursorDeTrabajo )
		
	Else
		Thisform.cCursorDeTrabajo = Thisform.cMainCursorName
		
	EndIf

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	
	
EndTry

ENDPROC
PROCEDURE editar
Local lcCommand as String

Try

	lcCommand = ""

	ThisForm.Grid.lEditando = !Thisform.lEdit
	Thisform.lEdit = !Thisform.lEdit
	If Thisform.lEdit
		ThisForm.Grid.SetFocus()

	Else
		ThisForm.Grid.lEditando = .F.
			
	EndIf
	

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	*Throw loError

Finally
	
	
EndTry

ENDPROC
PROCEDURE enabled_assign
Lparameters tEnabled
This.Enabled = tEnabled

Thisform.cntTitulo.SetAll( "Enabled", tEnabled )

*Thisform.cmdAceptar.Enabled = tEnabled
*Thisform.cmdCerrar.Enabled 	= tEnabled
Thisform.Grid.Enabled 		= tEnabled

ENDPROC
PROCEDURE filtrar
Local lcCommand as String

Try

	lcCommand = ""
	
	This.CargarGrilla()

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


EndTry

ENDPROC
PROCEDURE hookafterinit
Local lcCommand as String

Try

	lcCommand = ""

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


EndTry

ENDPROC
PROCEDURE i_ingtip
Local lcCommand as String
Local llOldKeyPreview as Boolean
Try

	lcCommand = ""
	If Thisform.lIngTip
		Thisform.lIngTipActivo = .T.
	EndIf

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	
	
EndTry

ENDPROC
PROCEDURE inicializar
Local lcCommand as String

Try

	lcCommand = ""

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	
	
EndTry

ENDPROC
PROCEDURE initializecontrols
Local lcCommand As String
Local loBiz As oModelo Of "FrontEnd\Prg\Modelo.prg"

* RA 19/09/2021(10:05:58)
* Los controles de la clase _Cotroles_Base se subscriben a este evento

Try

    lcCommand = ""

    loBiz = Thisform.oBiz
*!*	    Thisform.chkEditarEnGrilla.Value 			= loBiz.lEditInBrowse
*!*	    Thisform.chkEditarEnGrilla.Visible 			= loBiz.lShowEditInBrowse
    Thisform.chkMuestraCamposEspeciales.Visible = loBiz.lShowCamposEspeciales

    If Empty( loBiz.cFormIndividual )
		Thisform.chkEditarEnGrilla.Value = .T.
		Thisform.chkEditarEnGrilla.Visible = .F.
		
	Else
		Thisform.chkEditarEnGrilla.Visible = loBiz.lShowEditInBrowse
		Thisform.chkEditarEnGrilla.Value = .F.
		
    EndIf


Catch To loErr
    Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
    loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
    loError.cRemark = lcCommand
    loError.Process ( m.loErr )
    Throw loError

Finally
    loBiz = Null


Endtry

ENDPROC
PROCEDURE irpagina
Lparameters nPagina As Integer, nPageSize As Integer
Local lcCommand As String

Try

	lcCommand = ""

	loFilter = Createobject( "Empty" )
	AddProperty( loFilter, "Nombre", "IrPagina" )
	AddProperty( loFilter, "FieldName", "page" )
	AddProperty( loFilter, "FieldRelation", "=" )
	AddProperty( loFilter, "FieldValue", Transform( nPagina ) )

	Thisform.AddFilter( loFilter )

	If !Empty( nPageSize )
		loFilter = Createobject( "Empty" )
		AddProperty( loFilter, "Nombre", "SetPageSize" )
		AddProperty( loFilter, "FieldName", "current_size" )
		AddProperty( loFilter, "FieldRelation", "=" )
		AddProperty( loFilter, "FieldValue", Transform( nPageSize ) )

		Thisform.AddFilter( loFilter )

	Endif

	Thisform.Filtrar()

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


Endtry

ENDPROC
PROCEDURE ledit_assign
#INCLUDE "FW\Comunes\Include\Praxis.h"

Lparameters tlEdit
Local loColumn As Column
Local loRegistro As Object,;
loBiz As oModelo Of "FrontEnd\Prg\Modelo.prg"
Local lnRecno As Integer,;
lnTotalDeRegistros as Integer
Local lcCommand As String
Local llEnable As Boolean

Try

    lcCommand = ""
    llEnable = .F.

    If tlEdit # Thisform.Ledit

        If !tlEdit

            If Thisform.AllowExit()
                Thisform.RevertTable( .T., Thisform.cCursorDeTrabajo )

                Thisform.Botones.cmdEdit.Picture = 'FW\COMUNES\IMAGE\BMP\EDIT.GIF'
                Thisform.Botones.cmdEdit.ToolTipText = "Editar los registros"
                Thisform.Botones.cmdEdit.Caption = "Editar"
                Thisform.cmdCerrar.Enabled = .T.

                Thisform.Ledit = tlEdit


            Else
                tlEdit = .T.

            Endif

        Endif

        If tlEdit

            If Thisform.chkEditarEnGrilla.Value = .F.
                Select Alias( Thisform.cCursorDeTrabajo )
                Scatter Memo Name loRegistro
                If Empty( loRegistro.ABM )
                    loRegistro.ABM = ABM_MODIFICACION
                Endif

                lnRecno = Recno()

                Thisform.Enabled = .F.
                llEnable = .T.

                loBiz = Thisform.oBiz
                lnTotalDeRegistros = loBiz.nTotalDeRegistros

                If loBiz.LaunchEditForm( loRegistro )
                	Thisform.Grid.lEditando = .F.
                    Thisform.Refresh()
                    *Thisform.chkActivos.InteractiveChange()
                    Thisform.CargarGrilla()
                    Select Alias( Thisform.cCursorDeTrabajo )
                    Locate For Id = loBiz.nId

                Else
                	loBiz.nTotalDeRegistros = lnTotalDeRegistros
                Endif

                Thisform.Enabled = .T.
                llEnable = .F.
                tlEdit = .F.

            Else
                Thisform.Botones.cmdEdit.Picture = 'FW\COMUNES\IMAGE\BMP\CLOSE.BMP'
                Thisform.Botones.cmdEdit.ToolTipText = "Cancelar la edición"
                Thisform.Botones.cmdEdit.Caption = "Salir"
                Thisform.cmdCerrar.Enabled = .F.

                Thisform.Ledit = tlEdit

            Endif

        Endif

        Thisform.Enabled = .T.
        llEnable = .F.

        If Thisform.chkEditarEnGrilla.Value = .F.
            For Each loColumn In Thisform.Grid.Columns
                loColumn.ReadOnly 	= .T.
                *loColumn.Enabled 	= .F.
            Endfor

        Else
            Thisform.SwitchEditMode( tlEdit )

            For Each loColumn In Thisform.Grid.Columns
                *loColumn.Enabled 	= .T.
                loColumn.ReadOnly 	= !tlEdit

                If Upper( loColumn.Name ) = "_RECORDORDER"
                    loColumn.ReadOnly 	= .T.
                    *loColumn.Enabled 	= .F.
                Endif
            Endfor

            Thisform.chkMuestraCamposEspeciales.Enabled = !tlEdit
            Thisform.chkEditarEnGrilla.Enabled 			= !tlEdit

        Endif

        Thisform.SynchronizeButtons()
        Thisform.Refresh()

        Thisform.Closable = !tlEdit
        Thisform.cntPagination.Enabled = !tlEdit
        Thisform.chkActivos.Enabled = !tlEdit
        Thisform.cntSearch.Enabled = !tlEdit


    Endif

Catch To loErr
    Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
    loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
    loError.cRemark = lcCommand
    loError.Process ( m.loErr )
    Throw loError

Finally
    If llEnable
        Thisform.Enabled = .T.
    EndIf
    loBiz = Null


Endtry


ENDPROC
PROCEDURE lexit_assign
lparameters tlExit
This.lExit = tlExit

If tlExit
	ThisForm.cmdCerrar.Caption = "Cerrar"
	ThisForm.cmdCerrar.Width = 84
	ThisForm.cmdCerrar.ToolTipText = "Cierra el formulario"

Else
	ThisForm.cmdCerrar.Caption = "Limpiar Grilla"
	ThisForm.cmdCerrar.Width = 108
	ThisForm.cmdCerrar.ToolTipText = "Elimina los registros de la Grilla"
	
Endif



ENDPROC
PROCEDURE lingtipactivo_assign
Lparameters tlIngTipActivo

Thisform.lIngTipActivo = tlIngTipActivo

If tlIngTipActivo
	Thisform.lOldlKeyPreview = Thisform.KeyPreview
	Thisform.KeyPreview = .T.

	Thisform.SetAll( "Enabled", .F. )
	Thisform.Enabled = .T.
	Thisform.CmdIngTip.Top = Thisform.CmdCerrar.Top
	Thisform.CmdIngTip.Enabled = .T.
	Thisform.CmdIngTip.Visible = .T.
	*Thisform.cmdAceptar.Top = -500
	Thisform.cmdAceptar.Visible = .F.
	Thisform.CmdCerrar.Enabled = .T.

Else
	Thisform.KeyPreview = Thisform.lOldlKeyPreview
	
	Thisform.CmdIngTip.Visible = .F.
	
	*Thisform.CmdIngTip.Top = -500
	*Thisform.cmdAceptar.Top = Thisform.CmdCerrar.Top
	Thisform.cmdAceptar.Visible = .T.

	Thisform.SetAll( "Enabled", .T. )

Endif

ENDPROC
PROCEDURE lusenamespaces_access
Local lcCommand As String

Try

	lcCommand = ""
	If Isnull( This.lUseNameSpaces )
		Try

			This.lUseNameSpaces = This.oBiz.lUseNameSpaces

		Catch To oErr
			This.lUseNameSpaces = .F.

		Finally

		Endtry

	Endif

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally


Endtry

Return This.lUseNameSpaces

ENDPROC
PROCEDURE obiz_access
If Vartype( This.oBiz ) # "O"
	If Vartype( This.oParam ) = "O"
		If Pemstatus( This.oParam, "oBiz", 5 )
			This.oBiz = This.oParam.oBiz
		Endif
	EndIf
	
Endif

Return This.oBiz


ENDPROC
PROCEDURE ofilters_access
Local lcCommand as String

Try

	lcCommand = ""
	If Vartype( Thisform.oFilters ) # "O"
		Thisform.oFilters = Newobject( "CollectionBase", "Tools\Namespaces\Prg\CollectionBase.Prg" )
	EndIf

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


EndTry

return This.oFilters
ENDPROC
PROCEDURE on_ctrl_f10
#INCLUDE "FW\Comunes\Include\Praxis.h"

Try

	Define Popup Emergente SHORTCUT Relative From Wrows()/2, Wcols()/2

	*!*	Definir el menu.
	Define Bar 1 Of Emergente Prompt "Cancelar \<Proceso" Key P, "" ;
		message "Cancela el proceso en ejecución."

*!*		Define Bar 2 Of Emergente Prompt "Cerrar \<Módulo" Key M, "" ;
*!*			message "Cierra el Módulo actual."

*!*		Define Bar 3 Of Emergente Prompt "\-"

*!*		Define Bar 4 Of Emergente Prompt "Entorno de \<Datos" Key D, "" ;
*!*			message "Abrir el Entorno de Datos."

	On Selection Bar 1 Of Emergente Error "Proceso cancelado por el usuario"
*!*		On Selection Bar 2 Of Emergente Quit
*!*		On Selection Bar 4 Of Emergente Set

	Activate Popup Emergente


Catch To oErr
	Thisform.Release()

Finally
	Deactivate Popup Emergente
	Release Popups Emergente Extended


Endtry

ENDPROC
PROCEDURE process
Local lcCommand as String

Try

	lcCommand = ""

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


EndTry

ENDPROC
PROCEDURE recuperar
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lcCommand As String

Try

	lcCommand = ""

	TEXT To lcCommand NoShow TextMerge Pretext 15
	Replace ABM With <<ABM_MODIFICACION>> in <<Thisform.cCursorDeTrabajo>>
	ENDTEXT

	&lcCommand

	Thisform.UpdateTable( .F., .T., Thisform.cCursorDeTrabajo )

	Thisform.Grid.SetFocus()

	TEXT To lcCommand NoShow TextMerge Pretext 15
	Skip in <<Thisform.cCursorDeTrabajo>>
	ENDTEXT

	&lcCommand

	If Eof()
		TEXT To lcCommand NoShow TextMerge Pretext 15
		Skip -2 in <<Thisform.cCursorDeTrabajo>>
		ENDTEXT

		&lcCommand
	Endif


Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )


Finally


Endtry

ENDPROC
PROCEDURE removefilter
Lparameters cFilterName as String
Local lcCommand as String
Local loFiltros As CollectionBase Of Tools\Namespaces\Prg\CollectionBase.Prg

Try

	lcCommand = ""
	loFiltros = Thisform.oFilters
	loFiltros.RemoveItem( cFilterName )

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally
	loFiltros = Null


EndTry

ENDPROC
PROCEDURE reverttable
Lparameters lAllRows, cTableAlias

Local lcCommand as String
Local lnRecords as Integer

Try

	lcCommand = ""
	lnRecords = 0
	
	* RA 14/09/2021(08:56:54)
	* Volver a cargar desde el BackEnd
	
	If Empty( cTableAlias )
		cTableAlias = Alias()
	EndIf
	
	If Used( cTableAlias )
		If InList( CursorGetProp( "Buffering", cTableAlias ), 3, 5 )
			lnRecords = TableRevert( lAllRows, cTableAlias )
			
		Else
			
			* Eliminar los registros agregados
			Text To lcCommand NoShow TextMerge Pretext 15
			Delete For ABM = <<ABM_ALTA>> In <<cTableAlias>>
			EndText

			&lcCommand
			lcCommand = ""
			
			* Quitar las marcas de Borrado y Modificado
			Text To lcCommand NoShow TextMerge Pretext 15
			Replace all ABM With 0 In <<cTableAlias>>
			EndText

			&lcCommand
			lcCommand = ""
			
		Endif
		
	EndIf
	

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	
	
EndTry

Return lnRecords

ENDPROC
PROCEDURE switcheditmode
Lparameters lEditing as Boolean

Local lcCommand as String

Try

	lcCommand = ""
	
	lnGridWith = Thisform.Grid.Width
	
    Thisform.Grid.oTable 			= Null
    Thisform.Grid.oColGridLayout 	= Null
	Thisform.grid.lShowItemNum 		= lEditing
	Thisform.BindControls 			= .F.
	Thisform.ArmarGrilla()
	Thisform.AutoSize()

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


EndTry

ENDPROC
PROCEDURE synchronizebuttons
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lcCommand As String,;
	lcAlias As String
Local lnABM As Integer


Try

	lcCommand = ""

	lcAlias = Thisform.cCursorDeTrabajo
	lnABM = Evaluate( lcAlias + ".ABM" )

	Thisform.cmdAceptar.Enabled = .T.
	Thisform.cmdAceptar.Visible = .T.

	If Thisform.chkEditarEnGrilla.Value = .T.

		Do Case
			Case Thisform.lIngTip = .T. ;
					And Thisform.CLAVE > 0 ;
					And Thisform.lIngTipActivo = .T.

				Thisform.Botones.CmdFiltrar.Enabled 	= .F.
				Thisform.Botones.CmdEdit.Enabled 		= .F.
				Thisform.Botones.CmdAgregar.Enabled 	= .F.
				Thisform.Botones.CmdBorrar.Enabled 		= .F.
				Thisform.Botones.CmdRecuperar.Enabled 	= .F.
				Thisform.cmdAceptar.Enabled 			= .F.

			Case !Thisform.lGridLoaded And !Thisform.Ledit
				Thisform.Botones.CmdFiltrar.Enabled 	= .F.
				Thisform.Botones.CmdEdit.Enabled 		= .F.
				Thisform.Botones.CmdAgregar.Enabled 	= .T.
				Thisform.Botones.CmdBorrar.Enabled 		= .F.
				Thisform.Botones.CmdRecuperar.Enabled 	= .F.
				Thisform.cmdAceptar.Enabled 			= .F.

			Case !Thisform.Ledit
				Thisform.Botones.CmdFiltrar.Enabled 	= .T.
				Thisform.Botones.CmdEdit.Enabled 		= .T.
				Thisform.Botones.CmdAgregar.Enabled 	= .F.
				Thisform.Botones.CmdBorrar.Enabled 		= .F.
				Thisform.Botones.CmdRecuperar.Enabled 	= .F.
				Thisform.cmdAceptar.Enabled 			= .F.

			Case Eof() Or Bof()
				Thisform.Botones.CmdFiltrar.Enabled 	= .F.
				Thisform.Botones.CmdEdit.Enabled 		= .T.
				Thisform.Botones.CmdAgregar.Enabled 	= .T.
				Thisform.Botones.CmdBorrar.Enabled 		= .F.
				Thisform.Botones.CmdRecuperar.Enabled 	= .F.
				Thisform.cmdAceptar.Enabled 			= .F.

			Case Inlist( lnABM, 0, ABM_ALTA, ABM_MODIFICACION )
				Thisform.Botones.CmdFiltrar.Enabled 	= .F.
				Thisform.Botones.CmdEdit.Enabled 		= .T.
				Thisform.Botones.CmdAgregar.Enabled 	= .T.
				Thisform.Botones.CmdBorrar.Enabled 		= .T.
				Thisform.Botones.CmdRecuperar.Enabled 	= .F.

			Case Inlist( lnABM, ABM_BAJA )
				Thisform.Botones.CmdFiltrar.Enabled 	= .F.
				Thisform.Botones.CmdEdit.Enabled 		= .T.
				Thisform.Botones.CmdAgregar.Enabled 	= .T.
				Thisform.Botones.CmdBorrar.Enabled 		= .F.
				Thisform.Botones.CmdRecuperar.Enabled 	= .T.

			Otherwise

		Endcase

		*Thisform.chkActivos.Enabled = Thisform.Botones.CmdFiltrar.Enabled
		Thisform.chkActivos.Enabled = .T.

	Else

		Thisform.Botones.CmdFiltrar.Visible 	= .F.
		Thisform.Botones.CmdRecuperar.Visible 	= .F.
		Thisform.cmdAceptar.Visible 			= .F.

		Do Case
			Case !Thisform.lGridLoaded And !Thisform.Ledit
				Thisform.Botones.CmdEdit.Enabled 		= .F.
				Thisform.Botones.CmdAgregar.Enabled 	= .T.
				Thisform.Botones.CmdBorrar.Enabled 		= .F.

			Case !Thisform.Ledit
				Thisform.Botones.CmdEdit.Enabled 		= .T.
				Thisform.Botones.CmdAgregar.Enabled 	= .T.
				Thisform.Botones.CmdBorrar.Enabled 		= .T.

			Case Eof() Or Bof()
				Thisform.Botones.CmdEdit.Enabled 		= .F.
				Thisform.Botones.CmdAgregar.Enabled 	= .T.
				Thisform.Botones.CmdBorrar.Enabled 		= .F.

			Otherwise

		Endcase

		Thisform.chkActivos.Enabled = .T.

	Endif

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )


Finally


Endtry

ENDPROC
PROCEDURE updatetable
Lparameters lAllRows, lForce, cTableAlias

Local lcCommand as String
Local llOk as Boolean

Try

	lcCommand = ""
	llOk = .T.
	
	If Empty( cTableAlias )
		cTableAlias = Alias()
	EndIf
	
	If Used( cTableAlias ) And InList( CursorGetProp( "Buffering", cTableAlias ), 3, 5 )
		llOk = TableUpdate( lAllRows, lForce, cTableAlias )
	EndIf
	

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	
	
EndTry

Return llOk

ENDPROC
PROCEDURE vaciargrilla
Local lcCommand As String
Local loBiz As PrxEntity Of "Fw\TierAdapter\Comun\prxEntity.prg"
Local loParam As Object

Try

	* Gernerar una consulta que no devuelva ningún registro
	lcCommand = ""
	loBiz = Thisform.oBiz

	*!*		Thisform.lblRegistros.Caption = ""
	*!*		Thisform.lblRegistros.Visible = .F.

*!*		Thisform.cntPagination.lblRegistros.Caption = ""
	
	Thisform.cntPagination.Visible = .F.


	loParam = Createobject( "Empty" )
	AddProperty( loParam, "cFilterCriteria", "( 1 < 0 )" )

	loBiz.GetByWhere( loParam )

	If !Empty( _Tally )
		*!*			Thisform.lblRegistros.Caption = Transform( _Tally ) + " Registros Encontrados"
		*!*			Thisform.lblRegistros.ForeColor = Rgb(0,0,0)

*!*			Thisform.cntPagination.lblRegistros.Caption = Transform( loBiz.nTotalDeRegistros ) + " Registros Encontrados"
*!*			Thisform.cntPagination.lblRegistros.ForeColor = Rgb(0,0,0)

		llOk = .T.

	Else
*!*			Thisform.cntPagination.lblRegistros.Caption = "No se han encontrado registros"
*!*			Thisform.cntPagination.lblRegistros.ForeColor = Rgb(255,0,0)

		*!*			Thisform.lblRegistros.Caption = "No se han encontrado registros"
		*!*			Thisform.lblRegistros.ForeColor = Rgb(255,0,0)
		llOk = .F.

	Endif

	*!*		Thisform.lblRegistros.Visible = .T.

	*Thisform.cntPagination.Sincronizar()
	Thisform.cntPagination.Visible = .T.

	Thisform.CargarGrilla()
	Thisform.SynchronizeButtons()

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	loBiz = Null
	loParam = Null


Endtry


ENDPROC
PROCEDURE wclav_assign
Lparameters tWCLAV

If tWCLAV # Thisform.WCLAV

    Thisform.WCLAV = tWCLAV

    If Inlist( tWCLAV, "A", "B", "M" )

        Thisform.lIngTipActivo = .F.

        Do Case
            Case tWCLAV = "B"
                Thisform.Caption = "* " + Thisform.Caption

            Case tWCLAV = "M"
                Thisform.Caption = "** " + Thisform.Caption

            Otherwise

        Endcase

        * RA 2014-08-18(12:55:28)
        * Cuando se cambia WCLAV, la entidad es la misma, pero
        * algunas propiedades cambian, a fin de poder redireccionar
        * a los archivos
        Thisform.oBiz.WCLAV = tWCLAV

        Do Case
            Case tWCLAV = "A"
                Thisform.oBiz.oRequery = Thisform.oBiz.oQuery_A

            Case tWCLAV = "B"
                Thisform.oBiz.oRequery = Thisform.oBiz.oQuery_B

            Case tWCLAV = "M"
                Thisform.oBiz.oRequery = Thisform.oBiz.oQuery_M

        Endcase

        Thisform.cMainCursorName = ""
        Thisform.Grid.cMainCursorName = ""

    Endif

    Thisform.oParametros.WCLAV = tWCLAV

    Thisform.CargarGrilla()
    Thisform.Ledit = .F.
Endif


ENDPROC
[END METHODS]
[START RESERVED1]
Class[END RESERVED1]
[START RESERVED2]
21[END RESERVED2]
[START RESERVED3]
_memberdata XML Metadata for customizable properties
cmaincursorname
oparam
ccursordetrabajo Contiene el Nombre del cursor sobre el que realmente se actualiza
obiz Referencia a la clase de negocios
lreleaseaftersave Indica si cierra el formulario despues de actualizar.
oreturn Referencia al objeto que se devuelve
ngap Módulo de medida de controles en pixeles
lgridloaded Indica que la grilla está cargada
ledit Indica si se está editando o no
lusenamespaces Flag de compatibilidad de versiones
nbufferingcursortrabajo Valor del buffering del cursor de trabajo. Si es 5, no permite reordenar por columna en forma interactiva
lexit Indica si el boton Cerrar vacía la grilla o cierra el Formulario
leditonload Indica si edita la grilla directamente al cargar la misma
lhasfilters Condiciona el funcionamiento del boton Cancelar
wclav
lingtip Pide al principio F9/F10
lingtipactivo Esta esperando que se presione F9/F10/Enter
ningtip1 Primera Tecla
ningtip2 Segunda Tecla
ningtipaction
ningtipstatus
loldlkeypreview
clave
oparametros Objeto que contiene los parametros para pasar a oBiz
lgridempty Indica que la grilla está vacía
ofilters Colecci´pn de Filtros
lopenloaded Indica si abre el formulario con la primera página cargada (Deafult)
ncolumna
ctitulodelprograma
oregistro
*cancelar 
*armargrilla 
*configurar 
*cmaincursorname_access 
*aceptar 
*crearcursordetrabajo Es el cursor sobre el que realmente se trabaja. El cursor principal sólo se actualiza en el metodo Aceptar().
*actualizarcursorprincipal Actualiza el cursor principal con los datos modificados en el cursor de trabajo
*borrar Marca un registro para ser borrado
*agregar Agrega un registro
*recuperar Recupera un Registro Borrado
*synchronizebuttons 
*obiz_access 
*allowexit Permite cerrar el formulario
*cargargrilla Carga la grilla con el criterio de búsqueda
*editar 
*ledit_assign 
*updatetable Wrapper sobre TablerUpdate()
*reverttable Wrapper sobre TableRevert()
*lusenamespaces_access 
*lexit_assign 
*vaciargrilla Genera un consulta que no devuelve ningún registro
*i_ingtip 
*wclav_assign 
*lingtipactivo_assign 
*inicializar 
*autosize Permite dimensionar la clase
*addfilter Agrega un Filtro a la coilección
*removefilter Elimina un filtro de la colección
*filtrar 
*afterbindcontrols 
*cerrar 
*initializecontrols 
*on_ctrl_f10 
*process 
*bindcontrols_assign 
*enabled_assign 
*ccursordetrabajo_access 
*irpagina 
*switcheditmode 
*hookafterinit 
*ofilters_access 
[END RESERVED3]
[START RESERVED6]
Pixels[END RESERVED6]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _66R14QJUN
[CLASS] brwpagination
[CLASSLOC] prxbrowse.vcx
[BASECLASS] container
[OBJNAME] cntPagination
[PARENT] browseform
[START PROPERTIES]
Top = 384
Left = 13
TabIndex = 4
Name = "cntPagination"
lblRegistros.Name = "lblRegistros"
lblPagina.Name = "lblPagina"
spnPagina.Name = "spnPagina"
btnPrimero.Name = "btnPrimero"
btnSiguiente.Name = "btnSiguiente"
btnAnterior.Name = "btnAnterior"
btnUltimo.Name = "btnUltimo"
lblDe_99.Name = "lblDe_99"
cmdPagina.Name = "cmdPagina"
spnPageSize.Value = 20
spnPageSize.Name = "spnPageSize"
lblPageSize.Name = "lblPageSize"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SW11IR8W
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] cmdAceptar
[PARENT] browseform
[START PROPERTIES]
Top = 442
Left = 425
Height = 27
Width = 91
Picture = ..\image\bmp\ok.bmp
Caption = "Aplicar"
TabIndex = 7
ToolTipText = "Aplicar las modificaciones"
PicturePosition = 1
Name = "cmdAceptar"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
If Thisform.lIngTipActivo
	Thisform.WCLAV = "A"

Else
	Thisform.Aceptar()

Endif
Wait Clear

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _4540NO6XD
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] cmdIngTip
[PARENT] browseform
[START PROPERTIES]
AutoSize = .T.
Top = -100
Left = 410
Height = 27
Width = 106
Picture = ..\image\bmp\ok.bmp
Caption = "Cargar Tabla"
TabIndex = 9
Visible = .F.
PicturePosition = 1
Name = "cmdIngTip"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
If Thisform.lIngTipActivo
	Thisform.WCLAV = "A"

Else
	Thisform.Aceptar()

Endif
Wait Clear

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SW11IR9B
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] cmdCerrar
[PARENT] browseform
[START PROPERTIES]
Top = 443
Left = 12
Height = 27
Width = 108
Picture = ..\image\bmp\close.bmp
Caption = "Limpiar Grilla"
TabIndex = 10
ToolTipText = "Cerrar el formulario"
PicturePosition = 1
Name = "cmdCerrar"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
Thisform.Cancelar()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SW11IRAZ
[CLASS] spinner
[BASECLASS] spinner
[OBJNAME] spnColumnsLock
[PARENT] browseform
[START PROPERTIES]
Height = 24
InputMask = "99"
KeyboardHighValue = 99
KeyboardLowValue = 0
Left = 457
SpinnerHighValue =  99.00
SpinnerLowValue =   0.00
TabIndex = 11
Top = 107
Visible = .F.
Width = 58
Value = 0
Name = "spnColumnsLock"
[END PROPERTIES]
[START METHODS]
PROCEDURE InteractiveChange
Local lcCommand as String

Try

	lcCommand = ""
	ThisForm.Grid.LockColumns = This.Value
	ThisForm.Grid.Refresh()

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	

Finally
	
	
EndTry

ENDPROC
PROCEDURE ProgrammaticChange
This.InteractiveChange()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SW11IRBF
[CLASS] label
[BASECLASS] label
[OBJNAME] lblColumsLock
[PARENT] browseform
[START PROPERTIES]
AutoSize = .T.
BackStyle = 0
Caption = "Columnas fijas"
Height = 17
Left = 366
Top = 114
Visible = .F.
Width = 86
TabIndex = 12
Name = "lblColumsLock"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SW11IRBS
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] cmdConfigurar
[PARENT] browseform
[START PROPERTIES]
AutoSize = .T.
Top = -500
Left = 84
Height = 27
Width = 122
Anchor = 3
Picture = ..\image\bmp\header.bmp
Caption = "Configurar Vista"
TabIndex = 8
Visible = .F.
PicturePosition = 1
Name = "cmdConfigurar"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
Thisform.Configurar()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SW11IRC4
[CLASS] container
[BASECLASS] container
[OBJNAME] cntTitulo_Old
[PARENT] browseform
[START PROPERTIES]
Anchor = 11
Top = -100
Left = 0
Width = 528
Height = 36
BorderWidth = 3
SpecialEffect = 0
TabIndex = 13
Name = "cntTitulo_Old"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SW11IRCB
[CLASS] label
[BASECLASS] label
[OBJNAME] lblFecha
[PARENT] browseform.cntTitulo_Old
[START PROPERTIES]
FontBold = .T.
FontSize = 12
Alignment = 1
BackStyle = 0
Caption = "Fecha"
Height = 22
Left = 612
Top = 3
Width = 146
ForeColor = 0,0,255
Name = "lblFecha"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SW11IRCJ
[CLASS] label
[BASECLASS] label
[OBJNAME] lblTitulo
[PARENT] browseform.cntTitulo_Old
[START PROPERTIES]
FontBold = .T.
FontSize = 12
Alignment = 0
BackStyle = 0
Caption = "Título del programa"
Height = 22
Left = 6
Top = 7
Width = 198
ForeColor = 0,0,255
Name = "lblTitulo"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SW11IRCR
[CLASS] label
[BASECLASS] label
[OBJNAME] Label1
[PARENT] browseform.cntTitulo_Old
[START PROPERTIES]
FontBold = .T.
FontSize = 12
Alignment = 1
BackStyle = 0
Caption = ""
Height = 22
Left = 540
Top = 5
Width = 34
ForeColor = 0,0,255
Name = "Label1"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3TM0V1833
[CLASS] brwbuttons
[CLASSLOC] prxbrowse.vcx
[BASECLASS] container
[OBJNAME] Botones
[PARENT] browseform
[START PROPERTIES]
Top = 246
Left = 425
Width = 91
Height = 135
TabIndex = 3
Name = "Botones"
cmdAgregar.Name = "cmdAgregar"
cmdBorrar.Name = "cmdBorrar"
cmdRecuperar.Name = "cmdRecuperar"
cmdEdit.Name = "cmdEdit"
cmdFiltrar.Visible = .F.
cmdFiltrar.Name = "cmdFiltrar"
cmdAplicar.Visible = .F.
cmdAplicar.Name = "cmdAplicar"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SZ0O0RPF
[CLASS] checkbox
[BASECLASS] checkbox
[OBJNAME] chkEditarEnGrilla
[PARENT] browseform
[START PROPERTIES]
Top = 203
Left = 427
Height = 36
Width = 91
WordWrap = .T.
Alignment = 0
BackStyle = 0
Caption = "Editar en Grilla"
Value = .F.
TabIndex = 5
Visible = .F.
Name = "chkEditarEnGrilla"
[END PROPERTIES]
[START METHODS]
PROCEDURE MouseDown
Lparameters nButton, nShift, nXCoord, nYCoord

Do Case
	Case nButton = 2 And nShift = 0 && Right Click
		If This.Value = .T.
			lcStr = "en la Grilla"
		Else
			lcStr = "en un un nuevo formulario"

		Endif


		Text To lcMsg NoShow TextMerge Pretext 03
		Edita el registro actual
		<<lcStr>>
		EndText


		Inform( lcMsg, "Edita en Grilla", -1 )

Endcase

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _65A0YZDJX
[CLASS] checkbox
[BASECLASS] checkbox
[OBJNAME] chkActivos
[PARENT] browseform
[START PROPERTIES]
Top = 106
Left = 12
Height = 17
Width = 60
Alignment = 0
BackStyle = 0
Caption = "Activos"
Value = .T.
TabIndex = 14
Name = "chkActivos"
[END PROPERTIES]
[START METHODS]
PROCEDURE InteractiveChange
Local lcCommand as String
Local loFilter as Object

Try

	lcCommand = ""
	If This.Value = .T.
		loFilter = CreateObject( "Empty" )
		AddProperty( loFilter, "Nombre", "Activos" )
		AddProperty( loFilter, "FieldName", "activo" )
		AddProperty( loFilter, "FieldRelation", "==" )
		AddProperty( loFilter, "FieldValue", "True" )
		
		Thisform.AddFilter( loFilter )

	Else
		Thisform.RemoveFilter( "Activos" )

	EndIf
	
	Thisform.Filtrar()
	
Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally
	loFilter = Null


EndTry

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _66S14J4HZ
[CLASS] brwsearch
[CLASSLOC] prxbrowse.vcx
[BASECLASS] container
[OBJNAME] cntSearch
[PARENT] browseform
[START PROPERTIES]
Top = 106
Left = 72
TabIndex = 1
Name = "cntSearch"
txtSearch.Name = "txtSearch"
btnSearch.Name = "btnSearch"
[END PROPERTIES]
[START METHODS]
PROCEDURE buscar
Local lcCommand As String,;
	lcSearchString As String

Try

	lcCommand = ""

	If !Empty( This.txtSearch.Value )
		Thisform.IrPagina( 1 )
	Endif

	DoDefault()

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally
	loFiltro = Null


Endtry

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SZ0O0RPF
[CLASS] checkbox
[BASECLASS] checkbox
[OBJNAME] chkMuestraCamposEspeciales
[PARENT] browseform
[START PROPERTIES]
Top = 158
Left = 427
Height = 48
Width = 96
WordWrap = .T.
Alignment = 0
BackStyle = 0
Caption = "Muestra Activo y Orden"
Value = .F.
TabIndex = 6
Visible = .F.
Name = "chkMuestraCamposEspeciales"
[END PROPERTIES]
[START METHODS]
PROCEDURE InteractiveChange
If This.Value = .T.
	ThisForm.chkEditarEnGrilla.Visible = .T.
Endif


ENDPROC
PROCEDURE MouseDown
Lparameters nButton, nShift, nXCoord, nYCoord

Do Case
	Case nButton = 2 And nShift = 0 && Right Click

		Text To lcMsg NoShow TextMerge Pretext 03
		Muestra los campos Activo y Orden
		EndText


		Inform( lcMsg, "Muestra campos especiales", -1 )

Endcase

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _6EZ13Q4SL
[CLASS] crud_titulo
[CLASSLOC] ..\..\..\frontend\vcx\crud.vcx
[BASECLASS] container
[OBJNAME] cntTitulo
[PARENT] browseform
[START PROPERTIES]
Top = 0
Left = 0
Width = 528
Name = "cntTitulo"
lblFecha.Name = "lblFecha"
lblTitulo.Name = "lblTitulo"
lblObservaciones.Name = "lblObservaciones"
lblAsteriscos.Name = "lblAsteriscos"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _6F10R3S63
[CLASS] browsegrid
[CLASSLOC] prxbrowse.vcx
[BASECLASS] grid
[OBJNAME] Grid
[PARENT] browseform
[START PROPERTIES]
Height = 177
Left = 13
TabIndex = 2
Top = 204
Width = 396
Name = "Grid"
[END PROPERTIES]
[START METHODS]
PROCEDURE AfterRowColChange
#INCLUDE "FW\Comunes\Include\Praxis.h"

Lparameters nColIndex

If Inlist( This.RowColChange, 1, 2, 3 )
	If Inlist( This.RowColChange, 1, 3 )
		Thisform.SynchronizeButtons()
	Endif
	This.Refresh()



Endif

ENDPROC
PROCEDURE beforedefinetable
Local lcCommand As String
Local loTable As oTable Of "Tools\DataDictionary\prg\oTable.prg"
Local loField As oField Of "Tools\DataDictionary\prg\oField.prg"
Local loUser As User Of "Fw\TierAdapter\Comun\prxUser.prg"


Try

	lcCommand = ""
	
	loTable = DoDefault()
	
	If This.lShowItemNum And ThisForm.chkMuestraCamposEspeciales.Value = .T.
	
		loUser = NewUser()
				
		For Each loField in loTable.oColFields
			If InList( Upper( loField.Name), "ORDEN", "ACTIVO", "ES_SISTEMA" )
				Do Case
				Case Upper( loField.Name) = "ACTIVO" and loUser.lModificaActivo
					loField.lShowInGrid = .T.
					
				Case Upper( loField.Name) = "ORDEN" and loUser.lModificaOrden
					loField.lShowInGrid = .T.

				Case Upper( loField.Name) = "ES_SISTEMA" and loUser.lModificaEsSistema
					loField.lShowInGrid = .T.

				EndCase
				
			EndIf

		EndFor
		
	EndIf
	
Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	loUser = Null
	

Endtry

Return loTable

ENDPROC
PROCEDURE cmaincursorname_access

If Empty( This.cMainCursorName )
	This.cMainCursorName = Thisform.cMainCursorName
EndIf

Return This.cMainCursorName

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SZ0O0RPF
[CLASS] brwfilters
[CLASSLOC] prxbrowse.vcx
[BASECLASS] container
[OBJNAME] cntFiltros
[PARENT] browseform
[START PROPERTIES]
Top = 142
Left = 12
Visible = .F.
Name = "cntFiltros"
cmdFiltrar.Name = "cmdFiltrar"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _6KE0RRNAA
[CLASS] brwinformacion
[CLASSLOC] prxbrowse.vcx
[BASECLASS] container
[OBJNAME] cntInformacion
[PARENT] browseform
[START PROPERTIES]
Top = 36
Left = 12
Visible = .F.
Name = "cntInformacion"
[END PROPERTIES]

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] RESERVED  
[OBJNAME] browseform
[START PROPERTIES]
Arial, 0, 9, 5, 15, 12, 32, 3, 0
[END PROPERTIES]
[START RESERVED1]
  ..\include\praxis.h¾ÚnfdV ..\include\foxpro.hÆÛÊrûF ..\include\strings.hÎÜZOJ* ..\..\..\tools\namespaces\include\system.hÖÝ±ÙF[END RESERVED1]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SY0QZYS6
[CLASS] grid
[BASECLASS] grid
[OBJNAME] browsegrid
[START PROPERTIES]
MemberClassLibrary = ..\..\tieradapter\comun\prxbaselibrary.prg
MemberClass = "PrxColumn"
AllowRowSizing = .F.
DeleteMark = .F.
GridLines = 0
Height = 200
HighlightRowLineWidth = 3
RecordMark = .F.
RowHeight = 24
ScrollBars = 2
Width = 320
GridLineColor = 192,192,192
HighlightBackColor = 183,219,255
HighlightForeColor = 0,0,64
HighlightStyle = 2
_memberdata =     2556<VFPData><memberdata name="performlayout" display="PerformLayout"/><memberdata name="adjustfitcolumn" display="AdjustFitColumn"/><memberdata name="fill" display="Fill"/><memberdata name="empty" display="Empty"/><memberdata name="setgridlayout" display="SetGridLayout"/><memberdata name="autosetup" display="AutoSetup"/><memberdata name="ocolgridlayout" display="oColGridLayout"/><memberdata name="cfitcolumn" display="cFitColumn"/><memberdata name="cfitcolumn_access" display="cFitColumn_Access"/><memberdata name="ocolgridlayout_access" display="oColGridLayout_Access"/><memberdata name="otable" display="oTable"/><memberdata name="otable_access" display="oTable_Access"/><memberdata name="cmaincursorname" display="cMainCursorName"/><memberdata name="cmaincursorname_access" display="cMainCursorName_Access"/><memberdata name="definetable" display="DefineTable"/><memberdata name="lcastdatetime" display="lCastDateTime"/><memberdata name="lperformautosetup" display="lPerformAutoSetUp"/><memberdata name="noriginalwidth" display="nOriginalWidth"/><memberdata name="lischeckfitcolumn" display="lIsCheckFitColumn"/><memberdata name="columnmouseenter" display="ColumnMouseEnter"/><memberdata name="columnmouseleave" display="ColumnMouseLeave"/><memberdata name="nstatus" display="nStatus"/><memberdata name="beforedefinetable" display="BeforeDefineTable"/><memberdata name="oparam" display="oParam"/><memberdata name="cerrormessage" display="cErrorMessage"/><memberdata name="obiz" display="oBiz"/><memberdata name="obiz_access" display="oBiz_Access"/><memberdata name="ccursordetrabajo" display="cCursorDeTrabajo"/><memberdata name="ccursordetrabajo_access" display="cCursorDeTrabajo_Access"/><memberdata name="lperdiendoelfoco" display="lPerdiendoElFoco"/><memberdata name="ocolumn" display="oColumn"/><memberdata name="lusesdatadictionary" display="lUsesDataDictionary" favorites="True"/><memberdata name="reverttable" display="RevertTable"/><memberdata name="updatetable" display="UpdateTable"/><memberdata name="lusenamespaces" display="lUseNameSpaces"/><memberdata name="lusenamespaces_access" display="lUseNameSpaces_Access"/><memberdata name="getcoldata" display="GetColData"/><memberdata name="neditionmode" display="nEditionMode"/><memberdata name="lshowitemnum" display="lShowItemNum"/><memberdata name="leditando" display="lEditando"/><memberdata name="width" display="Width"/><memberdata name="width_assign" display="Width_Assign"/><memberdata name="hookfieldlayout" display="HookFieldLayout"/><memberdata name="lstr" display="lStr"/></VFPData>
ocolgridlayout = .NULL.
cfitcolumn = 
otable = .NULL.
cmaincursorname = 
lcastdatetime = .T.
lperformautosetup = .F.
noriginalwidth = 0
lischeckfitcolumn = .F.
nstatus = 0
oparam = .NULL.
cerrormessage = 
obiz = .NULL.
ccursordetrabajo = 
lperdiendoelfoco = .F.
ocolumn = .NULL.
lusesdatadictionary = .T.
lusenamespaces = .NULL.
neditionmode = 0
lshowitemnum = .F.
leditando = .F.
lstr = .T.
Name = "browsegrid"
[END PROPERTIES]
[START METHODS]
PROCEDURE AfterRowColChange
#INCLUDE "FW\Comunes\Include\Praxis.h"

Lparameters nColIndex

Local lcCommand As String

Try

	lcCommand = ""

	If Inlist( This.RowColChange, 1, 2, 3 )
		This.Refresh()
	EndIf

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


Endtry

ENDPROC
PROCEDURE BeforeRowColChange
#INCLUDE "FW\Comunes\Include\Praxis.h"

Lparameters nColIndex

Local lnActiveRow As Integer,;
    lnActiveColumn As Integer,;
    lnRecno As Integer

Local loColErrorMessages As Collection

Local lcCommand As String,;
    lcErrMsg As String,;
    lcColumnValue As String,;
    lcCheck As String,;
    lcName As String,;
    lcAlias As String

Local llValid As Boolean

Local loField As oField Of "Tools\DataDictionary\prg\oField.prg",;
    loColFields As oColFields Of 'Tools\DataDictionary\prg\oColFields.prg',;
    loColumn As PrxColumn Of "Fw\TierAdapter\Comun\prxBaseLibrary.prg",;
    loArchivo As Archivo Of "Clientes\Utiles\Prg\utRutina.prg"

Try

    lcCommand 	= ""
    llValid 	= .T.
    lcAlias 	= Alias()

    If This.lEditando

        Select Alias( This.cCursorDeTrabajo )



        Try

            * RA 14/09/2021(12:10:35)
            * Si se acaba de dar de alta, volver a poner los campos
            * que son ReadOnly

            If Inlist( This.RowColChange, 1, 3 )

                loArchivo = This.oTable
                loColFields = loArchivo.oColFields

                For Each loColumn In Thisform.Grid.Columns
                    lcFieldName = Getwordnum( loColumn.ControlSource, 2, "." )
                    loField = loColFields.GetItem( lcFieldName )

                    loColumn.ReadOnly = !loField.lCanUpdate

                Endfor
            Endif

        Catch To oErr

        Finally

        Endtry


        Do Case
            Case Inlist( Evaluate( This.cCursorDeTrabajo + ".ABM" ), 0, ABM_ALTA, ABM_MODIFICACION )


                If Inlist( This.RowColChange, 1, 2, 3 ) Or This.lPerdiendoElFoco

                    If This.lPerdiendoElFoco
                        loColumn		= This.oColumn
                        lnActiveColumn  = nColIndex

                        If Empty( lnActiveColumn )
                            lnActiveColumn = 1
                        Endif

                        If Vartype( loColumn ) # "O"
                            loColumn = This.Columns[ lnActiveColumn ]
                        Endif

                        lnActiveColumn = loColumn.ColumnOrder

                    Else
                        lnActiveColumn 	= This.ActiveColumn
                        lnActiveRow 	= This.ActiveRow

                        If Empty( lnActiveColumn )
                            lnActiveColumn  = nColIndex
                        Endif

                        If Empty( lnActiveColumn )
                            lnActiveColumn = 1
                        Endif

                        loColumn 		= This.Columns[ lnActiveColumn ]


                    Endif

                    loColErrorMessages = Createobject( "Collection" )
                    This.cErrorMessage = ""

                    loField 	= loColumn.oField
                    lcName 		= loField.Name

                    If .F. && !Empty( loField.cCheck )

                        * RA 2013-06-10(21:57:47)
                        * Hay que evaluar primero el contenido del value del control, porque
                        * la tabla recién se actualiza cuando pierde el foco, y en éste evento todavía
                        * no lo hizo.

                        * Armar el criterio de evaluación para el value del control, reemplazando
                        * en la propiedad loField.cCheck el nombre de campo por una referencia al
                        * value de la columna (es un Seter al value del control activo)
                        TEXT To lcCommand NoShow TextMerge Pretext 15
						lcCheck = Strtran( '<<loField.cCheck>>', '<<loField.Name>>', 'loColumn.Value', -1, -1, 1 )
                        ENDTEXT

                        &lcCommand

                        * Evaluar el Value del control
                        If !Evaluate( lcCheck )
                            llValid = .F.

                            TEXT To lcErrMsg NoShow TextMerge Pretext 03
							<<loField.cCaption>>: <<loField.cErrorMessage>>

                            ENDTEXT

                            loColErrorMessages.Add( lcErrMsg )

                        Endif

                        * Si solo se cambia de columna, indicar el error
                        * pero permitir continuar editando
                        If !llValid And This.RowColChange = 2 && Column Change
                            Wait Window Nowait lcErrMsg
                        Endif

                    Endif

                    If .F. && Inlist( This.RowColChange, 1, 3 ) Or This.lPerdiendoElFoco && Row Change
                        * Si se cambia de fila, validar todos los campos y no permitir continuar
                        * si no validan

                        For Each loColumn In This.Columns

                            loField = loColumn.oField

                            If lcName # loField.Name && No vuelve a mostrar el control actual
                                If !Empty( loField.cCheck ) And !Evaluate( loField.cCheck )
                                    llValid = .F.

                                    TEXT To lcErrMsg NoShow TextMerge Pretext 03
									<<loField.cCaption>>: <<loField.cErrorMessage>>

                                    ENDTEXT

                                    loColErrorMessages.Add( lcErrMsg )

                                Endif
                            Endif
                        Endfor
                    Endif

                    If llValid Or This.RowColChange = 2 && Column Change
                        * Si valida o se cambia de columna, llamar a la clase de negocios
                        If Vartype( This.oBiz ) == "O"
                            * Llamar a la clase de negocios para cálculos y otras validaciones
                            loColumn 	= This.Columns[ lnActiveColumn ]
                            llValid 	= This.oBiz.BeforeRowColChange( loColumn, loColErrorMessages, This.lPerdiendoElFoco )
                        Endif

                    Endif

                    If !llValid
                        If Inlist( This.RowColChange, 1, 3 ) Or This.lPerdiendoElFoco && Row Change

                            lcErrMsg = ""

                            For Each oMsg In loColErrorMessages
                                lcErrMsg = lcErrMsg + oMsg + CRLF
                            Endfor

                            If Inlist( CursorGetProp( "Buffering", This.cCursorDeTrabajo ), 3, 5 )

                                TEXT To lcErrMsg NoShow TextMerge Pretext 03 ADDITIVE
								*** ATENCION ***

								Si cambia de registro se perderán los cambios
                                ENDTEXT

                                If Confirm( lcErrMsg, "Error de Validación del Registro", .F., MB_ICONEXCLAMATION )
                                    * Cambia de registro pese a la advertencia,
                                    * volver para atrás los cambios efectuados

                                    This.RevertTable( .F., This.cCursorDeTrabajo )

                                    loColumn = This.Columns[ lnActiveColumn ]
                                    loColumn.Refresh()
                                    llValid = .T.

                                Else
                                    Nodefault
                                    This.ActivateCell( lnActiveRow, lnActiveColumn )

                                Endif

                            Else
                                TEXT To lcErrMsg NoShow TextMerge Pretext 03 ADDITIVE
								*** ATENCION ***

								Corrija primero los campos indicados
								antes de cambiar de registro.-
                                ENDTEXT

                                Stop( lcErrMsg, "Error de Validación del Registro" )

                                Nodefault
                                This.ActivateCell( lnActiveRow, lnActiveColumn )


                            Endif

                        Endif

                    Else
                        * Si cambia de registro, confirmar los cambios
                        If Inlist( This.RowColChange, 1, 3 ) && Row Change
                            This.UpdateTable( .F., .T., This.cCursorDeTrabajo )
                        Endif

                    Endif


                Endif

            Case Inlist( Evaluate( This.cCursorDeTrabajo + ".ABM" ), ABM_BAJA )
                If Vartype( This.oBiz ) == "O"
                    * Llamar a la clase de negocios para cálculos y otras validaciones
                    lnActiveColumn 	= This.ActiveColumn
                    loColumn 		= This.Columns[ lnActiveColumn ]
                    llValid 		= This.oBiz.BeforeRowColChange( loColumn, loColErrorMessages )
                Endif

            Otherwise

        Endcase

        If !Empty( nColIndex )
            Try

                This.oColumn = This.Columns[ nColIndex ]

            Catch To oErr

            Finally

            Endtry

        Endif
    Endif


Catch To oErr
    Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
    loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
    loError.Cremark = lcCommand
    loError.Process( oErr )


Finally
    loColErrorMessages = Null
    This.lPerdiendoElFoco = .F.
    If !Empty( lcAlias )
        Select Alias( lcAlias )
    Endif


Endtry

Return llValid

ENDPROC
PROCEDURE Destroy

Local lcCommand As String

Try

	lcCommand = ""

	This.oColumn 		= Null
	This.oTable 		= Null
	This.oColGridLayout = Null
	This.oBiz 			= Null

	If Pemstatus( This.oParam, "oBiz", 5 )
		This.oParam.oBiz = Null
	Endif

	This.oParam 		= Null

	Unbindevents( This )


Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally


Endtry

ENDPROC
PROCEDURE KeyPress
#INCLUDE "FW\Comunes\Include\Praxis.h"

Lparameters nKeyCode, nShiftAltCtrl

If This.nEditionMode = 1 && Por columnas en vez de por filas
	If Inlist( nKeyCode, KEY_ENTER, KEY_TAB )

		Thisform.LockScreen = .T.
		Keyboard '{LEFTARROW}' + '{DNARROW}' Clear
		This.Refresh()
		Thisform.LockScreen = .F.

	Endif

Else
	If !Thisform.Ledit
		If !This.lEditando
			If nKeyCode = KEY_ENTER
				Keyboard '{HOME}' Clear
				This.lEditando = .T.
				Thisform.Editar()
			Endif
		Else
			This.lEditando = .F.

		Endif
	Endif
Endif


ENDPROC
PROCEDURE Resize

Local lcCommand As String

Try

	lcCommand = ""
	
	With This As BrowseGrid Of Fw\Comunes\vcx\prxbrowse.vcx
		If This.ColumnCount > 0
			This.AdjustFitColumn()
		Endif
	Endwith


Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally


Endtry

ENDPROC
PROCEDURE adjustfitcolumn
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lnFitColumnWidth As Integer
Local lnTotalColumnsWidth As Integer
Local loColumn As Column
Local loFitColumn As Column
Local lcFitColumn As String
	
Local lcCommand as String

Try

	lcCommand = ""
	lnFitColumnWidth = 0
	lnTotalColumnsWidth = 0
	loFitColumn = Null
	With This As BrowseGrid Of Fw\Comunes\vcx\prxbrowse.vcx
		lcFitColumn = .cFitColumn
		If ! Empty( lcFitColumn )
		
			lcFitColumn = Lower( lcFitColumn )
			For Each loColumn In This.Columns
				If Lower( loColumn.Name ) = lcFitColumn
					lnFitColumnWidth = loColumn.Width
					loFitColumn = loColumn

				Endif && Lower( loColumn.Name ) = lcFitColumn
				lnTotalColumnsWidth = lnTotalColumnsWidth + loColumn.Width
			Endfor
			If Empty( lnFitColumnWidth )
				Assert .F. Message "No existe la columna " + lcFitColumn

			Else

*!*					If This.ScrollBars >= 2 && Tiene la ScrollBar Vertical
*!*						lnTotalColumnsWidth = lnTotalColumnsWidth + SCROLLBARS_WIDTH
*!*					Endif

				
				Try
				
					loFitColumn.Width = lnFitColumnWidth + ( .Width - lnTotalColumnsWidth )					
				
				Catch To oErr
					lnWidth = lnFitColumnWidth + ( .Width - lnTotalColumnsWidth )					

				Finally

				EndTry

				

			Endif && Empty( lnFitColumnWidth )

		Endif && ! Empty( lcFitColumn )

	EndWith

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	loColumn = Null
	loFitColumn = Null
	
EndTry
	

ENDPROC
PROCEDURE autosetup
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lnTotalColumnsWidth As Integer
Local loColumn As Column
Local loItem As Object
Local iQ As Number
Local lnColumnWidth As Number
	
Local lcCommand as String

Try

	lcCommand = ""
	
	With This As BrowseGrid Of Fw\Comunes\vcx\prxbrowse.vcx
		If .lPerformAutoSetUp
			lnTotalColumnsWidth = 0

			.ColumnCount = .oColGridLayout.Count
			iQ = 1
			
			For Each loColumn In .Columns
				loItem = .oColGridLayout.Item( iQ )
				loColumn.ReadOnly = !This.oBiz.lCanUpdate
				.PerformLayout( loColumn, loItem )
				lnColumnWidth = loItem.ColumnWidth
				lnTotalColumnsWidth = lnTotalColumnsWidth + lnColumnWidth
				If Pemstatus( loColumn, 'nOriginalWidth', 5 )
					loColumn.nOriginalWidth = lnColumnWidth

				Endif && PemStatus( loColumn, 'nOriginalWidth', 5 )
				iQ = iQ + 1

			Endfor

			If This.ScrollBars >= 2 && Tiene la ScrollBar Vertical
				lnTotalColumnsWidth = lnTotalColumnsWidth + SCROLLBARS_WIDTH
			EndIf

			.Width = lnTotalColumnsWidth
			.nOriginalWidth = lnTotalColumnsWidth

		Endif
	EndWith
	
Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	loItem = Null
	loColumn = Null
	
	
EndTry

ENDPROC
PROCEDURE beforedefinetable
Local lcCommand As String
Local loTable As oTable Of "Tools\DataDictionary\prg\oTable.prg"
Local loTableAux As Archivo Of "Clientes\Utiles\Prg\utRutina.prg"
Local loColFields As oColFields Of "Tools\DataDictionary\prg\oColFields.prg"
Local loField As oField Of "Tools\DataDictionary\prg\oField.prg"
Local loBiz As oModelo Of "FrontEnd\Prg\Modelo.prg"
Local loUser As User Of "Fw\TierAdapter\Comun\prxUser.prg"


Try

	lcCommand = ""
	
	loBiz 		= This.oBiz
	loTable 	= GetTable( loBiz.cTabla, .T. )
	
	If This.lShowItemNum
	
		loUser = NewUser()
		
		loTableAux = Newobject( "Archivo", "Clientes\Utiles\Prg\utRutina.prg" )
		loColFields = loTableAux.oColFields

		loField = loColFields.New( "_RecordOrder", "I" )
		With loField As oField Of 'Tools\DataDictionary\prg\oField.prg'
			.lShowInGrid = .T.
			.nGridOrder = 1
			.lCanUpdate = .F.
			.cCaption = "Item"
			.oCurrentControl = Null

		EndWith
		
		For Each loField in loTable.oColFields
			loColFields.Add( loField, loField.Name )
		EndFor
		
		loTable = loTableAux

	EndIf
	
Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	loBiz 	= Null


Endtry

Return loTable

ENDPROC
PROCEDURE ccursordetrabajo_access
If Empty( This.cCursorDeTrabajo )
	This.cCursorDeTrabajo = "w_" + This.cMainCursorName
EndIf

Return This.cCursorDeTrabajo

ENDPROC
PROCEDURE cfitcolumn_access

Local loData
Local loColFilter As ColFilters Of "fw\tieradapter\comun\prxbaselibrary.prg"
Local loFilter As oFilter Of "fw\tieradapter\comun\prxbaselibrary.prg"
Local loColData As PrxCollection Of fw\tieradapter\comun\prxbaselibrary.prg
Local loField As oGridLayout Of "Fw\comunes\Prg\colGridLayout.Prg"
Local lcCommand as String

Try

	lcCommand = ""

    With This As BrowseGrid Of Fw\Comunes\vcx\prxbrowse.vcx
        If Empty( .cFitColumn ) And ! .lIsCheckFitColumn
            loColFilter = Newobject( 'ColFilters', 'fw\tieradapter\comun\prxbaselibrary.prg' )
            loFilter = loColFilter.New ( 'FiltroFitColumn' )
            loFilter.cField = 'lFitColumn'
            loFilter.cOperator = '='
            loFilter.cExpr = '.T.'
            loColData = .oColGridLayout.Where ( loColFilter )
            If loColData.Count > 0
            	loField = loColData.Item(1)
				.cFitColumn = loField.Name
            EndIf

            .lIsCheckFitColumn = .T.

        Endif && Empty( .cFitColumn ) And ! .lIsCheckFitColumn

    Endwith

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
    loColFilter = Null
    loFilter = Null
    loColData = Null
	
	
EndTry

Return This.cFitColumn

ENDPROC
PROCEDURE cmaincursorname_access

Return This.cMainCursorName

ENDPROC
PROCEDURE columnmouseenter
Lparameters tnButton As Number, tnShift As Number, tnXCoord As Number, tnYCoord As Number

#INCLUDE "FW\TierAdapter\Include\TA.h"

Local lcCommand As String

Try

	lcCommand = ""

	Debugout Datetime(), Program()

	If Inlist( This.nStatus, IS_EDITING, IS_READING )
		This.SetAll( 'MousePointer', 15 )

	Else && Inlist( Thisform.nStatus, IS_EDITING, IS_READING )
		This.SetAll( 'MousePointer', 0 )

	Endif && Inlist( Thisform.nStatus, IS_EDITING, IS_READING )


Catch To oErr
	This.SetAll( 'MousePointer', 0 )
	
Finally


Endtry

ENDPROC
PROCEDURE columnmouseleave
Lparameters tnButton As Number, tnShift As Number, tnXCoord As Number, tnYCoord As Number

Debugout Datetime(), Program()

This.SetAll( 'MousePointer', 0 )

ENDPROC
PROCEDURE empty
Local loColumn As Column

Local lcCommand As String

Try

	lcCommand = ""
	With This As BrowseGrid Of Fw\Comunes\vcx\prxbrowse.vcx
		* Apago todo antes, para despues volver a conectarlo
		For Each loColumn In .Columns
			With loColumn As Column
				.ReadOnly = !This.oBiz.lCanUpdate
				.ControlSource = ''

			Endwith

		Next

		* .RecordSource = ''

		.Refresh()
	Endwith

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	loColumn = Null


Endtry


ENDPROC
PROCEDURE fill

#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lnColumns As Integer,;
	lnGridWidth As Integer,;
	i As Integer,;
	q As Integer

Local Array laColumnWidth[ 1 ] As Integer


Local llLockScreen As Boolean,;
	llDone As Boolean,;
	llRestoreColW As Boolean,;
	llABM As Boolean

Local lcAsociatedCursor As String,;
	lcCommand As String

Try

	lcCommand = ""
	
	llLockScreen = Thisform.LockScreen
	Thisform.LockScreen = .T.
	llRestoreColW = .F.
	
	With This As BrowseGrid Of Fw\Comunes\vcx\prxbrowse.vcx

		lcAsociatedCursor = This.cCursorDeTrabajo

		llABM = .T.

		Try

			=Evaluate( lcAsociatedCursor + ".ABM" )
			llABM = .T.

		Catch To oErr
			llABM = .F.

		Finally

		EndTry
		
		If Used( lcAsociatedCursor )

			Try

				If .F. && .ColumnCount > 0
					* Guardo la configuración de las columnas, para restaurarlas despues
					Dimension laColumnWidth[ .ColumnCount ]
					Store 0 To laColumnWidth

					For q = 1 To .ColumnCount
						With .Columns[ q ] As Column
							laColumnWidth[ q ] = .Width
							* Apago todo antes, para despues volver a conectarlo
							.ReadOnly = !This.oBiz.lCanUpdate
							.ControlSource = ''

						Endwith

					Endfor
					llRestoreColW = .T.

				Endif && .ColumnCount > 0

			Catch To oErr
				llRestoreColW = .F.

			Finally

			Endtry

			* Builds the grid
			llDone = .F.

			* A veces quedaba una columna, pese a que ColumnCount = 0
			* Con esto me aseguro de eliminar todas las columnas (RA: 01/10/2008)
			Do While ! llDone
				Try
					loColumn = .Columns( 1 )
					.RemoveObject( loColumn.Name )
				Catch To oErr
					llDone = .T.
				Finally
				Endtry
			Enddo

			.ColumnCount = -1
			.RecordSource = ""
			
			.oColGridLayout = Null

			lnColumns = .oColGridLayout.Count

			.ColumnCount = lnColumns

			.RecordSource = lcAsociatedCursor

			lnGridWidth = 0
			
			For q = 1 To lnColumns
				With .Columns[ q ] As Column
				
					.ReadOnly = !This.oBiz.lCanUpdate
					This.PerformLayout( This.Columns[ q ], This.oColGridLayout.Item( q ) )
					.ControlSource = lcAsociatedCursor + "." + .ControlSource
					
					If This.lCastDateTime
						If Vartype( Evaluate( .ControlSource ) ) == "T"
							.ControlSource = "=Ttod( " + .ControlSource + " )"

						Endif && Vartype( Evaluate( .ControlSource ) ) == "T"

					Endif && This.CastDateTime

					If Vartype( Evaluate( .ControlSource ) ) == "C"
						loGridLayout = This.oColGridLayout.Item( q )
						If loGridLayout.IsNumeric
							.ControlSource = "Val( " + .ControlSource + " )"

						Endif && loGridLayout.IsNumeric

					Endif && Vartype( Evaluate( .ControlSource ) ) == "C"
					
					If llABM
						TEXT To lcCommand NoShow TextMerge Pretext 15
						ICase( 	ABM = <<ABM_BAJA>>, Rgb(255,0,0),
								ABM = <<ABM_PROCESADO>>, RGB(0,128,64),
								Mod( _RecordOrder, 2 ) = 1, Rgb(255,255,255),
								Rgb(220,240,220) )
						ENDTEXT

						.DynamicBackColor = lcCommand

						TEXT To lcCommand NoShow TextMerge Pretext 15
						ICase( 	ABM = <<ABM_BAJA>>, Rgb(255,255,255),
								ABM = <<ABM_PROCESADO>>, RGB(255,255,0),
								 Rgb(0,0,0) )
						ENDTEXT

						.DynamicForeColor = lcCommand

						lcCommand = ""


						TEXT To lcCommand NoShow TextMerge Pretext 15
						ICase( 	ABM = <<ABM_PROCESADO>>, .T.,
								 .F. )
						ENDTEXT

						.DynamicFontItalic = lcCommand

						lcCommand = ""

						lcFieldName = Upper( Getwordnum( .ControlSource, 2, "." ) )
						If lcFieldName == "_RECORDORDER"
							.FontBold = .T.
						EndIf

					Endif

					.Resize()

				Endwith
			Next

			.Refresh()

			If lnColumns = 1
				* Si muestro una sola columna, saco las líneas divisorias y pongo
				* el ancho de la columna al máximo
				.GridLines = 0
				.Columns[ 1 ].Width = This.Width
			Else && lnColumns = 1
				.GridLines = 2
			Endif && lnColumns = 1

			If llRestoreColW
				* Restauro la configuración de las columnas que pudiera
				* haber hecho el usuario
				Try
					For q = 1 To .ColumnCount
						.Columns[ q ].Width = laColumnWidth[ q ]

					Endfor
				Catch To oErr
					* Si algo falla ....
					.AutoFit()

				Finally
				Endtry
			Endif && llRestoreColW
			
			If lnColumns > 1
				.AdjustFitColumn()
			EndIf
			
			.Refresh()
			
		Endif

	Endwith

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	Thisform.LockScreen = llLockScreen
	loGridLayout = Null

Endtry


ENDPROC
PROCEDURE getcoldata
Lparameters loColFields As oColFields Of "Tools\DataDictionary\prg\oColFields.prg"

Local lcCommand As String,;
	lcWhere As String
Local loColData As CollectionBase Of Tools\Namespaces\Prg\CollectionBase.Prg


Try

	lcCommand = ""

	*lcWhere = ' ( nGridOrder # 0 ) And ( lShowInGrid = .T. ) '
	lcWhere = ' ( nGridOrder > 0 ) And ( lShowInGrid = .T. ) '

	loColData =  loColFields.Query( "", 0, .F., "", lcWhere, .F., 'nGridOrder' )

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = _NewObject ( 'ErrorHandler', 'ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally
	loColFields = Null

Endtry

Return loColData

ENDPROC
PROCEDURE hookfieldlayout
Lparameters toField

Local lcCommand As String,;
	lcPropertyName As String

Local loFieldAux As oField Of "Tools\DataDictionary\prg\oField.prg"

Local lnLen As Integer,;
	i As Integer

Dimension laMember(1)


Try

	lcCommand = ""
	* RA 09/06/2022(10:30:30)
	* Devuelve una copia de la instancia, para poder modificarla
	* sin que afecte la definición en utDataDictionary
	
	loFieldAux = NewObject( "oField", "Tools\DataDictionary\prg\oField.prg" )
	

	lnLen = Amembers( laMember, loFieldAux, 0 )
	
	For i = 1 To lnLen
		lcPropertyName = laMember[ i ]

		Try

			Text To lcCommand NoShow TextMerge Pretext 15
			loFieldAux.<<lcPropertyName>> = toField.<<lcPropertyName>>
			EndText

			&lcCommand
			lcCommand = ""
			
		Catch To oErr

		Finally

		Endtry

	EndFor
	
	* Aquí se debe personalizar loFieldAux antes de devolverlo
	* If Inlist( Lower( oFieldAux.Name ), "condicion_iva", "tipo_documento", "provincia" )
	
    If loFieldAux.lStr And !This.lEditando
        loFieldAux.oCurrentControl 	= Null
        loFieldAux.cFieldType 		= "C"
        loFieldAux.nFieldWidth 		= 100
        If Empty( loFieldAux.nGridMaxLength )
			loFieldAux.nGridMaxLength = 30
        EndIf

        loFieldAux.cInputMask 		= Replicate( "X", loFieldAux.nGridMaxLength )

    Endif

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


EndTry

Return loFieldAux
ENDPROC
PROCEDURE lusenamespaces_access
Local lcCommand As String

Try

	lcCommand = ""
	If Isnull( This.lUseNameSpaces )
		Try

			This.lUseNameSpaces = This.oBiz.lUseNameSpaces

		Catch To oErr
			This.lUseNameSpaces = .F.

		Finally

		Endtry

	Endif

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally


Endtry

Return This.lUseNameSpaces

ENDPROC
PROCEDURE obiz_access
If Vartype( This.oBiz ) # "O"
	If Vartype( This.oParam ) = "O"
		If Pemstatus( This.oParam, "oBiz", 5 )
			This.oBiz = This.oParam.oBiz
			This.lStr = This.oBiz.lStr
		Endif
	EndIf
		
	* RA 2013-10-10(10:57:23)
	* Por compatibilidad con los procesos que no tienen una clase de negocios
	If Vartype( This.oBiz ) # "O"
		This.oBiz = Newobject( "Entidad", "Rutinas\Prg\prxEntidad.prg" )
	Endif

Endif

Return This.oBiz

ENDPROC
PROCEDURE ocolgridlayout_access
Local lcCommand As String

Try

	lcCommand = ""

	With This As BrowseGrid Of Fw\Comunes\vcx\prxbrowse.vcx
		If Vartype( This.oColGridLayout ) # 'O'
			This.oColGridLayout = Newobject( "colGridLayout",  ;
				"Fw\Comun\Prg\colGridLayout.prg" )

			This.SetGridLayout()

		Endif && Vartype( .oColGridLayout ) # 'O'

	Endwith

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally

Endtry


Return This.oColGridLayout

ENDPROC
PROCEDURE otable_access
If Isnull( This.oTable )
	This.oTable = This.BeforeDefineTable()
	This.DefineTable()
Endif

Return This.oTable

ENDPROC
PROCEDURE performlayout
Lparameters toColumn As Column, toParam As oGridLayout Of "Fw\Comunes\Prg\colGridLayout.Prg"

#INCLUDE "FW\Comunes\Include\Praxis.h"

Local laMember[1]

Local i As Integer
Local lcSourceProperty As String
Local lcTargetProperty As String
Local lcPrefix As String
Local loControl As Object,;
    loCurrentControl As Object,;
    loField As oField Of 'Tools\DataDictionary\prg\oField.prg',;
    loTxt As TextBox,;
    loTP As TextProperties Of "fw\comunes\prg\txtproperties.prg"

Local lcCommand As String,;
    lcCurrentControlClass As String,;
    lcCurrentControlClassLibrary As String

Local loCbo As ComboBoxBase Of "Clientes\Utiles\prg\utDataDictionary.prg",;
    loSpn As SpinnerBase Of "Clientes\Utiles\prg\utDataDictionary.prg",;
    loTxt As TextBoxBase Of "Clientes\Utiles\prg\utDataDictionary.prg"


Local lnLenght As Integer

Try

    lcCommand = ""


    For i = 1 To Amembers( laMember, toParam, 0, "U" )
        Try
            lcSourceProperty = laMember[ i ]
            lcTargetProperty = Substr( lcSourceProperty, 7 )
            lcPrefix = Lower( Substr( lcSourceProperty, 1, 6 ) )

            Do Case
                Case lcPrefix == "header"
                    toColumn.Controls[1].&lcTargetProperty = toParam.&lcSourceProperty

                Case lcPrefix  == "column"
                    toColumn.&lcTargetProperty = toParam.&lcSourceProperty

                Case Lower( lcSourceProperty ) == 'ocurrentcontrol'

                    If !IsEmpty( toParam.oCurrentControl )

                        If !( Lower( toColumn.CurrentControl ) == Lower( toParam.oCurrentControl.Name ) )
                            lcCurrentControlClass 			= toParam.oCurrentControl.Class
                            lcCurrentControlClassLibrary 	= toParam.oCurrentControl.ClassLibrary

                            *!*	                            If Empty( lcCurrentControlClassLibrary )
                            *!*	                            	Set Step On
                            *!*	                                lcCurrentControlClass 			= toParam.oCurrentControl.Name
                            *!*	                                lcCurrentControlClassLibrary 	= toParam.oCurrentControl.Class
                            *!*	                            Endif

                            toColumn.RemoveObject( toColumn.CurrentControl )
                            toColumn.Newobject( toParam.oCurrentControl.Name,;
                                lcCurrentControlClass,;
                                lcCurrentControlClassLibrary )

                            lcControlName 	= toParam.oCurrentControl.Name
                            loControl 		= Evaluate( "toColumn." + lcControlName )

                            loControl.Visible = .T.

                            If Inlist( Upper( loControl.BaseClass ), "CHECKBOX" )
                                toColumn.Alignment = 2
                            Endif

                            toColumn.CurrentControl = toParam.oCurrentControl.Name

                            toColumn.Sparse = .F.

                            * RA 2013-10-21(11:14:44)
                            * Asegurarse que la columna tiene el mismo ancho que el control
                            * definido en el Diccionario de Datos
                            lnLenght = toParam.oField.nGridMaxLength
                            If Empty( lnLenght )
                                lnLenght = toParam.oField.nLength
                            Endif

                            loTxt = Createobject( "TextBox" )
                            loTxt.InputMask = Replicate( "X", lnLenght )

                            loTP = Newobject( "TextProperties", "fw\comunes\prg\txtproperties.prg" )

                            If loTP.Process( loTxt, 2, 1.2 )
                                toColumn.Width = loTxt.Width
                                toParam.ColumnWidth = loTxt.Width
                            Endif

                            loField = toParam.oField

                            Do Case
                                Case Lower( lcCurrentControlClass ) = Lower( "ComboBoxBase" )

                                    loCbo = loControl
                                    *loCbo.cTable 		= loField.cReferences
                                    *loCbo.cModelo 		= loField.oParent.Name
                                    loCbo.cFieldName 	= loField.Name
                                    loCbo.cModelo		= loField.cReferences
                                    loCbo.cTable 		= loField.oParent.Name

                                    loCbo.ToolTipText 	= loField.cToolTipText
                                    loCbo.Format 		= loField.cFormat
                                    loCbo.InputMask 	= loField.cInputMask

                                    loCbo.CargarCombo()

                                    toColumn.ControlSource = loField.Name

                                Case Lower( lcCurrentControlClass ) = Lower( "SpinnerBase" )
                                    loSpn = loControl
                                    loSpn.cTable 		= loField.oParent.Name
                                    loSpn.cFieldName 	= loField.Name

                                    loSpn.cCueText 		= loField.cToolTipText
                                    loSpn.ToolTipText 	= loField.cToolTipText
                                    loSpn.Format 		= loField.cFormat
                                    loSpn.InputMask 	= loField.cInputMask


                                Case Lower( lcCurrentControlClass ) = Lower( "TextBoxBase" )
                                    loTxt = loControl
                                    loTxt.cTable 		= loField.oParent.Name
                                    loTxt.cFieldName 	= loField.Name

                                    loTxt.cCueText 		= loField.cToolTipText
                                    loTxt.ToolTipText 	= loField.cToolTipText
                                    loTxt.Format 		= loField.cFormat
                                    loTxt.InputMask 	= loField.cInputMask


                            Endcase

                        Endif && ! ( Lower( toColumn.CurrentControl ) == Lower( toParam.oCurrentControl.Name ) )

                    Endif && ! IsEmpty( toParam.oCurrentControl )

                Otherwise
            Endcase

        Catch To loErr
            Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
            DEBUG_CLASS_EXCEPTION
            *!* DEBUG_EXCEPTION
            loError = _NewObject ( 'ErrorHandler', 'ErrorHandler\Prg\ErrorHandler.prg' )
            loError.cTraceLogin = 'Source Property: ' + lcSourceProperty + CR ;
                + 'Target Property: ' + lcTargetProperty + CR ;
                + 'Prefix: ' + lcPrefix
            loError.cRemark = lcCommand
            m.loError.Process ( m.loErr )
            THROW_EXCEPTION

        Finally
            loCurrentControl 	= Null
            loTxt 				= Null
            loTP 				= Null
            loCbo				= Null
            loControl 			= Null
            loField 			= Null

        Endtry


    Endfor

    AddProperty( toColumn, "oField", toParam.oField )
    AddProperty( toColumn, "Check", toParam.oField.cCheck )
    If !Empty( toColumn.Check )
        toColumn.Check = Strtran( toColumn.Check,;
            toParam.oField.Name,;
            "loCurrentControl.Value",;
            -1,;
            -1,;
            1 )
    Endif


    If toParam.lFitColumn
        This.cFitColumn = toParam.ColumnName
    Endif && toParam.lFitColumn

    For Each loControl In toColumn.Controls
        If Lower( loControl.BaseClass ) == "header"
            * Nothing to do for Headers
        Else && loControl.BaseClass = "Header"
            * Binds all the controls' *Click events to the grid's
            If Pemstatus( loControl, "Click", 5 )
                Bindevent( loControl, "Click", This, "Click" )

            Endif && Pemstatus( loControl, "Click", 5 )

            If Pemstatus( loControl, "DblClick", 5 )
                Bindevent( loControl, "DblClick", This, "DblClick" )

            Endif && Pemstatus( loControl, "DblClick", 5 )

            If Pemstatus( loControl, "RightClick", 5 )
                Bindevent( loControl, "RightClick", This, "RightClick" )

            Endif && Pemstatus( loControl, "RightClick", 5 )

            If Pemstatus( loControl, "KeyPress", 5 )
                Bindevent( loControl, "KeyPress", This, "KeyPress" )

            Endif && Pemstatus( loControl, "KeyPress", 5 )

            If Pemstatus( loControl, "MouseEnter", 5 )
                Bindevent( loControl, "MouseEnter", This, "ColumnMouseEnter" )

            Endif && Pemstatus( loControl, "MouseEnter", 5 )

            If Pemstatus( loControl, "MouseLeave", 5 )
                Bindevent( loControl, "MouseLeave", This, "ColumnMouseLeave" )

            Endif && Pemstatus( loControl, "MouseLeave", 5 )

        Endif && loControl.BaseClass = "Header"

    Endfor



Catch To oErr
    Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
    loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
    loError.cRemark = lcCommand
    loError.Process( oErr )
    Throw loError

Finally
    loControl 			= Null
    loCbo 				= Null
    loSpn 				= Null
    loTxt 				= Null
    loCurrentControl 	= Null
    loField 			= Null
    loTP 				= Null
    toColumn 			= Null
    toParam 			= Null

Endtry


ENDPROC
PROCEDURE reverttable
Lparameters lAllRows, cTableAlias

Local lcCommand as String
Local lnRecords as Integer

Try

	lcCommand = ""
	lnRecords = 0
	* RA 14/09/2021(09:06:37)
	* Volver a cargar desde el BackEnd
	
	If Empty( cTableAlias )
		cTableAlias = Alias()
	EndIf
	
	If Used( cTableAlias ) And InList( CursorGetProp( "Buffering", cTableAlias ), 3, 5 )
		lnRecords = TableRevert( lAllRows, cTableAlias )
	EndIf
	

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	
	
EndTry

Return lnRecords

ENDPROC
PROCEDURE setgridlayout
Local loField As oField Of "Tools\DataDictionary\prg\oField.prg"
Local loFieldAux As oField Of "Tools\DataDictionary\prg\oField.prg"
Local loTable As oTable Of "Tools\DataDictionary\prg\oTable.prg"
Local loGridLayout As oGridLayout Of "Fw\Comunes\Prg\colGridLayout.prg"
Local loColData As CollectionBase Of Tools\Namespaces\Prg\CollectionBase.Prg
Local loColFields As oColFields Of "Tools\DataDictionary\prg\oColFields.prg"
*
Local lcName As String

*
Local lnCnt As Integer
Local i As Integer
Local j As Integer
Local lnIndex As Integer,;
    lnLenght As Integer

Local lcCommand As String

Try

    lcCommand = ""

    lnCnt = 0

    * Obtengo la tabla
    loTable = This.oTable

    loColData = This.GetColData( loTable.oColFields )

    For i = 1 To loColData.Count
        loField = loColData.Item[ i ]
        lnCnt 	= lnCnt + 1 && Contador para ver cuantos Objetos se han procesado

        loFieldAux 	= This.HookFieldLayout( loField )
        lcName 		= Lower( loFieldAux.Name )
        lnIndex 	= This.oColGridLayout.GetKey( lcName )


        If Empty( lnIndex )

            * DA 2009-07-15(11:55:58)
            * Tomo la configuración del campo original sin importar si se reemplazó
            = loFieldAux.cCaption
            loGridLayout = This.oColGridLayout.NewFromField( loFieldAux, lcName, "", .F., This.lStr )

            * DA 2009-07-15(11:55:58)
            * Tomo la configuración del campo original sin importar si se reemplazó

            lnLenght = loFieldAux.nGridMaxLength
            If Empty( lnLenght )
                lnLenght = loFieldAux.nLength
            EndIf
            loGridLayout.nLength = lnLenght

            loGridLayout.lFitColumn = loFieldAux.lFitColumn
            loGridLayout.Width = Iif( loFieldAux.nGridOrder > 0, loGridLayout.Width, 0 )
            loGridLayout.ColumnWidth = Iif( loFieldAux.nGridOrder > 0, loGridLayout.ColumnWidth, 0 )
            loGridLayout.ColumnReadOnly = !loField.lCanUpdate
            loGridLayout.ColumncIndexExpression = loField.cGridIndexExpression
            loGridLayout.ColumnVisible = loFieldAux.nGridOrder > 0
            loGridLayout.HeaderToolTipText = loFieldAux.cToolTipText

        Endif && Empty( lnIndex )


    Endfor


Catch To oErr
    Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
    loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
    loError.Cremark = lcCommand
    loError.Process( oErr )
    Throw loError

Finally
    loField = Null
    loFieldAux = Null
    loTable = Null
    loGridLayout = Null
    loColData = Null

Endtry

ENDPROC
PROCEDURE updatetable
Lparameters lAllRows, lForce, cTableAlias

Local lcCommand as String
Local llOk as Boolean

Try

	lcCommand = ""
	llOk = .T.
	
	If Empty( cTableAlias )
		cTableAlias = Alias()
	EndIf
	
	If Used( cTableAlias ) And InList( CursorGetProp( "Buffering", cTableAlias ), 3, 5 )
		llOk = TableUpdate( lAllRows, lForce, cTableAlias )
	EndIf
	

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	
	
EndTry

Return llOk

ENDPROC
[END METHODS]
[START RESERVED1]
Class[END RESERVED1]
[START RESERVED2]
1[END RESERVED2]
[START RESERVED3]
_memberdata XML Metadata for customizable properties
ocolgridlayout
cfitcolumn
otable
cmaincursorname
lcastdatetime
lperformautosetup
noriginalwidth
lischeckfitcolumn
nstatus
oparam Objeto parámetro
cerrormessage Contiene el mensaje de error devuelto por BeforeRowColChange
obiz Referencia a la clase de negocios
ccursordetrabajo Nombre del cursor de trabajo
lperdiendoelfoco Es setado por el metodo Valid(), para poder validar el control activo antes de perder el foco.
ocolumn Referncia a la última columna posicionada
lusesdatadictionary Si utiliza Diccionario de Datos, no es necesario definir la tabla a partir de una vista
lusenamespaces Flag de compatibilidad de versiones
neditionmode Modo de Edición. 0 - Por fila (Default); 1 - Por Columna
lshowitemnum Indica si la primer columna contiene el Nº de item o fila
leditando Para controlar el evento Thisform.KeyPress()
lstr Cuando el campo contiene una FK, indica si muestra la FK, o el nombre de la FK apuntada\n
*performlayout 
*adjustfitcolumn 
*fill 
*empty 
*setgridlayout 
*autosetup 
*cfitcolumn_access 
*ocolgridlayout_access 
*otable_access 
*cmaincursorname_access 
*definetable 
*columnmouseenter 
*columnmouseleave 
*beforedefinetable Crea la tabla desde un cursor
*obiz_access 
*ccursordetrabajo_access 
*reverttable Wrapper sobre TableRevert()
*updatetable Wrapper sobre TableUpdate()
*lusenamespaces_access 
*getcoldata Devuelve una colección con los campos filtrados
*hookfieldlayout Permite personalizar temporalmente las propiedades del campo a mostrar
[END RESERVED3]
[START RESERVED6]
Pixels[END RESERVED6]

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] RESERVED  
[OBJNAME] browsegrid
[START PROPERTIES]
Arial, 0, 9, 5, 15, 12, 32, 3, 0
[END PROPERTIES]
[START RESERVED1]
  ..\include\praxis.h¬nfdV ..\include\foxpro.h¦­ÊrûF ..\include\strings.h®®ZOJ* ..\..\..\tools\namespaces\include\system.h¶¯±ÙF ..\..\tieradapter\include\ta.h¾°îU[END RESERVED1]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SZ0O0RPF
[CLASS] textbox
[BASECLASS] textbox
[OBJNAME] brwnumeric
[START PROPERTIES]
Height = 23
Width = 100
Name = "brwnumeric"
[END PROPERTIES]
[START METHODS]
PROCEDURE KeyPress
Lparameters  nKeyCode, nShiftAltCtrl

With This As brwtextbox Of FW\Comunes\vcx\prxBrowse.vcx
	* When set point is comma, allows the user to use the "." interactively
	If nKeyCode = Asc( "." ) ;
		And nShiftAltCtrl = 0
		
		If Set( "point" ) = ","
			Nodefault
			Keyboard ","
		EndIf

	EndIf
	
Endwith

ENDPROC
PROCEDURE Valid
Try

	llValid = .T.

Catch To oErr

Finally


Endtry

Return llValid

ENDPROC
[END METHODS]
[START RESERVED1]
Class[END RESERVED1]
[START RESERVED2]
1[END RESERVED2]
[START RESERVED6]
Pixels[END RESERVED6]

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] RESERVED  
[OBJNAME] brwnumeric
[START PROPERTIES]
Arial, 0, 9, 5, 15, 12, 32, 3, 0
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3TM0UPU7Y
[CLASS] container
[BASECLASS] container
[OBJNAME] brwbuttons
[START PROPERTIES]
Width = 92
Height = 162
BackStyle = 0
BorderWidth = 0
Name = "brwbuttons"
[END PROPERTIES]
[START RESERVED1]
Class[END RESERVED1]
[START RESERVED2]
7[END RESERVED2]
[START RESERVED6]
Pixels[END RESERVED6]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SZ0O0RPF
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] cmdAgregar
[PARENT] brwbuttons
[START PROPERTIES]
Top = 108
Left = 0
Height = 27
Width = 92
Anchor = 12
Picture = ..\image\bmp\new.bmp
Caption = "Agregar"
ToolTipText = "Agregar un Registro"
PicturePosition = 1
Name = "cmdAgregar"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
Thisform.Agregar()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3TM0V05BL
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] cmdBorrar
[PARENT] brwbuttons
[START PROPERTIES]
Top = 81
Left = 0
Height = 27
Width = 92
Anchor = 12
Picture = ..\image\bmp\exception.bmp
Caption = "Borrar"
ToolTipText = "Borrar el registro"
PicturePosition = 1
Name = "cmdBorrar"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
Thisform.Borrar()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SZ0O0RPF
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] cmdRecuperar
[PARENT] brwbuttons
[START PROPERTIES]
Top = 54
Left = 0
Height = 27
Width = 92
Anchor = 12
Picture = ..\image\bmp\#undo.bmp
Caption = "Recuperar"
ToolTipText = "Recuperar el registro borrado"
PicturePosition = 1
Name = "cmdRecuperar"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
Thisform.Recuperar()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SZ0O0RPF
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] cmdEdit
[PARENT] brwbuttons
[START PROPERTIES]
Top = 27
Left = 0
Height = 27
Width = 92
Anchor = 12
Picture = ..\image\bmp\edit.gif
Caption = "Editar"
ToolTipText = "Editar los registros"
PicturePosition = 1
Name = "cmdEdit"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
Thisform.Editar()
ENDPROC
PROCEDURE MouseDown
Lparameters nButton, nShift, nXCoord, nYCoord

Do Case
	Case nButton = 2 And nShift = 0 && Right Click
		Text To lcMsg NoShow TextMerge Pretext 03
		Edita el registro seleccionado
		EndText

		Inform( lcMsg, "Editar", -1 )

Endcase

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _65A12J772
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] cmdFiltrar
[PARENT] brwbuttons
[START PROPERTIES]
Top = 0
Left = 0
Height = 27
Width = 92
Anchor = 12
Picture = ..\image\bmp\filter.bmp
Caption = "Filtrar"
ToolTipText = "Editar los registros"
PicturePosition = 1
Name = "cmdFiltrar"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
Thisform.Filtrar()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _65W0RLZF0
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] cmdAplicar
[PARENT] brwbuttons
[START PROPERTIES]
Top = 135
Left = 0
Height = 27
Width = 92
Anchor = 12
Picture = ..\image\bmp\ok.bmp
Caption = "Aplicar"
ToolTipText = "Aplicar las Novedades"
PicturePosition = 1
Name = "cmdAplicar"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
Thisform.Aplicar()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] RESERVED  
[OBJNAME] brwbuttons
[START PROPERTIES]
Arial, 0, 9, 5, 15, 12, 32, 3, 0
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _65O138VP6
[CLASS] container
[BASECLASS] container
[OBJNAME] gridinform
[START PROPERTIES]
Width = 420
Height = 349
BackStyle = 0
_memberdata =     3080<VFPData><memberdata name="armargrilla" display="ArmarGrilla"/><memberdata name="crearcursordetrabajo" display="CrearCursorDeTrabajo"/><memberdata name="actualizarcursorprincipal" display="ActualizarCursorPrincipal"/><memberdata name="borrar" display="Borrar"/><memberdata name="agregar" display="Agregar"/><memberdata name="recuperar" display="Recuperar"/><memberdata name="synchronizebuttons" display="SynchronizeButtons"/><memberdata name="cmaincursorname" display="cMainCursorName"/><memberdata name="cmaincursorname_access" display="cMainCursorName_Access"/><memberdata name="obiz" display="oBiz"/><memberdata name="obiz_access" display="oBiz_Access"/><memberdata name="cargargrilla" display="CargarGrilla"/><memberdata name="editar" display="Editar"/><memberdata name="ledit" display="lEdit"/><memberdata name="ledit_assign" display="lEdit_Assign"/><memberdata name="updatetable" display="UpdateTable"/><memberdata name="reverttable" display="RevertTable"/><memberdata name="ccursordetrabajo" display="cCursorDeTrabajo"/><memberdata name="nbufferingcursortrabajo" display="nBufferingCursorTrabajo"/><memberdata name="leditarengrilla" display="lEditarEnGrilla"/><memberdata name="lgridloaded" display="lGridLoaded"/><memberdata name="lgridempty" display="lGridEmpty"/><memberdata name="leditonload" display="lEditOnLoad"/><memberdata name="allowexit" display="AllowExit"/><memberdata name="autosize" display="Autosize"/><memberdata name="addfilter" display="AddFilter"/><memberdata name="removefilter" display="RemoveFilter"/><memberdata name="ofilters" display="oFilters"/><memberdata name="cclassname" display="cClassName"/><memberdata name="cclasslibrary" display="cClassLibrary"/><memberdata name="lautosize" display="lAutosize"/><memberdata name="filtrar" display="Filtrar"/><memberdata name="aplicar" display="Aplicar"/><memberdata name="cargarfiltrosiniciales" display="CargarFiltrosIniciales"/><memberdata name="initialize" display="Initialize"/><memberdata name="lcommitingrilla" display="lCommitInGrilla"/><memberdata name="ccursordetrabajo_access" display="cCursorDeTrabajo_Access"/><memberdata name="lautomaticdisplay" display="lAutomaticDisplay"/><memberdata name="ncolumnsspan" display="nColumnsSpan"/><memberdata name="nleftcolumn" display="nLeftColumn"/><memberdata name="nrowspan" display="nRowSpan"/><memberdata name="ntoprow" display="nTopRow"/><memberdata name="nwidth" display="nWidth"/><memberdata name="cdisplaycontrolclassname" display="cDisplayControlClassName"/><memberdata name="cdisplaycontrolclasslibrary" display="cDisplayControlClassLibrary"/><memberdata name="odisplaycontrol" display="oDisplayControl"/><memberdata name="odisplaycontrol_access" display="oDisplayControl_Access"/><memberdata name="initializerows" display="InitializeRows"/><memberdata name="afterbindcontrols" display="AfterBindControls"/><memberdata name="ctable" display="cTable" favorites="True"/><memberdata name="irpagina" display="IrPagina"/><memberdata name="hookafterfill" display="HookAfterFill"/><memberdata name="switcheditmode" display="SwitchEditMode"/></VFPData>
cmaincursorname = 
obiz = .NULL.
ledit = .F.
ccursordetrabajo = 
nbufferingcursortrabajo = 5
leditarengrilla = .F.
lgridloaded = .F.
lgridempty = .F.
leditonload = .F.
ofilters = .NULL.
cclassname = 
cclasslibrary = 
lautosize = .T.
lcommitingrilla = .F.
lautomaticdisplay = .T.
ncolumnsspan = 12
nleftcolumn = 1
nrowspan = 12
ntoprow = 6
nwidth = 360
cdisplaycontrolclassname = cGridForm
cdisplaycontrolclasslibrary = FW\Comunes\vcx\_Controles_Base.prg
odisplaycontrol = .NULL.
ctable = 
Name = "gridinform"
[END PROPERTIES]
[START METHODS]
PROCEDURE Init
Local lcCommand As String

Try

	lcCommand = ""
	This.BorderWidth = 0
	
	* Para que no se encimen los controles
	If This.nRowSpan < 9
		This.nRowSpan = 9
	EndIf

	This.oFilters = Newobject( "CollectionBase", "Tools\Namespaces\Prg\CollectionBase.Prg" )

	If Pemstatus( Thisform, 'InitializeControls', 5 )
		Bindevent( Thisform, 'InitializeControls', This, 'Initialize', 1 )
	Endif

	If Pemstatus( Thisform, 'InitializeRows', 5 )
		Bindevent( Thisform, 'InitializeRows', This, 'InitializeRows', 1 )
	Endif

	If Pemstatus( Thisform, 'AfterBindControls', 5 )
		Bindevent( Thisform, 'AfterBindControls', This, 'AfterBindControls', 1 )
	Endif

	*This.AutoSize()

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


Endtry

ENDPROC
PROCEDURE MouseDown
Lparameters nButton, nShift, nXCoord, nYCoord

Do Case
	Case nButton = 2 And nShift = 0 && Right Click
		Text To lcMsg NoShow TextMerge Pretext 03
		[Ctrl][O]: Abrir / Editar
		[Ctrl][A]: Abrir / Editar
		[Ctrl][N]: Nuevo / Agregar
		[Ctrl][S]: Guardar
		EndText


		Inform( lcMsg, "Atajos", -1 )

Endcase

ENDPROC
PROCEDURE actualizarcursorprincipal
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lcCommand As String,;
	lcPKField As String

Local lnRecno As Integer,;
	lnId As Integer

Local loRegistro As Object

Try

	lcCommand 	= ""
	lcPKField 	= This.oBiz.cPKField
	lnId 		= 0
	

	* RA 2014-08-30(16:03:12)
	* Esto es necesario para que tome las modificaciones
	* del registro actual
	This.Grid.lPerdiendoElFoco = .T.
	This.Grid.BeforeRowColChange( This.Grid.ActiveColumn )
	
	If .T. && This.oBiz.lCanUpdate And InList( CursorGetProp("Buffering", This.cMainCursorName ), 3, 5 )
		Select Alias( This.cCursorDeTrabajo )
		
		This.UpdateTable( .T., .T., This.cCursorDeTrabajo )

		Locate
		Scan For Evaluate( This.cCursorDeTrabajo + ".ABM" ) = ABM_MODIFICACION
			lnRecno = Recno()

			If !Empty( lcPKField )
				lnId = Evaluate( This.cCursorDeTrabajo + "." + lcPKField )
			Endif

			Scatter Memo Name loRegistro

			Select Alias( This.cMainCursorName )

			If !Empty( lcPKField )

				If lnId < 1
					* Si la PK esta en 0 o negativo, significa que es un alta
					* que luego se modificó, y por eso que marcado
					* como ABM_MODIFICACION
					Append Blank
					Gather Memo Name loRegistro
					Replace ABM With ABM_ALTA

				Else
					TEXT To lcCommand NoShow TextMerge Pretext 15
					Locate For <<lcPKField>> = <<lnId>>
					ENDTEXT

					&lcCommand

					Gather Memo Name loRegistro

				Endif

			Else
				If lnRecno > 0
					Goto lnRecno
					Gather Memo Name loRegistro

				Else
					* Si el registro es negativo, significa que es un alta
					* que luego se modificó, y por eso que marcado
					* como ABM_MODIFICACION

					Append Blank
					Gather Memo Name loRegistro
					Replace ABM With ABM_ALTA

				Endif
			Endif


			Select Alias( This.cCursorDeTrabajo )

		Endscan

		Locate
		Scan For Evaluate( This.cCursorDeTrabajo + ".ABM" ) = ABM_BAJA
			lnRecno = Recno()
			If !Empty( lcPKField )
				lnId = Evaluate( This.cCursorDeTrabajo + "." + lcPKField )
			Endif

			Scatter Memo Name loRegistro

			Select Alias( This.cMainCursorName )

			If !Empty( lcPKField )

				If lnId > 0
					TEXT To lcCommand NoShow TextMerge Pretext 15
					Locate For <<lcPKField>> = <<lnId>>
					ENDTEXT

					&lcCommand

					Gather Memo Name loRegistro

				Endif

			Else
				If lnRecno > 0
					Goto lnRecno
					Gather Memo Name loRegistro
					
				Endif
			Endif

			Delete

			Select Alias( This.cCursorDeTrabajo )

		Endscan

		Locate
		Scan For Evaluate( This.cCursorDeTrabajo + ".ABM" ) = ABM_ALTA
			
			Scatter Memo Name loRegistro

			Select Alias( This.cMainCursorName )

			Append Blank
			Gather Memo Name loRegistro

			Select Alias( This.cCursorDeTrabajo )

		Endscan

	EndIf
	
Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally


Endtry

ENDPROC
PROCEDURE addfilter
Lparameters loFilter as Object
Local lcCommand as String
Local loFiltros As CollectionBase Of Tools\Namespaces\Prg\CollectionBase.Prg

Try

	lcCommand = ""
	This.RemoveFilter( loFilter.Nombre )
	loFiltros = This.oFilters
	loFiltros.AddItem( loFilter, Lower( loFilter.Nombre ))

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally
	loFilter 	= Null
	loFiltros 	= Null


EndTry

ENDPROC
PROCEDURE afterbindcontrols
Local lcCommand as String

Try

	lcCommand = ""

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


EndTry

ENDPROC
PROCEDURE agregar
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lcCommand As String
Local lnRecordOrder As Integer
Local loTable As Archivo Of "Clientes\Utiles\Prg\utRutina.prg"
Local loColFields As oColFields Of "Tools\DataDictionary\prg\oColFields.prg"
Local loField As oField Of "Tools\DataDictionary\prg\oField.prg"
Local loBiz As oModelo Of "FrontEnd\Prg\Modelo.prg"
Local loColumn As Column
Local luValue As Variant

Local loColumn As Column


Try

	lcCommand 	= ""

	loTable 	= This.Grid.oTable
	loBiz		= This.oBiz
	
	If loBiz.ValidarRegistro( This.cCursorDeTrabajo )
	
		If This.lEditarEnGrilla = .F. And !loBiz.lCreateInBrowse

			Select Alias( This.cCursorDeTrabajo )
			Scatter Memo Blank Name loRegistro
			loReg = loTable.SetDefaults( loRegistro, loBiz )
			AddProperty( loReg, "ABM", ABM_ALTA )

			Thisform.Enabled = .F.

			If loBiz.LaunchEditForm( loReg )
				If This.lCommitInGrilla
					Select Alias( This.cCursorDeTrabajo )
					lnRecordOrder = Reccount( This.cCursorDeTrabajo ) + 1

					TEXT To lcCommand NoShow TextMerge Pretext 15
					Insert Into <<This.cCursorDeTrabajo>> (
						ABM,
						_RecordOrder ) Values (
						<<ABM_ALTA>>,
						<<lnRecordOrder>> )
					ENDTEXT

					&lcCommand
					lcCommand = ""

					Locate For _RecordOrder = lnRecordOrder
					Gather Name loReg

				Else
					*This.chkActivos.InteractiveChange()
					This.CargarGrilla()
					Locate For Id = loBiz.nId

				Endif
			Endif

			Thisform.Enabled = .T.

		Else
			lnRecordOrder = Reccount( This.cCursorDeTrabajo ) + 1

			TEXT To lcCommand NoShow TextMerge Pretext 15
			Insert Into <<This.cCursorDeTrabajo>> (
				ABM,
				_RecordOrder ) Values (
				<<ABM_ALTA>>,
				<<lnRecordOrder>> )
			ENDTEXT

			&lcCommand
			lcCommand = ""

			* Poner valores por default

			For Each loField In loTable.oColFields
				If !IsEmpty( loField.Default )

					If Vartype( loField.Default ) = "C" ;
							And !Inlist( loField.cFieldType, 'C', 'V', 'M', 'Q' )

						luValue = Evaluate( loField.Default )

					Else
						luValue = loField.Default

					Endif

					Try

						TEXT To lcCommand NoShow TextMerge Pretext 15
						Replace <<loField.Name>>
							With luValue
							In <<This.cCursorDeTrabajo>>
						ENDTEXT

						&lcCommand
						lcCommand = ""


					Catch To oErr

					Finally

					Endtry


				Endif
			Endfor

			Try

				For Each loColumn In This.Grid.Columns
					lcFieldName = Upper( Getwordnum( loColumn.ControlSource, 2, "." ) )
					If lcFieldName # "_RECORDORDER"
						loColumn.ReadOnly = .F.
					Endif
				Endfor

			Catch To oErr

			Finally

			Endtry


			If !This.Ledit
				This.Ledit = .T.
			Endif

			This.Grid.SetFocus()
		Endif
	Endif

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	*Throw loError

Finally
	loTable = Null
	loBiz = Null
	loColFields = Null
	loField = Null
	Thisform.Enabled = .T.

Endtry

ENDPROC
PROCEDURE allowexit
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lcCommand As String,;
	lcMsg As String,;
	lcExcludedFieldList As String

Local llExit As Boolean,;
	llCheckAllTable As Boolean,;
	llDataHasChanges As Boolean

Local lnRecno As Integer

Try

	lcCommand = ""

	If .F. && Used( This.cCursorDeTrabajo )

		lnRecno = Recno( This.cCursorDeTrabajo )

		llExit = .F.
		llCheckAllTable = .T.
		llDataHasChanges = DataHasChanges( This.cCursorDeTrabajo,;
			llCheckAllTable,;
			lcExcludedFieldList )

		If !llDataHasChanges
			Select Alias( This.cCursorDeTrabajo )
			Locate For !Empty( ABM )
			llDataHasChanges = Found()

		Endif

		If llDataHasChanges

			TEXT To lcMsg NoShow TextMerge Pretext 03
			Si cierra la grilla
			se perderán la modificaciones
			ENDTEXT

			If Confirm( lcMsg, "¿Pierde los Cambios?", .F., MB_ICONEXCLAMATION )
				llExit = .T.
			Endif

		Else
			llExit = .T.

		Endif

		Try

			Goto Record lnRecno In Alias( This.cCursorDeTrabajo )	

		Catch To oErr

		Finally

		EndTry

		

	Else
		llExit = .T.

	Endif

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )

	* RA 2013-07-05(18:19:23)
	* Permitir cerrar si hay error
	llExit = .T.

Finally

Endtry

Return llExit

ENDPROC
PROCEDURE aplicar
Local lcCommand As String,;
	lcPKField As String
Local lnId As Integer

Try

	lcCommand 	= ""
	lnId 		= 0
	lcPKField 	= This.oBiz.cPKField

	If !Empty( lcPKField )
		lnId = Evaluate( This.cCursorDeTrabajo + "." + lcPKField )
	Endif

	This.ActualizarCursorPrincipal()

	Wait Window Nowait "Aplicando actualizaciones ..."
	If This.oBiz.GuardarVarios( This.cMainCursorName )

			This.CargarGrilla()
			If lnId > 0
				Select Alias( This.cCursorDeTrabajo )
				
				Text To lcCommand NoShow TextMerge Pretext 15
				Locate For <<lcPKField>> = <<lnId>>
				EndText

				&lcCommand

			EndIf
			
			Wait Window Nowait "Actualizaciones aplicadas ..."
			This.lEdit = .F.

	Else
		Wait Clear

		*This.RevertTable( .T., This.cMainCursorName )
		* RA 14/09/2021(08:58:38)
		* Mostrar los errores
		* Volver a editar, con los registros procesados bloqueados

		Select Alias( This.cCursorDeTrabajo )
		Locate

		This.lEdit = .T.

	Endif

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally


Endtry

ENDPROC
PROCEDURE armargrilla
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lcCommand As String

Local lnGridWidth As Integer,;
    lnGap As Integer

Local loGrid As browsegrid Of fw\comunes\vcx\prxbrowse.vcx

Try

    lcCommand = ""

    loGrid = This.Grid

    loGrid.Fill()

    This.HookAfterFill()

    Thisform.BindControls = .T.

    Select Alias( This.cCursorDeTrabajo )
    Locate

    *This.cntPagination.Sincronizar()
    This.cntPagination.Visible = .T.


    This.Refresh()

    If Thisform.Visible
        loGrid.SetFocus()
    Endif

Catch To oErr
    Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
    loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
    loError.Cremark = lcCommand
    loError.Process( oErr )
    Throw loError


Finally
    loGrid = Null

    Wait Clear
    If Thisform.BindControls
		Thisform.LockScreen = .F.
    EndIf

Endtry

ENDPROC
PROCEDURE autosize
Local lcCommand As String
Local lnHeight As Integer,;
    lnAnchor As Integer,;
    lnWidth As Integer

Local loBiz As oModelo Of "FrontEnd\Prg\Modelo.prg"
Local loColumn As Column

Try

    lcCommand = ""

    * RA 01/10/2021(18:06:39)
    * Acomoda los controles al borde externo del container

    If This.lAutosize
        loBiz = This.oBiz
        This.lblTitulo.Caption = loBiz.cTituloEnGrilla

        lnWidth = 0
        For Each loColumn In This.Grid.Columns
            lnWidth = lnWidth + loColumn.Width
        Endfor

        If Empty( lnWidth )
            lnWidth = ( This.nColumnsSpan * Thisform.nColumna )
        Endif

        This.Grid.Left 		= 0
        This.Grid.Height 	= This.Height - This.Grid.Top - This.cntPagination.Height
        This.Grid.Width 	= This.Width - This.Botones.Width - Thisform.nGap

        If This.Grid.Height < This.Grid.RowHeight * 5
            This.Grid.Height = This.Grid.RowHeight * 5
            This.Height = This.Grid.Top + This.Grid.Height + This.cntPagination.Height
        Endif

        This.Botones.Left 	= This.Width - This.Botones.Width
        This.Botones.Top 	= This.Height - This.Botones.Height
        This.Botones.Top 	= This.Grid.Top + This.Grid.Height - This.Botones.Height

        If This.spnColumnsLock.Visible
            This.spnColumnsLock.Top = 24
            This.spnColumnsLock.Left = This.Grid.Width - This.spnColumnsLock.Width

            This.lblColumsLock.Top = 24
            This.lblColumsLock.Left = This.spnColumnsLock.Left - This.lblColumsLock.Width
        EndIf

        This.chkEditarEnGrilla.Top 	= This.Botones.Top - ( Thisform.nGap * 3 )
        This.chkEditarEnGrilla.Left = This.Botones.Left

        This.chkMuestraCamposEspeciales.Top 	= This.chkEditarEnGrilla.Top - ( Thisform.nGap * 4 )
        This.chkMuestraCamposEspeciales.Left 	= This.chkEditarEnGrilla.Left

        This.cntPagination.Top 		= This.Grid.Top + This.Grid.Height
        This.cntPagination.Left 	= 0
        This.cntPagination.Anchor 	= 6

    Endif

Catch To loErr
    Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
    loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
    loError.cRemark = lcCommand
    loError.Process ( m.loErr )
    Throw loError

Finally


Endtry

ENDPROC
PROCEDURE borrar
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lcCommand As String
Local loBiz As oModelo Of "FrontEnd\Prg\Modelo.prg"

Try

	lcCommand = ""
	loBiz = This.oBiz

	If This.lEditarEnGrilla = .F.
		Select Alias( This.cCursorDeTrabajo )
		Scatter Memo Name loRegistro
		If Empty( loRegistro.ABM )
			loRegistro.ABM = ABM_BAJA
		Endif

		lnRecno = Recno()

		Thisform.Enabled = .F.
		lnRecno = Recno()

		If loBiz.LaunchEditForm( loRegistro )
			If This.lCommitInGrilla
				Select Alias( This.cCursorDeTrabajo )
				Locate For Id = loBiz.nId
				Gather Name loRegistro

			Else
				*This.chkActivos.InteractiveChange()
				This.CargarGrilla()
				GotoRecno( lnRecno )

			Endif
		Endif

		Thisform.Enabled = .T.

	Else
		TEXT To lcCommand NoShow TextMerge Pretext 15
		Replace ABM With <<ABM_BAJA>> in <<This.cCursorDeTrabajo>>
		ENDTEXT

		&lcCommand

		This.UpdateTable( .F., .T., This.cCursorDeTrabajo )

		This.Grid.SetFocus()


		TEXT To lcCommand NoShow TextMerge Pretext 15
		Skip in <<This.cCursorDeTrabajo>>
		ENDTEXT

		&lcCommand

		If Eof()
			TEXT To lcCommand NoShow TextMerge Pretext 15
		Skip -2 in <<This.cCursorDeTrabajo>>
			ENDTEXT

			&lcCommand
		Endif
	Endif

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )


Finally
	loBiz = Null
	Thisform.Enabled = .T.


Endtry

ENDPROC
PROCEDURE cargarfiltrosiniciales
Local lcCommand As String
Local loFiltros As "CollectionBase" Of "Tools\Namespaces\Prg\CollectionBase.Prg"

Try

	lcCommand = ""

	loFiltros = This.oBiz.CargarFiltrosIniciales()
	For Each loFiltro In loFiltros
		This.Parent.AddFilter( loFiltro )
	Endfor

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally
	loFiltro = Null
	loFiltros = Null


Endtry

ENDPROC
PROCEDURE cargargrilla
Local lcCommand As String
Local lnRecords As Integer
Local loParam As Object

Try

    lcCommand = ""
    loParam = Createobject( "Empty" )

    AddProperty( loParam, "oFilterCriteria", This.oFilters )

    This.lGridLoaded 			= .F.
    This.lGridEmpty 			= .T.
    Thisform.LockScreen 		= .T.
    Thisform.BindControls 		= .F.
    This.Grid.Empty()
    This.Grid.oTable 			= Null
    This.Grid.oColGridLayout 	= Null

    This.oBiz.cTrace			= Program()
    This.oBiz.Requery( loParam )
    This.CrearCursorDeTrabajo()
    This.ArmarGrilla()

    lnRecords = Reccount( This.cCursorDeTrabajo )

    This.lGridLoaded 	= !Empty( lnRecords )
    This.lGridEmpty 	= Empty( lnRecords )

    This.Ledit = This.lEditOnLoad

    If Thisform.Visible
        If This.lGridEmpty
            This.Botones.cmdAgregar.SetFocus()

        Else
            This.SetFocus()

        Endif
    Endif


Catch To oErr
    Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
    loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
    loError.Cremark = lcCommand
    loError.Process( oErr )
    Throw loError

Finally


Endtry

ENDPROC
PROCEDURE ccursordetrabajo_access
If Empty( This.cCursorDeTrabajo )
	This.cCursorDeTrabajo = "w_" + This.cMainCursorName
EndIf

Return This.cCursorDeTrabajo


ENDPROC
PROCEDURE cmaincursorname_access
If Empty( This.cMainCursorName )
	This.cMainCursorName = This.oBiz.cMainCursorName
Endif

Return This.cMainCursorName

ENDPROC
PROCEDURE crearcursordetrabajo
Local lcCommand as String

Try

	lcCommand = ""
	

	If .T. && This.oBiz.lCanUpdate And InList( CursorGetProp("Buffering", This.cMainCursorName ), 3, 5 )

		This.cCursorDeTrabajo = This.Grid.cCursorDeTrabajo
		
		Use in Select( This.cCursorDeTrabajo )
		
		Text To lcCommand NoShow TextMerge Pretext 15
		Select *
			From <<This.cMainCursorName>>
			With ( Buffering = .T. )
			Into Cursor <<This.cCursorDeTrabajo>> ReadWrite
		EndText

		&lcCommand
		
		CursorSetProp("Buffering", This.nBufferingCursorTrabajo, This.cCursorDeTrabajo )
		
	Else
		This.cCursorDeTrabajo = This.cMainCursorName
		
	EndIf

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	
	
EndTry

ENDPROC
PROCEDURE editar
Local lcCommand As String

Try

    lcCommand = ""

    This.Ledit = !This.Ledit
    If This.Ledit
        If Thisform.Visible
            This.Grid.SetFocus()
        Endif
    Endif

Catch To oErr
    Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
    loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
    loError.Cremark = lcCommand
    loError.Process( oErr )
    *Throw loError

Finally


Endtry

ENDPROC
PROCEDURE filtrar
Local lcCommand as String

Try

	lcCommand = ""
	This.CargarGrilla()

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


EndTry

ENDPROC
PROCEDURE hookafterfill
Local lcCommand as String

Try

	lcCommand = ""

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


EndTry

ENDPROC
PROCEDURE initialize
Local lcCommand As String
Local loBiz As oModelo Of "FrontEnd\Prg\Modelo.prg",;
    loDisplayControl As cGridForm Of "FW\Comunes\vcx\_Controles_Base.prg"

Try

    lcCommand = ""

    This.oBiz = Null
    This.oFilters = Null
    This.cMainCursorName = ""
    This.cCursorDeTrabajo = ""

    This.oFilters = Newobject( "CollectionBase", "Tools\Namespaces\Prg\CollectionBase.Prg" )

    * Si es tabla hija, inicializar el Padre
    loBiz = This.oBiz
    If loBiz.lIsChild
        loBiz.oParent = Thisform.oBiz
    Endif

    *!*	    Thisform.chkEditarEnGrilla.Value 			= loBiz.lEditInBrowse
    *!*	    Thisform.chkEditarEnGrilla.Visible 			= loBiz.lShowEditInBrowse
    This.chkMuestraCamposEspeciales.Visible = loBiz.lShowCamposEspeciales

    If Empty( loBiz.cFormIndividual )
        This.chkEditarEnGrilla.Value = .T.
        This.chkEditarEnGrilla.Visible = .F.

    Else
        This.chkEditarEnGrilla.Visible = loBiz.lShowEditInBrowse
        This.chkEditarEnGrilla.Value = .F.

    Endif

    * Cargar filtros iniciales
    This.CargarFiltrosIniciales()

    This.ChkActivos.Value = This.ChkActivos.Value

    This.SynchronizeButtons()

    loDisplayControl = This.oDisplayControl
    loDisplayControl.oThisForm = Thisform
    loDisplayControl.Initialize()

    For Each loColumn In This.Grid.Columns
        loColumn.ReadOnly 	= .T.
        loColumn.Enabled 	= .T.
    Endfor

Catch To loErr
    Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
    loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
    loError.cRemark = lcCommand
    loError.Process ( m.loErr )
    Throw loError

Finally
    loBiz = Null
    loDisplayControl = Null

Endtry

ENDPROC
PROCEDURE initializerows
Local lcCommand As String
Local loDisplayControl As cGridForm Of "FW\Comunes\vcx\_Controles_Base.prg"

Try

	lcCommand = ""

	loDisplayControl = This.oDisplayControl
	loDisplayControl.InicializarFilas()
	
	This.AutoSize()
	
	
Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	loDisplayControl = Null
	This.oDisplayControl = Null

Endtry

ENDPROC
PROCEDURE irpagina
Lparameters nPagina As Integer, nPageSize As Integer
Local lcCommand As String

Try

	lcCommand = ""
	
	loFilter = Createobject( "Empty" )
	AddProperty( loFilter, "Nombre", "IrPagina" )
	AddProperty( loFilter, "FieldName", "page" )
	AddProperty( loFilter, "FieldRelation", "=" )
	AddProperty( loFilter, "FieldValue", Transform( nPagina ) )

	This.AddFilter( loFilter )

	If !Empty( nPageSize )
		loFilter = Createobject( "Empty" )
		AddProperty( loFilter, "Nombre", "SetPageSize" )
		AddProperty( loFilter, "FieldName", "current_size" )
		AddProperty( loFilter, "FieldRelation", "=" )
		AddProperty( loFilter, "FieldValue", Transform( nPageSize ) )

		This.AddFilter( loFilter )

	Endif

	This.Filtrar()

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


Endtry

ENDPROC
PROCEDURE ledit_assign
#INCLUDE "FW\Comunes\Include\Praxis.h"

Lparameters tlEdit
Local loColumn As Column
Local loRegistro As Object
Local lnRecno As Integer
Local lcCommand As String
Local llEnable As Boolean

Try

    lcCommand = ""
    llEnable = .F.

    If tlEdit # This.Ledit

        If !tlEdit

            If This.AllowExit()
                This.RevertTable( .T., This.cCursorDeTrabajo )

                This.Botones.cmdEdit.Picture = 'FW\COMUNES\IMAGE\BMP\EDIT.GIF'
                This.Botones.cmdEdit.ToolTipText = "Editar los registros"
                This.Botones.cmdEdit.Caption = "Editar"
                *This.cmdCerrar.Enabled = .T.

                This.Ledit = tlEdit


            Else
                tlEdit = .T.

            Endif

        Endif

        If tlEdit

            If This.lEditarEnGrilla = .F.
                loBiz = This.oBiz

                Select Alias( This.cCursorDeTrabajo )
                Scatter Memo Name loRegistro
                If Empty( loRegistro.ABM )
                    loRegistro.ABM = ABM_MODIFICACION
                Endif

                Thisform.Enabled = .F.


                Try

                    If loBiz.LaunchEditForm( loRegistro )
                        If This.lCommitInGrilla
                            Select Alias( This.cCursorDeTrabajo )
                            Locate For Id = loBiz.nId
                            Gather Name loRegistro

                        Else
                            *This.chkActivos.InteractiveChange()
                            This.CargarGrilla()
                            Locate For Id = loBiz.nId

                        Endif
                    EndIf

                Catch To loErr

                Finally


                Endtry

                Thisform.Enabled = .T.
                tlEdit = .F.

            Else
                This.Botones.cmdEdit.Picture = 'FW\COMUNES\IMAGE\BMP\CLOSE.BMP'
                This.Botones.cmdEdit.ToolTipText = "Cancelar la edición"
                This.Botones.cmdEdit.Caption = "Salir"
                *This.cmdCerrar.Enabled = .F.

                This.Ledit = tlEdit

            Endif

        Endif


        If This.lEditarEnGrilla = .F.
            For Each loColumn In This.Grid.Columns
                loColumn.ReadOnly 	= .T.
                loColumn.Enabled 	= .T.
            Endfor


        Else
            This.SwitchEditMode( tlEdit )

            For Each loColumn In This.Grid.Columns
                loColumn.Enabled 	= .T.
                loColumn.ReadOnly 	= !tlEdit

                If Upper( loColumn.Name ) = "_RECORDORDER"
                    loColumn.ReadOnly 	= .T.
                    loColumn.Enabled 	= .F.
                Endif
            Endfor

            This.chkMuestraCamposEspeciales.Enabled = !tlEdit
            This.chkEditarEnGrilla.Enabled 			= !tlEdit

        Endif

        Try

            Thisform.Ledit = This.Ledit

        Catch To oErr

        Finally

        Endtry


        This.SynchronizeButtons()
        This.Refresh()


        This.cntPagination.Enabled = !tlEdit
        This.chkActivos.Enabled = !tlEdit
        This.cntSearch.Enabled = !tlEdit

    Endif

Catch To loErr
    Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
    loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
    loError.cRemark = lcCommand
    loError.Process ( m.loErr )
    Throw loError

Finally
    If llEnable
        Thisform.Enabled = .T.
    Endif


Endtry


ENDPROC
PROCEDURE obiz_access
Local lcCommand As String
Local loTabla As Archivo Of "Clientes\Utiles\Prg\utRutina.prg"


Try

    lcCommand = ""
    If Vartype( This.oBiz ) # "O"

        If !Empty( This.cClassName )
            If Empty( This.cClassLibrary )
                TEXT To lcMsg NoShow TextMerge Pretext 03
				Debe indicar la Librería en la propiedad "cClassLibrary "

				Grilla: "<<This.Name>>"
				Formulario: "<<Thisform.Name>>"
                ENDTEXT

                Stop( lcMsg, "Alerta al Desarrollador" )

            Else
                This.oBiz = Newobject( This.cClassName, This.cClassLibrary )

            Endif

        Else
            If !Empty( This.cTable )
                loTabla = GetTable( This.cTable )
            Endif

            If Vartype( loTabla ) # "O"
                If Empty( This.cClassName ) Or Empty( This.cClassLibrary )
                    TEXT To lcMsg NoShow TextMerge Pretext 03
					Debe indicar la tabla en la propiedad "cTable"

					Grilla: "<<This.Name>>"
					Formulario: "<<Thisform.Name>>"
                    ENDTEXT

                    Stop( lcMsg, "Alerta al Desarrollador" )

                Endif

            Endif

            This.oBiz = GetEntity( loTabla.cModelo )

        Endif

        This.oBiz.cTrace = Thisform.Name + "/" + This.Name

        This.lEditarEnGrilla 					= This.oBiz.lEditInBrowse
        This.chkEditarEnGrilla.Value 			= This.lEditarEnGrilla
        This.chkEditarEnGrilla.Visible 			= This.oBiz.lShowEditInBrowse
        This.chkMuestraCamposEspeciales.Visible = This.oBiz.lShowCamposEspeciales


    Endif

Catch To loErr
    Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
    loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
    loError.cRemark = lcCommand
    loError.Process ( m.loErr )
    Throw loError

Finally


Endtry

Return This.oBiz

ENDPROC
PROCEDURE odisplaycontrol_access
Local lcCommand As String
Local loDisplayControl As cGridForm Of "FW\Comunes\vcx\_Controles_Base.prg"

Try

	lcCommand = ""
	If Vartype( This.oDisplayControl ) # "O"
		loDisplayControl = Newobject( This.cDisplayControlClassName, ;
			This.cDisplayControlClassLibrary )
			
		loDisplayControl.oControl 	= This
		This.oDisplayControl 		= loDisplayControl

	Endif

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


Endtry

Return This.oDisplayControl

ENDPROC
PROCEDURE recuperar
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lcCommand As String

Try

	lcCommand = ""

	TEXT To lcCommand NoShow TextMerge Pretext 15
	Replace ABM With <<ABM_MODIFICACION>> in <<This.cCursorDeTrabajo>>
	ENDTEXT

	&lcCommand

	This.UpdateTable( .F., .T., This.cCursorDeTrabajo )

	This.Grid.SetFocus()

	TEXT To lcCommand NoShow TextMerge Pretext 15
	Skip in <<This.cCursorDeTrabajo>>
	ENDTEXT

	&lcCommand

	If Eof()
		TEXT To lcCommand NoShow TextMerge Pretext 15
		Skip -2 in <<This.cCursorDeTrabajo>>
		ENDTEXT

		&lcCommand
	Endif


Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )


Finally


Endtry

ENDPROC
PROCEDURE removefilter
Lparameters cFilterName as String
Local lcCommand as String
Local loFiltros As CollectionBase Of Tools\Namespaces\Prg\CollectionBase.Prg

Try

	lcCommand = ""
	loFiltros = This.oFilters
	loFiltros.RemoveItem( Lower( cFilterName ))

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally
	loFiltros = Null


EndTry

ENDPROC
PROCEDURE reverttable
Lparameters lAllRows, cTableAlias

Local lcCommand as String
Local lnRecords as Integer

Try

	lcCommand = ""
	lnRecords = 0
	
	* RA 14/09/2021(08:56:54)
	* Volver a cargar desde el BackEnd
	
	If Empty( cTableAlias )
		cTableAlias = Alias()
	EndIf
	
	If Used( cTableAlias )
		If InList( CursorGetProp( "Buffering", cTableAlias ), 3, 5 )
			lnRecords = TableRevert( lAllRows, cTableAlias )
			
		Else
			
			* Eliminar los registros agregados
			Text To lcCommand NoShow TextMerge Pretext 15
			Delete For ABM = <<ABM_ALTA>> In <<cTableAlias>>
			EndText

			&lcCommand
			lcCommand = ""
			
			* Quitar las marcas de Borrado y Modificado
			Text To lcCommand NoShow TextMerge Pretext 15
			Replace all ABM With 0 In <<cTableAlias>>
			EndText

			&lcCommand
			lcCommand = ""
			
		Endif
		
	EndIf
	

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	
	
EndTry

Return lnRecords

ENDPROC
PROCEDURE switcheditmode
Lparameters lEditing as Boolean

Local lcCommand as String

Try

	lcCommand = ""
	
	lnGridWith = This.Grid.Width
	
    This.Grid.oTable 			= Null
    This.Grid.oColGridLayout 	= Null
	This.grid.lShowItemNum 		= lEditing
	Thisform.BindControls 		= .F.
	This.ArmarGrilla()
	This.AutoSize()

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


EndTry

ENDPROC
PROCEDURE synchronizebuttons
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lcCommand As String,;
	lcAlias As String
Local lnABM As Integer

Local loBiz As oModelo Of "FrontEnd\Prg\Modelo.prg"


Try

	lcCommand = ""

	lcAlias = This.cCursorDeTrabajo
	lnABM = Evaluate( lcAlias + ".ABM" )
	
	loBiz = This.oBiz
	
	This.spnColumnsLock.Value 		= This.spnColumnsLock.Value
	
*!*	    Thisform.chkEditarEnGrilla.Value 			= loBiz.lEditInBrowse
*!*	    Thisform.chkEditarEnGrilla.Visible 			= loBiz.lShowEditInBrowse
    This.chkMuestraCamposEspeciales.Visible = loBiz.lShowCamposEspeciales

    If Empty( loBiz.cFormIndividual )
		This.chkEditarEnGrilla.Value = .T.
		This.chkEditarEnGrilla.Visible = .F.
		
	Else
		This.chkEditarEnGrilla.Visible = loBiz.lShowEditInBrowse
		This.chkEditarEnGrilla.Value = .F.
		
    EndIf
	

	If This.lEditarEnGrilla = .T.

		Do Case
			Case Thisform.lIngTip = .T. ;
					And Thisform.CLAVE > 0 ;
					And Thisform.lIngTipActivo = .T.

				This.Botones.CmdFiltrar.Enabled 	= .F.
				This.Botones.CmdEdit.Enabled 		= .F.
				This.Botones.CmdAgregar.Enabled 	= .F.
				This.Botones.CmdBorrar.Enabled 		= .F.
				This.Botones.CmdRecuperar.Enabled 	= .F.
				This.Botones.cmdAplicar.Enabled 	= .F.

			Case !This.lGridLoaded And !This.Ledit
				This.Botones.CmdFiltrar.Enabled 	= .F.
				This.Botones.CmdEdit.Enabled 		= .F.
				This.Botones.CmdAgregar.Enabled 	= .T.
				This.Botones.CmdBorrar.Enabled 		= .F.
				This.Botones.CmdRecuperar.Enabled 	= .F.
				This.Botones.cmdAplicar.Enabled 	= .F.

			Case !This.Ledit
				This.Botones.CmdFiltrar.Enabled 	= .T.
				This.Botones.CmdEdit.Enabled 		= .T.	&& Editar
				This.Botones.CmdAgregar.Enabled 	= .F.
				This.Botones.CmdBorrar.Enabled 		= .F.
				This.Botones.CmdRecuperar.Enabled 	= .F.
				This.Botones.cmdAplicar.Enabled 	= .F.

			Case Eof() Or Bof()
				This.Botones.CmdFiltrar.Enabled 	= .F.
				This.Botones.CmdEdit.Enabled 		= .T.	&& Salir
				This.Botones.CmdAgregar.Enabled 	= .T.
				This.Botones.CmdBorrar.Enabled 		= .F.
				This.Botones.CmdRecuperar.Enabled 	= .F.
				This.Botones.cmdAplicar.Enabled 	= .F.

			Case Inlist( lnABM, 0, ABM_ALTA, ABM_MODIFICACION )
				This.Botones.CmdFiltrar.Enabled 	= .F.
				This.Botones.CmdEdit.Enabled 		= .T.	&& Salir
				This.Botones.CmdAgregar.Enabled 	= .T.
				This.Botones.CmdBorrar.Enabled 		= .T.
				This.Botones.CmdRecuperar.Enabled 	= .F.
				This.Botones.cmdAplicar.Enabled 	= .T.

			Case Inlist( lnABM, ABM_BAJA )
				This.Botones.CmdFiltrar.Enabled 	= .F.
				This.Botones.CmdEdit.Enabled 		= .T.	&& Salir
				This.Botones.CmdAgregar.Enabled 	= .T.
				This.Botones.CmdBorrar.Enabled 		= .F.
				This.Botones.CmdRecuperar.Enabled 	= .T.
				This.Botones.cmdAplicar.Enabled 	= .T.

			Otherwise

		Endcase

		This.chkActivos.Enabled = This.Botones.CmdFiltrar.Enabled

	Else

		This.Botones.CmdFiltrar.Visible 	= .F.
		This.Botones.CmdRecuperar.Visible 	= .F.
		This.Botones.cmdAplicar.Visible  	= .F.

		Do Case
			Case !This.lGridLoaded And !This.Ledit
				This.Botones.CmdEdit.Enabled 		= .F.
				This.Botones.CmdAgregar.Enabled 	= .T.
				This.Botones.CmdBorrar.Enabled 		= .F.

			Case !This.Ledit
				This.Botones.CmdEdit.Enabled 		= .T.
				This.Botones.CmdAgregar.Enabled 	= .T.
				This.Botones.CmdBorrar.Enabled 		= .T.

			Case Eof() Or Bof()
				This.Botones.CmdEdit.Enabled 		= .F.
				This.Botones.CmdAgregar.Enabled 	= .T.
				This.Botones.CmdBorrar.Enabled 		= .F.

			Otherwise

		Endcase

		This.chkActivos.Enabled = .T.

	Endif

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )


Finally
	loBiz = Null


Endtry

ENDPROC
PROCEDURE updatetable
Lparameters lAllRows, lForce, cTableAlias

Local lcCommand as String
Local llOk as Boolean

Try

	lcCommand = ""
	llOk = .T.
	
	If Empty( cTableAlias )
		cTableAlias = Alias()
	EndIf
	
	If Used( cTableAlias ) And InList( CursorGetProp( "Buffering", cTableAlias ), 3, 5 )
		llOk = TableUpdate( lAllRows, lForce, cTableAlias )
	EndIf
	

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	
	
EndTry

Return llOk

ENDPROC
[END METHODS]
[START RESERVED1]
Class[END RESERVED1]
[START RESERVED2]
11[END RESERVED2]
[START RESERVED3]
_memberdata XML Metadata for customizable properties
cmaincursorname
obiz
ledit
ccursordetrabajo
nbufferingcursortrabajo
leditarengrilla
lgridloaded
lgridempty
leditonload
ofilters
cclassname Nombre de la Clase para obtener oBiz
cclasslibrary Nombre de la libreria para obtener oBiz
lautosize Indica si se ejecuta el metodo Autosize()
lcommitingrilla Si edita en Form, puede ser que el commit lo realice el Form, o solo se edite, y el commit final lo realice la grilla (Ej: Comprobantes)
lautomaticdisplay Indica si utiliza la clase de negocios para el deploy automático
ncolumnsspan El Form se divide en 12 columnas virtuales. Indica cuantas columnas ocupa, con Label incluído
nleftcolumn Columna donde se posiciona el control (con el label incluído, en caso de que el mismo estuviera a la izquierda)
nrowspan En caso de controles tipo Grilla o EditBox, indica cuantas filas ocupa
ntoprow Nº de fila donde se posiciona el control (Con el label incluido en caso caso de que el mismo estuviera arriba o abajo)
nwidth Ancho Total del Control en pixeles. (Label incluido)
cdisplaycontrolclassname Nombre de la Clase de Negocios
cdisplaycontrolclasslibrary Nombre de la librería donde se encuentra la Clase de Negocios
odisplaycontrol Referencia a la clase que controla el display automático
ctable Nombre de la Tabla para usar en GetEntity para obter oBiz
*armargrilla 
*crearcursordetrabajo 
*actualizarcursorprincipal 
*borrar 
*agregar 
*recuperar 
*synchronizebuttons 
*cmaincursorname_access 
*obiz_access 
*cargargrilla 
*editar 
*ledit_assign 
*updatetable 
*reverttable 
*allowexit 
*autosize Specifies if a control is automatically resized to fit its contents.
*addfilter 
*removefilter 
*filtrar 
*aplicar 
*cargarfiltrosiniciales 
*initialize 
*ccursordetrabajo_access 
*odisplaycontrol_access 
*initializerows 
*afterbindcontrols 
*irpagina 
*hookafterfill 
*switcheditmode 
[END RESERVED3]
[START RESERVED6]
Pixels[END RESERVED6]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _65O13C1G6
[CLASS] browsegrid
[CLASSLOC] prxbrowse.vcx
[BASECLASS] grid
[OBJNAME] Grid
[PARENT] gridinform
[START PROPERTIES]
Height = 239
Left = 0
TabIndex = 2
Top = 48
Width = 312
_memberdata =     2473<VFPData><memberdata name="performlayout" display="PerformLayout"/><memberdata name="adjustfitcolumn" display="AdjustFitColumn"/><memberdata name="fill" display="Fill"/><memberdata name="empty" display="Empty"/><memberdata name="setgridlayout" display="SetGridLayout"/><memberdata name="autosetup" display="AutoSetup"/><memberdata name="ocolgridlayout" display="oColGridLayout"/><memberdata name="cfitcolumn" display="cFitColumn"/><memberdata name="cfitcolumn_access" display="cFitColumn_Access"/><memberdata name="ocolgridlayout_access" display="oColGridLayout_Access"/><memberdata name="otable" display="oTable"/><memberdata name="otable_access" display="oTable_Access"/><memberdata name="cmaincursorname" display="cMainCursorName"/><memberdata name="cmaincursorname_access" display="cMainCursorName_Access"/><memberdata name="definetable" display="DefineTable"/><memberdata name="lcastdatetime" display="lCastDateTime"/><memberdata name="lperformautosetup" display="lPerformAutoSetUp" favorites="True"/><memberdata name="noriginalwidth" display="nOriginalWidth"/><memberdata name="lischeckfitcolumn" display="lIsCheckFitColumn"/><memberdata name="columnmouseenter" display="ColumnMouseEnter"/><memberdata name="columnmouseleave" display="ColumnMouseLeave"/><memberdata name="nstatus" display="nStatus"/><memberdata name="beforedefinetable" display="BeforeDefineTable"/><memberdata name="oparam" display="oParam"/><memberdata name="cerrormessage" display="cErrorMessage"/><memberdata name="obiz" display="oBiz"/><memberdata name="obiz_access" display="oBiz_Access"/><memberdata name="ccursordetrabajo" display="cCursorDeTrabajo"/><memberdata name="ccursordetrabajo_access" display="cCursorDeTrabajo_Access"/><memberdata name="lperdiendoelfoco" display="lPerdiendoElFoco"/><memberdata name="ocolumn" display="oColumn"/><memberdata name="lusesdatadictionary" display="lUsesDataDictionary" favorites="True"/><memberdata name="reverttable" display="RevertTable"/><memberdata name="updatetable" display="UpdateTable"/><memberdata name="lusenamespaces" display="lUseNameSpaces"/><memberdata name="lusenamespaces_access" display="lUseNameSpaces_Access"/><memberdata name="getcoldata" display="GetColData"/><memberdata name="neditionmode" display="nEditionMode"/><memberdata name="lshowitemnum" display="lShowItemNum"/><memberdata name="leditando" display="lEditando"/><memberdata name="width" display="Width"/><memberdata name="width_assign" display="Width_Assign"/></VFPData>

Name = "Grid"
[END PROPERTIES]
[START METHODS]
PROCEDURE Destroy

Local lcCommand As String

Try

	lcCommand = ""

	With This As BrowseGrid Of Fw\Comunes\vcx\prxbrowse.vcx
		.oColumn 		= Null
		.oTable 		= Null
		.oColGridLayout = Null
		.oBiz 			= Null
	Endwith
	Unbindevents( This )


Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally


Endtry

ENDPROC
PROCEDURE KeyPress
#INCLUDE "FW\Comunes\Include\Praxis.h"

Lparameters nKeyCode, nShiftAltCtrl

If This.nEditionMode = 1 && Por columnas en vez de por filas
	If Inlist( nKeyCode, KEY_ENTER, KEY_TAB )

		Thisform.LockScreen = .T.
		Keyboard '{LEFTARROW}' + '{DNARROW}' Clear
		This.Refresh()
		Thisform.LockScreen = .F.

	Endif

Else
	If !This.Parent.lEdit
		If !This.lEditando
			If nKeyCode = KEY_ENTER
				Keyboard '{HOME}' Clear
				This.lEditando = .T.
				This.Parent.Editar()
			Endif
		Else
			This.lEditando = .F.

		Endif
	Endif
Endif


ENDPROC
PROCEDURE beforedefinetable
Local lcCommand As String
Local loTable As oTable Of "Tools\DataDictionary\prg\oTable.prg"
Local loField As oField Of "Tools\DataDictionary\prg\oField.prg"
Local loUser As User Of "Fw\TierAdapter\Comun\prxUser.prg"


Try

    lcCommand = ""

    loTable = DoDefault()

    If This.lShowItemNum And This.Parent.chkMuestraCamposEspeciales.Value = .T.

        loUser = NewUser()

        For Each loField In loTable.oColFields
            If Inlist( Upper( loField.Name), "ORDEN", "ACTIVO", "ES_SISTEMA" )
                Do Case
                    Case Upper( loField.Name) = "ACTIVO" And loUser.lModificaActivo
                        loField.lShowInGrid = .T.

                    Case Upper( loField.Name) = "ORDEN" And loUser.lModificaOrden
                        loField.lShowInGrid = .T.

                    Case Upper( loField.Name) = "ES_SISTEMA" And loUser.lModificaEsSistema
                        loField.lShowInGrid = .T.

                Endcase

            Endif

        Endfor

    Endif

Catch To oErr
    Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
    loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
    loError.Cremark = lcCommand
    loError.Process( oErr )
    Throw loError

Finally
    loUser = Null


Endtry

Return loTable

ENDPROC
PROCEDURE cmaincursorname_access

If Empty( This.cMainCursorName )
	This.cMainCursorName = This.Parent.cMainCursorName
EndIf

Return This.cMainCursorName

ENDPROC
PROCEDURE obiz_access
If Vartype( This.oBiz ) # "O"
	This.oBiz = This.Parent.oBiz
Endif

Return This.oBiz

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _65O13C1GC
[CLASS] brwbuttons
[CLASSLOC] prxbrowse.vcx
[BASECLASS] container
[OBJNAME] Botones
[PARENT] gridinform
[START PROPERTIES]
Top = 150
Left = 324
Height = 135
TabIndex = 3
Name = "Botones"
cmdAgregar.Top = 0
cmdAgregar.ZOrderSet = 1
cmdAgregar.Name = "cmdAgregar"
cmdBorrar.ZOrderSet = 2
cmdBorrar.Name = "cmdBorrar"
cmdRecuperar.ZOrderSet = 3
cmdRecuperar.Name = "cmdRecuperar"
cmdEdit.ZOrderSet = 4
cmdEdit.Name = "cmdEdit"
cmdFiltrar.Visible = .F.
cmdFiltrar.ZOrderSet = 0
cmdFiltrar.Name = "cmdFiltrar"
cmdAplicar.Top = 108
cmdAplicar.Name = "cmdAplicar"
[END PROPERTIES]
[START METHODS]
PROCEDURE cmdAgregar.Click
This.Parent.Parent.Agregar()

ENDPROC
PROCEDURE cmdAplicar.Click
This.Parent.Parent.Aplicar()
ENDPROC
PROCEDURE cmdBorrar.Click
This.Parent.Parent.Borrar()
ENDPROC
PROCEDURE cmdEdit.Click
This.Parent.Parent.Editar()
ENDPROC
PROCEDURE cmdFiltrar.Click
NoDefault
ENDPROC
PROCEDURE cmdRecuperar.Click
This.Parent.Parent.Recuperar()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _65O13LY6E
[CLASS] checkbox
[BASECLASS] checkbox
[OBJNAME] chkActivos
[PARENT] gridinform
[START PROPERTIES]
Top = 24
Left = 0
Height = 17
Width = 60
Alignment = 0
BackStyle = 0
Caption = "Activos"
Value = .T.
TabIndex = 7
Name = "chkActivos"
[END PROPERTIES]
[START METHODS]
PROCEDURE InteractiveChange
Local lcCommand As String
Local loFilter As Object

Try

	lcCommand = ""
	If This.Value = .T.
		loFilter = Createobject( "Empty" )
		AddProperty( loFilter, "Nombre", "Activos" )
		AddProperty( loFilter, "FieldName", "activo" )
		AddProperty( loFilter, "FieldRelation", "==" )
		AddProperty( loFilter, "FieldValue", "True" )

		This.Parent.AddFilter( loFilter )

	Else
		This.Parent.RemoveFilter( "Activos" )

	Endif

	This.Parent.Filtrar()

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally
	loFilter = Null


Endtry

ENDPROC
PROCEDURE ProgrammaticChange
This.InteractiveChange()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _65O13ZM52
[CLASS] label
[BASECLASS] label
[OBJNAME] lblTitulo
[PARENT] gridinform
[START PROPERTIES]
AutoSize = .T.
FontName = "Verdana"
FontSize = 14
BackStyle = 0
Caption = "Título"
Height = 25
Left = 0
Top = 0
Width = 57
TabIndex = 8
ForeColor = 0,64,128
Name = "lblTitulo"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _65Q0Q8LUO
[CLASS] spinner
[BASECLASS] spinner
[OBJNAME] spnColumnsLock
[PARENT] gridinform
[START PROPERTIES]
Anchor = 9
Height = 24
InputMask = "99"
KeyboardHighValue = 99
KeyboardLowValue = 0
Left = 364
SpinnerHighValue =  99.00
SpinnerLowValue =   0.00
TabIndex = 6
Top = 0
Visible = .F.
Width = 48
Value = 1
Name = "spnColumnsLock"
[END PROPERTIES]
[START METHODS]
PROCEDURE InteractiveChange
Local lcCommand As String

Try

	lcCommand = ""
	If This.Parent.Grid.ColumnCount > 0
		This.Parent.Grid.LockColumns = This.Value
		This.Parent.Grid.Refresh()
	Endif

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )


Finally


Endtry

ENDPROC
PROCEDURE ProgrammaticChange
This.InteractiveChange()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _65Q0Q8LUQ
[CLASS] label
[BASECLASS] label
[OBJNAME] lblColumsLock
[PARENT] gridinform
[START PROPERTIES]
AutoSize = .T.
Anchor = 9
BackStyle = 0
Caption = "Columnas fijas"
Height = 17
Left = 276
Top = 0
Visible = .F.
Width = 86
TabIndex = 9
Name = "lblColumsLock"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _65Q0Q8LUR
[CLASS] checkbox
[BASECLASS] checkbox
[OBJNAME] chkEditarEnGrilla
[PARENT] gridinform
[START PROPERTIES]
Top = 100
Left = 324
Height = 36
Width = 91
WordWrap = .T.
Alignment = 0
BackStyle = 0
Caption = "Editar en Grilla"
Value = .F.
TabIndex = 5
Visible = .F.
Name = "chkEditarEnGrilla"
[END PROPERTIES]
[START METHODS]
PROCEDURE InteractiveChange
This.Parent.lEditarEnGrilla 	= This.Value
This.Parent.oBiz.lEditInBrowse  = This.Value

ENDPROC
PROCEDURE MouseDown
Lparameters nButton, nShift, nXCoord, nYCoord

Do Case
	Case nButton = 2 And nShift = 0 && Right Click
		If This.Value = .T.
			lcStr = "en la Grilla"
		Else
			lcStr = "en un un nuevo formulario"

		Endif


		Text To lcMsg NoShow TextMerge Pretext 03
		Edita el registro actual
		<<lcStr>>
		EndText


		Inform( lcMsg, "Edita en Grilla", -1 )

Endcase

ENDPROC
PROCEDURE ProgrammaticChange
This.InteractiveChange()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _66T15ZOLV
[CLASS] brwpagination
[CLASSLOC] prxbrowse.vcx
[BASECLASS] container
[OBJNAME] cntPagination
[PARENT] gridinform
[START PROPERTIES]
Top = 299
Left = 0
TabIndex = 4
Name = "cntPagination"
LBLREGISTROS.Name = "LBLREGISTROS"
LBLPAGINA.Name = "LBLPAGINA"
SPNPAGINA.Name = "SPNPAGINA"
BTNPRIMERO.Name = "BTNPRIMERO"
BTNSIGUIENTE.Name = "BTNSIGUIENTE"
BTNANTERIOR.Name = "BTNANTERIOR"
BTNULTIMO.Name = "BTNULTIMO"
LBLDE_99.Name = "LBLDE_99"
CMDPAGINA.Name = "CMDPAGINA"
SPNPAGESIZE.Name = "SPNPAGESIZE"
LBLPAGESIZE.Name = "LBLPAGESIZE"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _66T15ZOLY
[CLASS] brwsearch
[CLASSLOC] prxbrowse.vcx
[BASECLASS] container
[OBJNAME] cntSearch
[PARENT] gridinform
[START PROPERTIES]
Anchor = 11
Top = 24
Left = 60
Width = 252
Visible = .F.
TabIndex = 1
Name = "cntSearch"
TXTSEARCH.Width = 228
TXTSEARCH.Name = "TXTSEARCH"
BTNSEARCH.Left = 228
BTNSEARCH.Name = "BTNSEARCH"
[END PROPERTIES]
[START METHODS]
PROCEDURE buscar
Local lcCommand As String,;
	lcSearchString As String

Try

	lcCommand = ""

	If !Empty( This.txtSearch.Value )
		This.Parent.IrPagina( 1 )
	Endif

	DoDefault()

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally
	loFiltro = Null


Endtry

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _6F10REQGQ
[CLASS] checkbox
[BASECLASS] checkbox
[OBJNAME] chkMuestraCamposEspeciales
[PARENT] gridinform
[START PROPERTIES]
Top = 48
Left = 320
Height = 48
Width = 96
WordWrap = .T.
Alignment = 0
BackStyle = 0
Caption = "Muestra Activo y Orden"
Value = .F.
TabIndex = 6
Visible = .F.
Name = "chkMuestraCamposEspeciales"
[END PROPERTIES]
[START METHODS]
PROCEDURE InteractiveChange
If This.Value = .T.
    This.Parent.chkEditarEnGrilla.Visible = .T.
Endif

ENDPROC
PROCEDURE MouseDown
Lparameters nButton, nShift, nXCoord, nYCoord

Do Case
	Case nButton = 2 And nShift = 0 && Right Click

		Text To lcMsg NoShow TextMerge Pretext 03
		Muestra los campos Activo y Orden
		EndText


		Inform( lcMsg, "Muestra campos especiales", -1 )

Endcase

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] RESERVED  
[OBJNAME] gridinform
[START PROPERTIES]
Arial, 0, 9, 5, 15, 12, 32, 3, 0
[END PROPERTIES]
[START RESERVED1]
  ..\include\praxis.h~ÐnfdV ..\include\foxpro.hÑÊrûF ..\include\strings.hÒZOJ* ..\..\..\tools\namespaces\include\system.hÓ±ÙF[END RESERVED1]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _66R13OTV5
[CLASS] container
[BASECLASS] container
[OBJNAME] brwpagination
[START PROPERTIES]
Width = 384
Height = 48
BackStyle = 0
Enabled = .T.
Visible = .F.
_memberdata =      615<VFPData><memberdata name="primero" display="Primero"/><memberdata name="ultimo" display="Ultimo"/><memberdata name="siguiente" display="Siguiente"/><memberdata name="anterior" display="Anterior"/><memberdata name="visible" display="Visible"/><memberdata name="visible_assign" display="Visible_Assign"/><memberdata name="obiz" display="oBiz"/><memberdata name="obiz_access" display="oBiz_Access"/><memberdata name="sincronizar" display="Sincronizar"/><memberdata name="irpagina" display="IrPagina"/><memberdata name="enabled" display="Enabled"/><memberdata name="enabled_assign" display="Enabled_Assign"/></VFPData>
obiz = .NULL.
Name = "brwpagination"
[END PROPERTIES]
[START METHODS]
PROCEDURE Init
Local lcCommand as String

Try

	lcCommand = ""
	This.BorderWidth = 0
	
	* RA 19/11/2022(10:38:24) (Jorge)
	This.lblPageSize.Visible = .F.
	This.spnPageSize.Visible = .F.
	
	
Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


EndTry

ENDPROC
PROCEDURE MouseDown
Lparameters nButton, nShift, nXCoord, nYCoord

Do Case
	Case nButton = 2 And nShift = 0 && Right Click
		Text To lcMsg NoShow TextMerge Pretext 03
		Permite navegar por las páginas
		y seleccionar la cantidad de registros
		por página.
		EndText


		Inform( lcMsg, "Paginación", -1 )

Endcase

ENDPROC
PROCEDURE anterior
Local lcCommand as String
Local loBiz As oModelo Of "FrontEnd\Prg\Modelo.prg"

Try

	lcCommand = ""
	loBiz = This.oBiz

	This.IrPagina( loBiz.nCurrentPage - 1 )

Catch To loErr
*!*		Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
*!*		loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
*!*		loError.cRemark = lcCommand
*!*		loError.Process ( m.loErr )
*!*		Throw loError

Finally
	loBiz = Null


EndTry

ENDPROC
PROCEDURE enabled_assign
lparameters tEnabled
This.Enabled = tEnabled
If tEnabled
	This.Sincronizar()

Else
	This.SetAll( "Enabled", .F. )
	
Endif



ENDPROC
PROCEDURE irpagina
Lparameters nPagina as Integer

Local lcCommand as String
Local loBiz As oModelo Of "FrontEnd\Prg\Modelo.prg"
Local lnPagina as Integer

Try

	lcCommand = ""
	loBiz = This.oBiz
	loBiz.nPageSize = This.spnPageSize.Value
	
	If Empty( nPagina )
		lnPagina = This.spnPagina.Value
		
	Else
		lnPagina = nPagina
		 	
	EndIf

	This.Parent.IrPagina( lnPagina, This.spnPageSize.Value )

Catch To loErr
*!*		Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
*!*		loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
*!*		loError.cRemark = lcCommand
*!*		loError.Process ( m.loErr )
*!*		Throw loError

Finally
	loBiz = Null


EndTry

ENDPROC
PROCEDURE obiz_access
Local lcCommand As String

Try

	lcCommand = ""
	If Vartype( This.oBiz ) # "O"
		This.oBiz = This.Parent.oBiz
	Endif

Catch To loErr
	*!*		Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	*!*		loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	*!*		loError.cRemark = lcCommand
	*!*		loError.Process ( m.loErr )
	*!*		Throw loError

Finally


Endtry

Return This.oBiz

ENDPROC
PROCEDURE primero
Local lcCommand as String

Try

	lcCommand = ""
	This.IrPagina( 1 )

Catch To loErr
*!*		Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
*!*		loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
*!*		loError.cRemark = lcCommand
*!*		loError.Process ( m.loErr )
*!*		Throw loError

Finally


EndTry

ENDPROC
PROCEDURE siguiente
Local lcCommand as String
Local loBiz As oModelo Of "FrontEnd\Prg\Modelo.prg"

Try

	lcCommand = ""
	loBiz = This.oBiz
	
	This.IrPagina( loBiz.nCurrentPage + 1 )

Catch To loErr
*!*		Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
*!*		loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
*!*		loError.cRemark = lcCommand
*!*		loError.Process ( m.loErr )
*!*		Throw loError

Finally
	loBiz = Null


EndTry

ENDPROC
PROCEDURE sincronizar
Local lcCommand As String
Local loBiz As oModelo Of "FrontEnd\Prg\Modelo.prg"
Local llVisible As Boolean

Try

    lcCommand = ""
    loBiz = This.oBiz

    This.spnPageSize.Value = loBiz.nPageSize
    This.spnPagina.KeyboardHighValue = loBiz.nLastPage
    This.spnPagina.SpinnerHighValue = loBiz.nLastPage

    If loBiz.nTotalDeRegistros > 0
        This.lblRegistros.Caption = Transform( loBiz.nTotalDeRegistros ) + " Registros Encontrados"
        This.spnPagina.Value = loBiz.nCurrentPage
        This.lblDe_99.Caption = "de " + Transform( loBiz.nLastPage )

        This.lblRegistros.ForeColor = Rgb(0,0,0)

        If loBiz.nCurrentPage = loBiz.nLastPage
            This.btnSiguiente.Enabled = .F.
            This.btnUltimo.Enabled = .F.

        Else
            This.btnSiguiente.Enabled = .T.
            This.btnUltimo.Enabled = .T.

        Endif

        If loBiz.nCurrentPage = 1
            This.BtnAnterior.Enabled = .F.
            This.BtnPrimero.Enabled = .F.

        Else
            This.BtnAnterior.Enabled = .T.
            This.BtnPrimero.Enabled = .T.

        Endif

    Else
        This.lblRegistros.Caption = "No se han encontrado registros"
        This.lblRegistros.ForeColor = Rgb(255,0,0)

        This.spnPagina.KeyboardHighValue = This.spnPagina.KeyboardLowValue
        This.spnPagina.SpinnerHighValue = This.spnPagina.SpinnerLowValue


    Endif

    llVisible = loBiz.nLastPage > 1

    This.lblPagina.Visible = llVisible
    This.spnPagina.Visible = llVisible
    This.lblDe_99.Visible = llVisible

    * RA 19/11/2022(10:57:16) (Jorge)
    *!*		This.lblPageSize.Visible = llVisible
    *!*		This.spnPageSize.Visible = llVisible

    This.btnPrimero.Visible = llVisible
    This.btnSiguiente.Visible = llVisible
    This.btnAnterior.Visible = llVisible
    This.btnUltimo.Visible = llVisible


Catch To loErr
    Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
    loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
    loError.cRemark = lcCommand
    loError.Process ( m.loErr )
    Throw loError

Finally
    loBiz = Null


Endtry

ENDPROC
PROCEDURE ultimo
Local lcCommand as String
Local loBiz As oModelo Of "FrontEnd\Prg\Modelo.prg"

Try

	lcCommand = ""
	loBiz = This.oBiz

	This.IrPagina( loBiz.nLastPage )

Catch To loErr
*!*		Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
*!*		loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
*!*		loError.cRemark = lcCommand
*!*		loError.Process ( m.loErr )
*!*		Throw loError

Finally
	loBiz = Null


EndTry

ENDPROC
PROCEDURE visible_assign
Lparameters tVisible
Local loBiz As oModelo Of "FrontEnd\Prg\Modelo.prg"
Local lcCommand As String

Try

	lcCommand = ""

	This.Visible = tVisible
	This.SetAll( "Visible", tVisible )

	If tVisible
		loBiz = This.oBiz
		If loBiz.nTotalDeRegistros = 0
			This.SetAll( "Visible", .F. )
			
			This.lblRegistros.Visible = .T.
			
		Else
			*This.Sincronizar()	

		EndIf
		
		This.Sincronizar()	
		
	EndIf
	
	

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally
	* RA 19/11/2022(10:38:24) (Jorge)
	This.lblPageSize.Visible = .F.
	This.spnPageSize.Visible = .F.


Endtry

ENDPROC
[END METHODS]
[START RESERVED1]
Class[END RESERVED1]
[START RESERVED2]
12[END RESERVED2]
[START RESERVED3]
_memberdata XML Metadata for customizable properties
obiz
*primero 
*ultimo 
*siguiente 
*anterior 
*visible_assign 
*obiz_access 
*sincronizar Sincroniza todos los botones
*irpagina 
*enabled_assign 
[END RESERVED3]
[START RESERVED6]
Pixels[END RESERVED6]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SZ0O0RPF
[CLASS] label
[BASECLASS] label
[OBJNAME] lblRegistros
[PARENT] brwpagination
[START PROPERTIES]
Alignment = 2
BackStyle = 0
Caption = "1234 Registros Encontrados"
Height = 17
Left = 0
Top = 0
Visible = .F.
Width = 264
TabIndex = 7
Name = "lblRegistros"
[END PROPERTIES]
[START METHODS]
PROCEDURE MouseDown
Lparameters nButton, nShift, nXCoord, nYCoord

This.Parent.MouseDown( nButton, nShift, nXCoord, nYCoord )

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SZ0O0RPF
[CLASS] label
[BASECLASS] label
[OBJNAME] lblPagina
[PARENT] brwpagination
[START PROPERTIES]
AutoSize = .T.
BackStyle = 0
Caption = "Página"
Height = 17
Left = 60
Top = 23
Visible = .F.
Width = 41
TabIndex = 4
Name = "lblPagina"
[END PROPERTIES]
[START METHODS]
PROCEDURE MouseDown
LPARAMETERS nButton, nShift, nXCoord, nYCoord

This.Parent.MouseDown( nButton, nShift, nXCoord, nYCoord )
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SZ0O0RPF
[CLASS] spinner
[BASECLASS] spinner
[OBJNAME] spnPagina
[PARENT] brwpagination
[START PROPERTIES]
Height = 24
InputMask = "9999"
KeyboardHighValue = 1000
KeyboardLowValue = 1
Left = 108
SpinnerHighValue = 1000.00
SpinnerLowValue =   1.00
TabIndex = 1
Top = 18
Visible = .F.
Width = 60
Format = "K"
Name = "spnPagina"
[END PROPERTIES]
[START METHODS]
PROCEDURE DownClick
This.Parent.IrPagina()

ENDPROC
PROCEDURE KeyPress
LPARAMETERS nKeyCode, nShiftAltCtrl
#INCLUDE "FW\Comunes\Include\Praxis.h"


If nKeyCode = KEY_ENTER
	This.Parent.IrPagina()
EndIf
ENDPROC
PROCEDURE MouseDown
LPARAMETERS nButton, nShift, nXCoord, nYCoord

This.Parent.MouseDown( nButton, nShift, nXCoord, nYCoord )
ENDPROC
PROCEDURE UpClick
This.Parent.IrPagina()

ENDPROC
PROCEDURE Valid
If This.Value > This.KeyboardHighValue
	This.Value = This.KeyboardHighValue
EndIf

If This.Value < This.KeyboardLowValue
	This.Value = This.KeyboardLowValue
EndIf
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _66R14236M
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] btnPrimero
[PARENT] brwpagination
[START PROPERTIES]
Top = 18
Left = 0
Height = 24
Width = 22
Picture = ..\image\bmp\removeall.bmp
Caption = ""
TabIndex = 10
ToolTipText = "Primera"
Visible = .F.
Name = "btnPrimero"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
This.Parent.Primero()
ENDPROC
PROCEDURE MouseDown
LPARAMETERS nButton, nShift, nXCoord, nYCoord

This.Parent.MouseDown( nButton, nShift, nXCoord, nYCoord )
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3SZ0O0RPF
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] btnSiguiente
[PARENT] brwpagination
[START PROPERTIES]
Top = 18
Left = 240
Height = 24
Width = 22
Picture = ..\image\bmp\addone.bmp
Caption = ""
TabIndex = 2
ToolTipText = "Siguiente"
Visible = .F.
Name = "btnSiguiente"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
This.Parent.Siguiente()
ENDPROC
PROCEDURE MouseDown
LPARAMETERS nButton, nShift, nXCoord, nYCoord

This.Parent.MouseDown( nButton, nShift, nXCoord, nYCoord )
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _66R14236R
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] btnAnterior
[PARENT] brwpagination
[START PROPERTIES]
Top = 18
Left = 24
Height = 24
Width = 22
Picture = ..\image\bmp\removeone.bmp
Caption = ""
TabIndex = 5
ToolTipText = "Anterior"
Visible = .F.
Name = "btnAnterior"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
This.Parent.Anterior()
ENDPROC
PROCEDURE MouseDown
LPARAMETERS nButton, nShift, nXCoord, nYCoord

This.Parent.MouseDown( nButton, nShift, nXCoord, nYCoord )
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _66R14236T
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] btnUltimo
[PARENT] brwpagination
[START PROPERTIES]
Top = 19
Left = 264
Height = 24
Width = 22
Picture = ..\image\bmp\addall.bmp
Caption = ""
TabIndex = 3
ToolTipText = "Ultimo"
Visible = .F.
Name = "btnUltimo"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
This.Parent.Ultimo()
ENDPROC
PROCEDURE MouseDown
LPARAMETERS nButton, nShift, nXCoord, nYCoord

This.Parent.MouseDown( nButton, nShift, nXCoord, nYCoord )
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _66R14236V
[CLASS] label
[BASECLASS] label
[OBJNAME] lblDe_99
[PARENT] brwpagination
[START PROPERTIES]
AutoSize = .T.
BackStyle = 0
Caption = "de 99"
Height = 17
Left = 173
Top = 23
Visible = .F.
Width = 33
TabIndex = 8
Name = "lblDe_99"
[END PROPERTIES]
[START METHODS]
PROCEDURE MouseDown
LPARAMETERS nButton, nShift, nXCoord, nYCoord

This.Parent.MouseDown( nButton, nShift, nXCoord, nYCoord )
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _66S0MMU7T
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] cmdPagina
[PARENT] brwpagination
[START PROPERTIES]
Top = -100
Left = 156
Height = 24
Width = 12
Picture = ..\image\bmp\addone.bmp
Caption = ""
TabIndex = 11
ToolTipText = "Ir a la Página"
Visible = .F.
Name = "cmdPagina"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
This.Parent.IrPagina()
ENDPROC
PROCEDURE MouseDown
LPARAMETERS nButton, nShift, nXCoord, nYCoord

This.Parent.MouseDown( nButton, nShift, nXCoord, nYCoord )
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _66S0OYNQL
[CLASS] spinner
[BASECLASS] spinner
[OBJNAME] spnPageSize
[PARENT] brwpagination
[START PROPERTIES]
Height = 24
InputMask = "9999"
KeyboardHighValue = 1000
KeyboardLowValue = 1
Left = 295
SpinnerHighValue = 1000.00
SpinnerLowValue =   1.00
TabIndex = 6
Top = 19
Visible = .F.
Width = 60
Format = "K"
Value = 1
Name = "spnPageSize"
[END PROPERTIES]
[START METHODS]
PROCEDURE DownClick
This.Parent.spnPagina.Value = 1
This.Parent.IrPagina()

ENDPROC
PROCEDURE KeyPress
Lparameters nKeyCode, nShiftAltCtrl
#INCLUDE "FW\Comunes\Include\Praxis.h"


If nKeyCode = KEY_ENTER
	This.Parent.spnPagina.Value = 1
	This.Parent.IrPagina()
Endif

ENDPROC
PROCEDURE MouseDown
LPARAMETERS nButton, nShift, nXCoord, nYCoord

This.Parent.MouseDown( nButton, nShift, nXCoord, nYCoord )
ENDPROC
PROCEDURE UpClick
This.Parent.spnPagina.Value = 1
This.Parent.IrPagina()

ENDPROC
PROCEDURE Valid
If This.Value > This.KeyboardHighValue
	This.Value = This.KeyboardHighValue
EndIf

If This.Value < This.KeyboardLowValue
	This.Value = This.KeyboardLowValue
EndIf
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _66S0OYNQO
[CLASS] label
[BASECLASS] label
[OBJNAME] lblPageSize
[PARENT] brwpagination
[START PROPERTIES]
AutoSize = .T.
BackStyle = 0
Caption = "Registros por página"
Left = 264
Top = 0
Visible = .F.
Width = 118
TabIndex = 9
Name = "lblPageSize"
[END PROPERTIES]
[START METHODS]
PROCEDURE MouseDown
LPARAMETERS nButton, nShift, nXCoord, nYCoord

This.Parent.MouseDown( nButton, nShift, nXCoord, nYCoord )
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] RESERVED  
[OBJNAME] brwpagination
[START PROPERTIES]
Arial, 0, 9, 5, 15, 12, 32, 3, 0
[END PROPERTIES]
[START RESERVED1]
  ..\include\praxis.höÌnfdV ..\include\foxpro.hþÍÊrûF ..\include\strings.hÏZOJ* ..\..\..\tools\namespaces\include\system.hÐ±ÙF[END RESERVED1]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _66S13Y4Q0
[CLASS] container
[BASECLASS] container
[OBJNAME] brwsearch
[START PROPERTIES]
Width = 204
Height = 24
BackStyle = 0
Enabled = .T.
_memberdata =      821<VFPData><memberdata name="buscar" display="Buscar"/><memberdata name="ccuetext" display="cCueText"/><memberdata name="ccuetext_assign" display="cCueText_Assign"/><memberdata name="lcuevisible" display="lCueVisible"/><memberdata name="lcuevisible_assign" display="lCueVisible_Assign"/><memberdata name="cfieldname" display="cFieldName"/><memberdata name="cforecolor" display="cForecolor"/><memberdata name="cformat" display="cFormat"/><memberdata name="cinputmask" display="cInputMask"/><memberdata name="lfontitalic" display="lFontItalic"/><memberdata name="nalignment" display="nAlignment"/><memberdata name="nmaxlength" display="nMaxLength"/><memberdata name="uoriginalvalue" display="uOriginalValue"/><memberdata name="enabled" display="Enabled"/><memberdata name="enabled_assign" display="Enabled_Assign"/></VFPData>
ccuetext = 
lcuevisible = .F.
cfieldname = 
cforecolor = 
cformat = 
cinputmask = 
lfontitalic = .F.
nalignment = 3
nmaxlength = 0
uoriginalvalue = .NULL.
Name = "brwsearch"
[END PROPERTIES]
[START METHODS]
PROCEDURE Init
Local lcCommand as String

Try

	lcCommand = ""
	This.BorderWidth = 0
	
	Text To lcMsg NoShow TextMerge Pretext 03
	Para filtrar la búsqueda,
	ingrese uno o varios conjuntos de caracteres
	separados por un espacio	
	EndText
	
	This.txtSearch.ToolTipText = lcMsg
	This.cCueText = "Ingrese datos de búsqueda"
	
	This.lFontItalic 	= This.txtSearch.FontItalic
	This.cForecolor 	= This.txtSearch.ForeColor
	This.nAlignment 	= This.txtSearch.Alignment
	This.cFormat 		= This.txtSearch.Format
	This.cInputMask 	= This.txtSearch.InputMask
	This.nMaxLength 	= This.txtSearch.MaxLength
	
	This.lCueVisible 	= ( Empty( Alltrim( Transform( This.txtSearch.Value ) ) ) Or Isnull( This.txtSearch.Value ) )	
	This.uOriginalValue = ""
	
Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


EndTry

ENDPROC
PROCEDURE buscar
Local lcCommand As String,;
	lcSearchString As String

Try

	lcCommand = ""

	If !Empty( This.txtSearch.Value )
		lcSearchString = Strtran( Alltrim( This.txtSearch.Value ), " ", "+" )

		loFiltro = Createobject( "Empty" )
		AddProperty( loFiltro, "Nombre", "Search"  )
		AddProperty( loFiltro, "FieldName", "search" )
		AddProperty( loFiltro, "FieldRelation", "=" )
		AddProperty( loFiltro, "FieldValue", lcSearchString )

		This.Parent.AddFilter( loFiltro )

	Else
		This.Parent.RemoveFilter( "Search" )

	Endif

	This.Parent.CargarGrilla()

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally
	loFiltro = Null


Endtry

ENDPROC
PROCEDURE ccuetext_assign
#INCLUDE "FW\Comunes\Include\Praxis.h"

Lparameters tcCueText
This.cCueText = tcCueText
If Empty( This.txtSearch.ToolTipText )
	This.txtSearch.ToolTipText = This.cCueText
Endif



ENDPROC
PROCEDURE enabled_assign
lparameters tEnabled
This.Enabled = tEnabled
This.SetAll( "Enabled", tEnabled )

ENDPROC
PROCEDURE lcuevisible_assign
Lparameters tlCueVisible
Local lcCommand As String

Try

    lcCommand = ""

    This.lCueVisible = tlCueVisible

    If This.lCueVisible
        This.txtSearch.Format 		= ''
        This.txtSearch.InputMask 	= ''
        This.txtSearch.MaxLength 	= 0
        This.txtSearch.ForeColor 	= This.txtSearch.DisabledForeColor
        This.txtSearch.FontItalic 	= .T.
        This.txtSearch.Alignment 	= 3
        This.txtSearch.Value 		= Alltrim( This.cCueText )

    Else
        This.txtSearch.Format 		= This.cFormat
        This.txtSearch.InputMask 	= This.cInputMask
        This.txtSearch.MaxLength 	= This.nMaxLength
        This.txtSearch.ForeColor 	= This.cForecolor
        This.txtSearch.FontItalic 	= This.lFontItalic
        This.txtSearch.Alignment 	= This.nAlignment

        If Alltrim( Transform( This.txtSearch.Value ) ) == Alltrim( This.cCueText )
            This.txtSearch.Value = This.uOriginalValue
        Endif

    Endif


Catch To oErr
    Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
    loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
    loError.Cremark = lcCommand
    loError.Process( oErr )
    Throw loError

Finally


Endtry



ENDPROC
[END METHODS]
[START RESERVED1]
Class[END RESERVED1]
[START RESERVED2]
3[END RESERVED2]
[START RESERVED3]
_memberdata XML Metadata for customizable properties
ccuetext Texto Aclaratorio
lcuevisible Muestra texto aclaratorio
cfieldname
cforecolor
cformat
cinputmask
lfontitalic
nalignment
nmaxlength
uoriginalvalue
*buscar 
*ccuetext_assign 
*lcuevisible_assign 
*enabled_assign 
[END RESERVED3]
[START RESERVED6]
Pixels[END RESERVED6]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _66S145403
[CLASS] textbox
[BASECLASS] textbox
[OBJNAME] txtSearch
[PARENT] brwsearch
[START PROPERTIES]
Anchor = 10
Height = 23
Left = 0
Top = 0
Width = 180
Name = "txtSearch"
[END PROPERTIES]
[START METHODS]
PROCEDURE GotFocus
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lcCommand As String

Try

    lcCommand = ""

    If .T. && This.lValid
        This.BackColor = _CB_ONFOCUS_BACKCOLOR

    Else
        This.BackColor = _CB_NOTVALID_BACKCOLOR

    Endif

    This.ForeColor = _CB_ONFOCUS_FORECOLOR

    If This.Parent.lCueVisible
        This.Parent.lCueVisible = .F.
    Endif

*!*	    If Empty( Alltrim( Transform( This.Value ) ) Or Isnull( This.Value ) )	
*!*	        Wait WINDOW NOWAIT NOCLEAR This.ToolTipText
*!*	    Endif

    If Empty( This.Value )
        Wait WINDOW NOWAIT NOCLEAR This.ToolTipText
    Endif

Catch To oErr
    Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
    loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
    loError.Cremark = lcCommand
    loError.Process( oErr )
    Throw loError

Finally


Endtry



ENDPROC
PROCEDURE Init
This.Value = ""
ENDPROC
PROCEDURE InteractiveChange
This.Parent.uOriginalValue = This.Value
ENDPROC
PROCEDURE KeyPress
#INCLUDE "FW\Comunes\Include\Praxis.h"

LPARAMETERS nKeyCode, nShiftAltCtrl

If nKeyCode = KEY_ENTER
	This.Parent.Buscar()
EndIf

ENDPROC
PROCEDURE LostFocus
#INCLUDE "FW\Comunes\Include\Praxis.h"

Local lcCommand As String
Local luValue As Variant
Local loLabel as Label

Try

	lcCommand = ""

	This.BackColor = _CB_BACKCOLOR
	This.ForeColor = _CB_FORECOLOR

	If ( Empty( Alltrim( Transform( This.Value ) ) ) Or Isnull( This.Value ) )
		This.Parent.lCueVisible = .T.
	Endif

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "ErrorhandlerPrg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	Wait Clear


Endtry

ENDPROC
PROCEDURE MouseDown
Lparameters nButton, nShift, nXCoord, nYCoord

Do Case
	Case nButton = 2 And nShift = 0 && Right Click

		Text To lcMsg NoShow TextMerge Pretext 03
		Ingrese una palabra o parte de ella
		para que el sistema filtre todos
		los registros que contienen la misma.
		
		Pueden ingresarse más de una palabra
		o parte de palabra, y el sistema traerá
		solamente los registros que contengan
		todas las palabras ingresadas
		EndText


		Inform( lcMsg, "Búsqueda inteligente", -1 )

Endcase

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _66S145404
[CLASS] search
[CLASSLOC] buttons.vcx
[BASECLASS] commandbutton
[OBJNAME] btnSearch
[PARENT] brwsearch
[START PROPERTIES]
Top = 0
Left = 180
Height = 24
Width = 24
Anchor = 8
Caption = ""
ToolTipText = "Filtrar por las palabras ingresadas"
Name = "btnSearch"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
Local lcCommand as String

Try

	lcCommand = ""
	
	This.Parent.Buscar()
	

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


EndTry

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] RESERVED  
[OBJNAME] brwsearch
[START PROPERTIES]
Arial, 0, 9, 5, 15, 12, 32, 3, 0
[END PROPERTIES]
[START RESERVED1]
  ..\include\praxis.h~ÐnfdV ..\include\foxpro.hÑÊrûF ..\include\strings.hÒZOJ* ..\..\..\tools\namespaces\include\system.hÓ±ÙF[END RESERVED1]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _6K40NZVL2
[CLASS] container
[BASECLASS] container
[OBJNAME] brwfilters
[START PROPERTIES]
Width = 396
Height = 60
BackStyle = 0
oregistro = .NULL.
_memberdata =      331<VFPData><memberdata name="oregistro" display="oRegistro"/><memberdata name="ofilters" display="oFilters"/><memberdata name="ofilters_access" display="oFilters_Access"/><memberdata name="addfilter" display="AddFilter"/><memberdata name="removefilter" display="RemoveFilter"/><memberdata name="filtrar" display="Filtrar"/></VFPData>
ofilters = .NULL.
Name = "brwfilters"
[END PROPERTIES]
[START METHODS]
PROCEDURE Init
Local lcCommand as String

Try

	lcCommand = ""
	This.BorderWidth = 0
	This.oRegistro = CreateObject( "Empty" )

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


EndTry

ENDPROC
PROCEDURE addfilter
Lparameters loFilter as Object
Local lcCommand as String
Local loFiltros As CollectionBase Of Tools\Namespaces\Prg\CollectionBase.Prg

Try

	lcCommand = ""
	This.RemoveFilter( loFilter.Nombre )
	loFiltros = This.oFilters
	loFiltros.AddItem( loFilter, Lower( loFilter.Nombre ))

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally
	loFilter 	= Null
	loFiltros 	= Null


EndTry

ENDPROC
PROCEDURE filtrar
Local lcCommand as String

Try

	lcCommand = ""

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally


EndTry

ENDPROC
PROCEDURE ofilters_access
If Vartype( This.oFilters ) # "O"
	This.oFilters = Newobject( "CollectionBase", "Tools\Namespaces\Prg\CollectionBase.Prg" )
EndIf
return This.oFilters

ENDPROC
PROCEDURE removefilter
Lparameters cFilterName as String
Local lcCommand as String
Local loFiltros As CollectionBase Of Tools\Namespaces\Prg\CollectionBase.Prg

Try

	lcCommand = ""
	loFiltros = This.oFilters
	loFiltros.RemoveItem( Lower( cFilterName ))

Catch To loErr
	Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
	loError = NewObject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
	loError.cRemark = lcCommand
	loError.Process ( m.loErr )
	Throw loError

Finally
	loFiltros = Null


EndTry

ENDPROC
[END METHODS]
[START RESERVED1]
Class[END RESERVED1]
[START RESERVED2]
2[END RESERVED2]
[START RESERVED3]
oregistro
_memberdata XML Metadata for customizable properties
ofilters
*ofilters_access 
*addfilter 
*removefilter 
*filtrar 
[END RESERVED3]
[START RESERVED6]
Pixels[END RESERVED6]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _6K40OPVQZ
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] cmdFiltrar
[PARENT] brwfilters
[START PROPERTIES]
Top = 12
Left = 300
Height = 36
Width = 84
Anchor = 12
Picture = ..\image\bmp\filtro.bmp
Caption = "Filtrar"
ToolTipText = "Filtrar la grilla"
PicturePosition = 1
Name = "cmdFiltrar"
[END PROPERTIES]

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] RESERVED  
[OBJNAME] brwfilters
[START PROPERTIES]
Arial, 0, 9, 5, 15, 12, 32, 3, 0
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _6KE0RJYC1
[CLASS] container
[BASECLASS] container
[OBJNAME] brwinformacion
[START PROPERTIES]
Width = 504
Height = 60
BackStyle = 0
_memberdata = <VFPData><memberdata name="autosize" display="Autosize"/></VFPData>
Name = "brwinformacion"
[END PROPERTIES]
[START METHODS]
PROCEDURE Init
This.BorderWidth = 0
ENDPROC
PROCEDURE autosize
Local lcCommand As String

Try

    lcCommand = ""
    If !This.Visible
        This.Height = 0
    Endif

Catch To loErr
    Local loError As ErrorHandler Of 'Tools\ErrorHandler\Prg\ErrorHandler.prg'
    loError = Newobject( 'ErrorHandler', 'Tools\ErrorHandler\Prg\ErrorHandler.prg' )
    loError.cRemark = lcCommand
    loError.Process ( m.loErr )
    Throw loError

Finally


Endtry

ENDPROC
[END METHODS]
[START RESERVED1]
Class[END RESERVED1]
[START RESERVED2]
1[END RESERVED2]
[START RESERVED3]
_memberdata
*autosize 
[END RESERVED3]
[START RESERVED6]
Pixels[END RESERVED6]

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] RESERVED  
[OBJNAME] brwinformacion
[EOF]
