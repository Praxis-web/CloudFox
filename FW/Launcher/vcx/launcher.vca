SCCTEXT Version 4.0.0.2
PLATFORM C(8,0),UNIQUEID C(10,0),TIMESTAMP N(10,0),CLASS M(4,0),CLASSLOC M(4,0),BASECLASS M(4,0),OBJNAME M(4,0),PARENT M(4,0),PROPERTIES M(4,0),PROTECTED M(4,0),METHODS M(4,0),OBJCODE M(4,0),OLE M(4,0),OLE2 M(4,0),RESERVED1 M(4,0),RESERVED2 M(4,0),RESERVED3 M(4,0),RESERVED4 M(4,0),RESERVED5 M(4,0),RESERVED6 M(4,0),RESERVED7 M(4,0),RESERVED8 M(4,0),USER M(4,0)
1252

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] Class     
[START RESERVED1]
VERSION =   3.00[END RESERVED1]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2UG10BPVQ
[CLASS] form
[BASECLASS] form
[OBJNAME] launcher
[START PROPERTIES]
BorderStyle = 1
Height = 473
Width = 742
ShowWindow = 2
DoCreate = .T.
AutoCenter = .T.
Caption = "Sistemas Fenix"
MaxButton = .F.
Icon = ..\..\comunes\image\modulos\fenix.ico
_memberdata =     1067<VFPData><memberdata name="declare" display="Declare"/><memberdata name="startprocess" display="StartProcess"/><memberdata name="ocolprocess" display="oColProcess"/><memberdata name="ouser" type="property" display="oUser"/><memberdata name="lalreadyinstanciated" type="property" display="lAlreadyInstanciated"/><memberdata name="llogged" type="property" display="lLogged"/><memberdata name="logging" type="method" display="Logging"/><memberdata name="buf2dword" type="method" display="Buf2dWord"/><memberdata name="logout" type="method" display="Logout"/><memberdata name="cuser" display="cUser"/><memberdata name="loging" type="method" display="Loging"/><memberdata name="canunload" display="CanUnload"/><memberdata name="setnivel" display="SetNivel"/><memberdata name="distribuirbotones" display="DistribuirBotones"/><memberdata name="lperformautosetup" display="lPerformAutoSetup"/><memberdata name="autosetup" display="AutoSetup"/><memberdata name="ocolbuttons" display="oColButtons"/><memberdata name="ocolbuttons_access" display="oColButtons_Access"/></VFPData>
ocolprocess = .NULL.
ouser = .NULL.
cuser = 
lperformautosetup = .T.
ocolbuttons = .NULL.
Name = "launcher"
[END PROPERTIES]
[START METHODS]
PROCEDURE Activate
Try

	If IsNull( Thisform.oUser )
		Thisform.Loging()
		Thisform.WindowState = 0
	EndIf

Catch To oErr
	Local loError as PrxErrorHandler OF "fw\ErrorHandler\prxErrorHandler.prg"

	loError = NewObject( "PrxErrorHandler", "prxErrorHandler.prg" )
	loError.Process( oErr )
	Thisform.Release()
	Throw loError

Finally

EndTry

ENDPROC
PROCEDURE Destroy
If Vartype( This.oColProcess ) = "O"
	This.oColProcess.Remove( -1 )
	This.oColProcess = Null
	
	This.oColButtons.Remove( -1 )
	This.oColButtons = Null
	
	Thisform.oUser = Null
EndIf

ENDPROC
PROCEDURE Init
Local llOk As Boolean
Local lcCaption As String

Try

	llOk = .T.
	Thisform.cmdCancel.Top = -100

	Thisform.oColProcess = Createobject( "Collection" )

	If FileExist( "Sucursal.Dbf" )
		If !Used( "Sucursal.Dbf" )
			Use Sucursal Shared In 0
		Endif

		Select Sucursal
		Locate For Activo = .T.
		If !Eof()
			lcRUTA = Alltrim( Ruta )
			Restore From '&lcRUTA.ARPARAME' Additive
		Endif
	Endif

	If Vartype( DRVA ) # "C"
		If FileExist( "Datos\arParame.Mem" )
			Restore From Datos\arParame Additive
		Endif
	Endif

	If  FileExist( "Terminal.Mem" )
		Restore From Terminal Additive
	Endif

	If Vartype( K_BKCLR ) = "C"
		TEXT To lcCommand NoShow TextMerge Pretext 15
		This.BackColor = Rgb( <<K_BKCLR>> )
		ENDTEXT

		&lcCommand

	Endif

	lcCaption = Thisform.Caption
	Thisform.Caption = GetValue( "Clie0", "ar0Est", lcCaption )

Catch To oErr
	Local loError As PrxErrorHandler Of "fw\ErrorHandler\prxErrorHandler.prg"

	llOk = .F.

	loError = Newobject( "PrxErrorHandler", "prxErrorHandler.prg" )
	loError.Process( oErr )

Finally
	Use In Select( "Sucursal" )

Endtry

Return llOk

ENDPROC
PROCEDURE Load
*!*	Thisform.Declare()

Local lcCommand As String,;
lcRuta as String

Try

	lcCommand = ""

	Set Procedure To Rutina.prg Additive

	Globales()

	Set Safety Off
	Set Exclusive Off

	If IsRuntime()
		_Screen.Top = -100
		_Screen.Height = 0
	Endif


Catch To oErr
	Local loError As prxErrorHandler Of "FW\ErrorHandler\prxErrorHandler.prg"
	loError = Newobject( "prxErrorHandler", "prxErrorHandler.prg" )
	loError.Remark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally


Endtry

ENDPROC
PROCEDURE QueryUnload
Try

	If !Thisform.CanUnload()
		NoDefault
	EndIf

Catch To oErr
	Local loError As PrxErrorHandler Of "fw\ErrorHandler\prxErrorHandler.prg"

	loError = Newobject( "PrxErrorHandler", "prxErrorHandler.prg" )
	loError.Process( oErr )

Finally

Endtry

ENDPROC
PROCEDURE Unload

If Vartype( This.oColProcess ) = "O"
	This.oColProcess.Remove( -1 )
	This.oColProcess = Null
	
	Thisform.oUser = Null
EndIf

Clear Events
ENDPROC
PROCEDURE autosetup
Local lcCommand As String
Local oCmd As CommandButton

Local lnRow As Integer,;
	lnCol1 As Integer,;
	lnCol2 As Integer,;
	i As Integer,;
	j As Integer,;
	lnGap As Integer,;
	lnTop As Integer,;
	lnLeft As Integer,;
	lnHeight as Integer


Try

	lcCommand = ""
	lnTop = 0

	Thisform.Height = ThisForm.Label2.Top + ThisForm.Label2.Height

	lnGap 	= 12
	lnCol1 	= lnGap
	lnCol2 	= Thisform.imgLogo.Left + Thisform.imgLogo.Width + lnGap

	i 		= 0
	j 		= 0
	lnRow 	= 0
	lnLeft 	= lnCol1
	lnHeight = 0

	For Each oCmd In Thisform.oColButtons
	
		j = j + 1
		
		If oCmd.Visible

			i = i + 1

			If Empty( Mod( i, 2 ) )
				lnLeft = lnCol2

			Else
				lnLeft = lnCol1
				lnRow = lnRow + 1

			Endif

			lnTop = ( lnRow * lnGap ) + ( ( lnRow - 1 ) * oCmd.Height )

			oCmd.Top 	= lnTop
			oCmd.Left 	= lnLeft
			lnHeight = oCmd.Height

		Else
			oCmd.Top = -100

		EndIf
		
		Text To lcCommand NoShow TextMerge Pretext 15
		Thisform.<<oCmd.Name>>.TabIndex = <<j>>
		EndText

		&lcCommand

	EndFor
	
	Thisform.Height = Max( Thisform.Height, lnTop + lnHeight + lnGap )


Catch To oErr
	Local loError As prxErrorHandler Of "FW\ErrorHandler\prxErrorHandler.prg"
	loError = Newobject( "prxErrorHandler", "prxErrorHandler.prg" )
	loError.Remark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally


Endtry

ENDPROC
PROCEDURE buf2dword
Lparameters tcBuffer As String

Return Asc(Substr(tcBuffer, 1,1)) + ;
	BitLShift(Asc(Substr(tcBuffer, 2,1)),  8) +;
	BitLShift(Asc(Substr(tcBuffer, 3,1)), 16) +;
	BitLShift(Asc(Substr(tcBuffer, 4,1)), 24)



ENDPROC
PROCEDURE canunload
Local lCanUnload as Boolean
Local lcMsg As String
Local lcProgs As String
Local lnWHandle As Integer
Local lcWindowTittle As String
Local i As Integer
*!*	Local llDone As Boolean
Local loColRemove as Collection
Local lcKey as String


Try

	lCanUnload = .F.

	If !Empty( Thisform.oColProcess.Count )

		loColRemove = CreateObject( "Collection" )

		For i = 1 To Thisform.oColProcess.Count
			lcWindowTittle = Thisform.oColProcess.GetKey( i )

			If Empty( FindWindow( Null, lcWindowTittle ))
				loColRemove.Add( Thisform.oColProcess.GetKey( i ) )
			Endif
		EndFor

		For Each lcKey In loColRemove
			Thisform.oColProcess.Remove( lcKey )
		EndFor

	Endif


	If !Empty( Thisform.oColProcess.Count )
		lcProgs = ""

		For i = 1 To Thisform.oColProcess.Count
			lcWindowTittle = Proper( Thisform.oColProcess.GetKey( i ))
			lcProgs = lcProgs + lcWindowTittle + Chr(13)
		Endfor

		TEXT To lcMsg NoShow TextMerge Pretext 3
		Los Siguientes Procesos Aun Estan Abiertos:
		<<lcProgs>>
		ENDTEXT

		Warning( lcMsg )

		lCanUnload = .F.

	Else
		Erase "User.Cfg"
		lCanUnload = .T.

	Endif


Catch To oErr
	Local loError as PrxErrorHandler OF "fw\ErrorHandler\prxErrorHandler.prg"

	loError = NewObject( "PrxErrorHandler", "prxErrorHandler.prg" )
	loError.Process( oErr )
	Throw loError

Finally

EndTry

Return lCanUnload

ENDPROC
PROCEDURE declare
Try

	Declare Integer CloseHandle In kernel32 Integer hObject

	Declare Integer TerminateJobObject In kernel32;
		INTEGER hJob, Long uExitCode

	Declare Integer CreateJobObject In kernel32;
		INTEGER lpJobAttributes, String lpName

	Declare Integer AssignProcessToJobObject In kernel32;
		INTEGER hJob, Integer hProcess

	Declare Integer FindExecutable In shell32;
		STRING lpFile, String lpDir, String @lpResult

	Declare Integer GetSystemDirectory In kernel32;
		STRING @ lpBuffer, Integer nSize

	Declare Integer CreateProcess In kernel32;
		STRING lpApplicationName, String lpCommandLine,;
		INTEGER lpProcessAttr, Integer lpThreadAttr,;
		INTEGER bInheritHandles, Integer dwCreationFlags,;
		INTEGER lpEnvironment, String lpCurrentDirectory,;
		STRING @lpStartupInfo, String @lpProcessInformation

	Declare Integer GetHandleInformation In kernel32;
		INTEGER   hObject,;
		INTEGER @ lpdwFlags

	Declare Integer FindWindow In user32;
		STRING lpClassName, String lpWindowName

Catch To oErr
	Local loError As PrxErrorHandler Of "fw\ErrorHandler\prxErrorHandler.prg"

	loError = Newobject( "PrxErrorHandler", "prxErrorHandler.prg" )
	loError.Process( oErr )
	Throw loError

Finally

Endtry

ENDPROC
PROCEDURE loging

Local lnClave As Integer
Local loUser As Object
Local llDoLogin As Boolean
Local loUser As User Of "Fw\TierAdapter\Comun\prxUser.prg"
Local loUsuario As Object


Try

	llDoLogin = .T.

	If File( "SetUp.cfg" )
		loSetup = XmlToObject( Filetostr( "SetUp.cfg" ))

		If Vartype( loSetup ) == "O"
			If Pemstatus( loSetup, "lDoLogin", 5 )
				llDoLogin = loSetup.lDoLogin
			Endif
		Endif
	Endif

	Thisform.WindowState = 0

	If llDoLogin
		Do Form "FW\Comunes\Scx\frmLogin" To loUser

		If ( loUser.Cancela = .T. ) Or ( loUser.Id = 0 )
			loUser.lOk = .F.
		Endif

	Else
		loUser = Newobject( "User", "Fw\TierAdapter\Comun\prxUser.prg" )

		*!*			loUser = CreateObjParam( "Usuario", "Admin",;
		*!*				"Nombre", "",;
		*!*				"Password", "",;
		*!*				"Nivel", 0,;
		*!*				"Permiso", 0,;
		*!*				"IsAdmin", .F.,;
		*!*				"IsGuest", .T.,;
		*!*				"nEmpresaActivaId", 0,;
		*!*				"lOk", .T. )


	Endif



	If loUser.lOk = .T.

		loUsuario = CreateObjParam( "Id", loUser.Id,;
			"Usuario", loUser.Usuario,;
			"Nombre", loUser.Nombre,;
			"Password", loUser.Password,;
			"Nivel", loUser.Nivel,;
			"IsAdmin", loUser.IsAdmin,;
			"IsGuest", loUser.IsGuest,;
			"nEmpresaActivaId", loUser.nEmpresaActivaId,;
			"lOk", .T.,;
			"GroupId", loUser.GroupId,;
			"Grupo", loUser.Grupo )

		Thisform.oUser = loUsuario
		Thisform.cUser = ObjectToXml( loUsuario )
		Strtofile( Thisform.cUser, "User.Cfg" )
		Thisform.SetNivel( loUsuario.Nivel )
		If Thisform.lPerformAutoSetup
			Thisform.AutoSetup()
		Endif

	Else
		TEXT To lcCommand NoShow TextMerge Pretext 3
		No Ha podido Registrarse Correctamente
		El Programa Se Cerrar·
		ENDTEXT

		Error lcCommand

	Endif

	Thisform.Declare()

Catch To oErr
	Local loError As PrxErrorHandler Of "fw\ErrorHandler\prxErrorHandler.prg"

	loError = Newobject( "PrxErrorHandler", "prxErrorHandler.prg" )
	loError.Process( oErr )
	Throw loError

Finally
	loSetup = Null
	loUser = Null
	loUsuario = Null
	Close Databases All

Endtry


Return

ENDPROC
PROCEDURE ocolbuttons_access
If Vartype( This.oColButtons ) # "O"

	This.oColButtons = Newobject( "PrxCollection", "Fw\TierAdapter\Comun\PrxBaseLibrary.prg" )
	
	This.oColButtons.KeySort = 2
	
Endif

Return This.oColButtons

ENDPROC
PROCEDURE setnivel
Lparameters tnNivel as Integer

ENDPROC
PROCEDURE startprocess
Lparameters tcAppName As String,;
	tcCmdLine As String,;
	tnProcessAttr As Integer,;
	tnThreadAttr As Integer,;
	tnInheritHandles As Integer,;
	tnCreationFlags As Integer,;
	tnEnvironment As Integer,;
	tcCurrentDirectory As String,;
	tcWindowsTittle As String


#Define START_INFO_SIZE  68

Local lcProcInfo As String, lcStartInfo As String
Local lnResult As Integer, lnhProcess As Integer
Local lcVersion As String
Local lcUserCfg As String
Local lcWindowsTittle as String

Local i As Integer

Try


	* Permitir que el mismo mÛdulo se abra m·s de una vez
	* RA 2010-06-04(09:38:39)
	
	* If Empty( FindWindow( Null, tcWindowsTittle ))

		If !Empty( FindWindow( Null, tcWindowsTittle ))
			lcWindowsTittle = tcWindowsTittle
			i = 0
			Do While !Empty( FindWindow( Null, tcWindowsTittle ))
				i = i + 1
				tcWindowsTittle = lcWindowsTittle + Transform( i )
			EndDo
			
		EndIf
		
		lcVersion = "1.0"
		lcUserCfg = "User.Cfg"

		lnhProcess = 0
		lnResult = 0
		lcProcInfo = Repli(Chr(0), 16)
		lcStartInfo = Padr(Chr(START_INFO_SIZE), START_INFO_SIZE, Chr(0))

		If Not Empty(m.tcCmdLine)
			tcCmdLine = " '" + Alltrim(tcCmdLine) + "'"

		Else
			tcCmdLine = [ '] + tcWindowsTittle + [' '] + lcVersion + [' '] + lcUserCfg + [']

		Endif

		lnResult = CreateProcess( tcAppName,;
			tcCmdLine,;
			tnProcessAttr,;
			tnThreadAttr,;
			tnInheritHandles,;
			tnCreationFlags,;
			tnEnvironment,;
			tcCurrentDirectory,;
			@lcStartInfo,;
			@lcProcInfo )

		If lnResult <> 0
			*!*	retrieve process handle from PROCINFO structure
			lnhProcess = Thisform.Buf2dWord( Substr( lcProcInfo, 1, 4 ) )

		Else
			Error "No se pudo ejecutar " + 	tcAppName

		Endif

		If lnhProcess > 32
			i = Thisform.oColProcess.GetKey( Upper( tcWindowsTittle ))

			If !Empty( i )
				Thisform.oColProcess.Remove( i )
			Endif

			Thisform.oColProcess.Add( lnhProcess, Upper( tcWindowsTittle ))

		Endif

	* Endif


Catch To oErr
	Local loError As PrxErrorHandler Of "fw\ErrorHandler\prxErrorHandler.prg"

	loError = Newobject( "PrxErrorHandler", "prxErrorHandler.prg" )

	If oErr.ErrorNo = 1098
		Text To lcCommand NoShow TextMerge Pretext 3
			<<lnResult>> = CreateProcess( '<<tcAppName>>',;
				<<tcCmdLine>>,;
				<<tnProcessAttr>>,;
				<<tnThreadAttr>>,;
				<<tnInheritHandles>>,;
				<<tnCreationFlags>>,;
				<<tnEnvironment>>,;
				'<<tcCurrentDirectory>>',;
				@lcStartInfo,;
				@lcProcInfo )


		ENDTEXT

		loError.Remark =  lcCommand

	EndIf

	loError.Process( oErr )
	Throw loError

Finally

Endtry

Return m.lnhProcess

ENDPROC
[END METHODS]
[START RESERVED1]
Class[END RESERVED1]
[START RESERVED2]
5[END RESERVED2]
[START RESERVED3]
_memberdata XML Metadata for customizable properties
ocolprocess
ouser
cuser
lperformautosetup
ocolbuttons Coleccion de botones
*declare 
*startprocess 
*buf2dword 
*loging 
*logout 
*canunload 
*setnivel 
*distribuirbotones 
*autosetup Distribuye los botones autom·ticamente
*ocolbuttons_access 
[END RESERVED3]
[START RESERVED6]
Pixels[END RESERVED6]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2UG10BPWB
[CLASS] image
[BASECLASS] image
[OBJNAME] imgLogo
[PARENT] launcher
[START PROPERTIES]
Picture = ..\..\comunes\image\jpg\fenixlogo.jpg
Stretch = 2
Height = 216
Left = 144
Top = 12
Width = 216
Name = "imgLogo"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2UG10BPX7
[CLASS] label
[BASECLASS] label
[OBJNAME] Label1
[PARENT] launcher
[START PROPERTIES]
FontBold = .T.
FontName = "Times New Roman"
FontSize = 26
Alignment = 2
BackStyle = 0
Caption = "Sistemas"
Height = 48
Left = 144
Top = 228
Width = 216
ForeColor = 255,255,128
Name = "Label1"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2UG10BPXA
[CLASS] label
[BASECLASS] label
[OBJNAME] Label2
[PARENT] launcher
[START PROPERTIES]
FontBold = .T.
FontName = "Times New Roman"
FontSize = 26
Alignment = 2
BackStyle = 0
Caption = "Fenix"
Height = 48
Left = 144
Top = 276
Width = 216
ForeColor = 255,255,128
Name = "Label2"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2VH0SK21C
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] cmdCancel
[PARENT] launcher
[START PROPERTIES]
Top = 420
Left = 600
Height = 27
Width = 84
Cancel = .T.
Caption = "Cancel"
TabStop = .F.
Name = "cmdCancel"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
If Thisform.CanUnload()
	Thisform.Release()
EndIf

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] RESERVED  
[OBJNAME] launcher
[START PROPERTIES]
Arial, 0, 9, 5, 15, 12, 32, 3, 0
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2UG10E56C
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] launchbutton
[START PROPERTIES]
Height = 48
Width = 120
FontBold = .T.
FontSize = 12
Picture = ..\..\..\
Caption = ""
TabIndex = 1
Visible = .F.
SpecialEffect = 2
PicturePosition = 13
cappname = 
_memberdata =     1281<VFPData><memberdata name="cappname" display="cAppName" favorites="True"/><memberdata name="ccmdline" display="cCmdLine" favorites="True"/><memberdata name="cwindowstittle" display="cWindowsTittle" favorites="True"/><memberdata name="nwhandle" display="nWHandle" favorites="True"/><memberdata name="nprocessattr" display="nProcessAttr" favorites="True"/><memberdata name="nthreadattr" display="nThreadAttr" favorites="True"/><memberdata name="ninherithandles" display="nInheritHandles" favorites="True"/><memberdata name="ncreationflags" display="nCreationFlags" favorites="True"/><memberdata name="nenvironment" display="nEnvironment" favorites="True"/><memberdata name="ccurrentdirectory" display="cCurrentDirectory" favorites="True"/><memberdata name="ccurrentdirectory_access" display="cCurrentDirectory_Access"/><memberdata name="picture" type="Property" favorites="True"/><memberdata name="cwindowstittle_access" display="cWindowsTittle_Access" favorites="True"/><memberdata name="nnivel" display="nNivel"/><memberdata name="nnivel_assign" display="nNivel_Assign"/><memberdata name="setnivel" display="SetNivel"/><memberdata name="lshowinlauncher" type="property" display="lShowInLauncher" favorites="True"/><memberdata name="nid" display="nId" favorites="True"/></VFPData>

ccmdline = 
cwindowstittle = 
nwhandle = 0
nprocessattr = 0
nthreadattr = 0
ninherithandles = 0
ncreationflags = 0
nenvironment = 0
ccurrentdirectory = 
nnivel = 0
lshowinlauncher = .T.
nid = 0
Name = "launchbutton"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click

Try

	This.nWHandle = Thisform.StartProcess( ;
		This.cAppName,;
		This.cCmdLine,;
		This.nProcessAttr,;
		This.nThreadAttr,;
		This.nInheritHandles,;
		This.nCreationFlags,;
		This.nEnvironment,;
		This.cCurrentDirectory,;
		This.cWindowsTittle )
		

Catch To oErr
	Local loError As PrxErrorHandler Of "fw\ErrorHandler\prxErrorHandler.prg"

	loError = Newobject( "PrxErrorHandler", "prxErrorHandler.prg" )
	loError.Process( oErr )

Finally


Endtry


ENDPROC
PROCEDURE Init
#INCLUDE "FW\Comunes\Include\Praxis.h"

Try

	Bindevent( Thisform, "SetNivel", This, "SetNivel" )
	
	If This.lShowInLauncher
		If Pemstatus( Thisform, "oColButtons", 5 )
			Thisform.oColButtons.Add( This, Lower( This.cWindowsTittle ) )
		Endif
	Endif

Catch To oErr
	Local loError As PrxErrorHandler Of "fw\ErrorHandler\prxErrorHandler.prg"

	loError = Newobject( "PrxErrorHandler", "prxErrorHandler.prg" )
	loError.Process( oErr )


Finally

Endtry

ENDPROC
PROCEDURE ccurrentdirectory_access
If Empty( This.cCurrentDirectory )
	This.cCurrentDirectory = Sys(5)+Sys(2003)
Endif

Return This.cCurrentDirectory

ENDPROC
PROCEDURE cwindowstittle_access


If Empty( This.cWindowsTittle )
	Local lcCaption as String
	Local i as Integer
	
	i = At( "\<", This.Caption )	
	
	If !Empty( i )
		lcCaption = Stuff( This.Caption, i, 2, "" )
		
	Else
		lcCaption = This.Caption
		
	EndIf
	
	This.cWindowsTittle = lcCaption
	
EndIf

Return This.cWindowsTittle

ENDPROC
PROCEDURE nnivel_assign
lparameters tnNivel
This.nNivel = tnNivel

ENDPROC
PROCEDURE setnivel
Lparameters tnNivel As Integer

Local lcParameFileName As String
Local lcRootWorkFolder As String
Local lcCommand As String

Local loUser As User Of "Fw\TierAdapter\Comun\prxUser.prg"
Local lcGroupField As String,;
	lcUserField As String

Local llOk As Boolean

Try


	If Vartype( tnNivel ) # "N"
		tnNivel = 0
	EndIf
	
	If This.lShowInLauncher

		If !Used( "cModulos" )
			If IsRuntime()
				lcParameFileName = "Datos\arParame"

			Else
				lcParameFileName = "arParame"

			Endif

			lcRootWorkFolder = ""
			lcCommand = ""

			If Vartype( DRVA ) # "C"
				If File( Addbs( lcRootWorkFolder ) + "SUCURSAL.DBF")

					Use Addbs( lcRootWorkFolder ) + "SUCURSAL" Shared

					Loca For Activo

					If !Eof()
						lcParameFileName = Addbs( Alltrim( RUTA )) + "arParame"
					Endif

				Endif

				TEXT To lcCommand NoShow TextMerge Pretext 15
				Restore From '<<lcParameFileName>>' Additive
				ENDTEXT

				&lcCommand

			Endif

			If Vartype( DRCOMUN ) = "C"
				lcRootWorkFolder = DRCOMUN

			Else
				lcRootWorkFolder = DRVA

			Endif


			If File( lcRootWorkFolder + "Modulos.Dbf" )
			
				TEXT To lcCommand NoShow TextMerge Pretext 15
				Select * From '<<lcRootWorkFolder>>Modulos.Dbf' Into Cursor cModulos_Aux
				ENDTEXT

				&lcCommand
				
				If Empty( Field( "Activo", "cModulos_Aux" ))
					Select *, .T. as Activo From Dbf( "cModulos_Aux" ) Into Cursor cModulos

				Else
					Select * From Dbf( "cModulos_Aux" ) Into Cursor cModulos
					
				Endif

				Use In Select( "Modulos" )
				Use in Select( "cModulos_Aux" )

			Endif

		Endif

		If Used( "cModulos" )
			Select cModulos

			If Upper( Field( "ID", "cModulos" ) ) = "ID"
				Locate For Id = This.nId

			Else
				Locate For Alltrim( Upper( cModulos.Nombre )) == Alltrim( Upper( This.cWindowsTittle ))

			Endif

			If Found()

				If Upper( Field( "NIVEL", "cModulos" ) ) = "NIVEL"
					This.nNivel = cModulos.Nivel

				Else
					llOk = .F.

					If cModulos.Activo

						loUser = Thisform.oUser

						lcUserField 	= "u" + StrZero( loUser.Id, 4 )
						lcGroupField 	= "g" + StrZero( loUser.GroupId, 4 )

						If Upper( Field( lcGroupField, "cModulos" ) ) = Upper( lcGroupField )
							llOk = Evaluate( "cModulos." + lcGroupField ) = 1

							If Upper( Field( lcUserField, "cModulos" ) ) = Upper( lcUserField )
								Do Case
									Case Evaluate( "cModulos." + lcUserField ) = 1
										llOk = .T.

									Case Evaluate( "cModulos." + lcUserField ) = 0
										llOk = .F.

								Endcase
							Endif

						Endif

					Endif

					If llOk
						* HighValue para que lo muestre
						tnNivel = 99999

					Else
						* LowValue para que NO lo muestre
						tnNivel = -99999

					Endif



				Endif

			Endif

		Endif

		This.Visible = tnNivel >= This.nNivel

	Endif

Catch To oErr
	Local loError As PrxErrorHandler Of "fw\ErrorHandler\prxErrorHandler.prg"

	loError = Newobject( "PrxErrorHandler", "prxErrorHandler.prg" )
	loError.Process( oErr )


Finally
	Use In Select( "Modulos" )
	Use In Select( "cModulos" )
	Use In Select( "SUCURSAL" )
	loUser = Null

Endtry


ENDPROC
[END METHODS]
[START RESERVED1]
Class[END RESERVED1]
[START RESERVED2]
1[END RESERVED2]
[START RESERVED3]
cappname Nombre del Ejecutable que debe disparar
_memberdata XML Metadata for customizable properties
ccmdline Linea de comandos o Par·metros que se le pasa al ejecutable
cwindowstittle TÌtulo de la ventana del ejecutable
nwhandle Id del Handle al Ejecutable
nprocessattr
nthreadattr
ninherithandles
ncreationflags
nenvironment
ccurrentdirectory
nnivel
lshowinlauncher Indica si el botÛn se mustra en el Launcher
nid Id del boton en la tabla de MÛdulos
*ccurrentdirectory_access 
*cwindowstittle_access 
*nnivel_assign 
*setnivel 
[END RESERVED3]
[START RESERVED6]
Pixels[END RESERVED6]

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] RESERVED  
[OBJNAME] launchbutton
[START PROPERTIES]
Arial, 1, 12, 8, 20, 15, 42, 4, 1
[END PROPERTIES]
[START RESERVED1]
  ..\..\comunes\include\praxis.hÓ∑jc›P ..\..\comunes\include\foxpro.hˆ∏ r˚F ..\..\comunes\include\strings.h˛πZäOJ6 ..\..\..\tools\reportbuilder\include\ooreportbuilder.hªê±ŸF ..\..\comunes\include\foxpro.hº r˚F* ..\..\..\tools\namespaces\include\system.hΩ±ŸF[END RESERVED1]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2UG122XK8
[CLASS] launcher
[CLASSLOC] launcher.vcx
[BASECLASS] form
[OBJNAME] launchform
[START PROPERTIES]
BorderStyle = 2
Height = 429
Width = 504
DoCreate = .T.
Name = "launchform"
imgLogo.Name = "imgLogo"
Label1.TabIndex = 11
Label1.Name = "Label1"
Label2.TabIndex = 12
Label2.Name = "Label2"
cmdCancel.TabIndex = 13
cmdCancel.Name = "cmdCancel"
[END PROPERTIES]
[START RESERVED1]
Class[END RESERVED1]
[START RESERVED2]
15[END RESERVED2]
[START RESERVED6]
Pixels[END RESERVED6]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2UG10BPVQ
[CLASS] launchbutton
[CLASSLOC] launcher.vcx
[BASECLASS] commandbutton
[OBJNAME] cmdContable
[PARENT] launchform
[START PROPERTIES]
Top = 192
Left = 12
Picture = ..\..\comunes\image\modulos\contable.ico
Caption = "\<Contabilidad"
TabIndex = 4
cappname = Contable.Exe
nid = 4
Name = "cmdContable"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _37X0OBYWM
[CLASS] launchbutton
[CLASSLOC] launcher.vcx
[BASECLASS] commandbutton
[OBJNAME] cmdVentas
[PARENT] launchform
[START PROPERTIES]
Top = 312
Left = 372
Picture = ..\..\comunes\image\modulos\ventas.ico
Caption = "Ve\<ntas"
TabIndex = 12
TabStop = .T.
cappname = prGesVen.exe
nid = 12
Name = "cmdVentas"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2UG135NVY
[CLASS] launchbutton
[CLASSLOC] launcher.vcx
[BASECLASS] commandbutton
[OBJNAME] cmdDeudores
[PARENT] launchform
[START PROPERTIES]
Top = 252
Left = 12
Picture = ..\..\comunes\image\modulos\deudores.ico
Caption = "\<Deudores"
TabIndex = 5
cappname = prCCDeud.exe
nid = 5
Name = "cmdDeudores"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _37X0OBYWM
[CLASS] launchbutton
[CLASSLOC] launcher.vcx
[BASECLASS] commandbutton
[OBJNAME] cmdStock
[PARENT] launchform
[START PROPERTIES]
Top = 132
Left = 372
Picture = ..\..\comunes\image\modulos\stock.ico
Caption = "S\<tock"
TabIndex = 9
cappname = prGesSto.exe
nid = 9
Name = "cmdStock"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2UG135NXI
[CLASS] launchbutton
[CLASSLOC] launcher.vcx
[BASECLASS] commandbutton
[OBJNAME] cmdValores
[PARENT] launchform
[START PROPERTIES]
Top = 252
Left = 372
Picture = ..\..\comunes\image\modulos\valores.ico
Caption = "\<Valores"
TabIndex = 11
cappname = prGesVal.exe
nid = 11
Name = "cmdValores"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2UG135NY6
[CLASS] launchbutton
[CLASSLOC] launcher.vcx
[BASECLASS] commandbutton
[OBJNAME] cmdCompras
[PARENT] launchform
[START PROPERTIES]
Top = 132
Left = 12
Picture = ..\..\comunes\image\modulos\compras.ico
Caption = "Com\<pras"
TabIndex = 3
cappname = prGesCom.exe
nid = 3
Name = "cmdCompras"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2UG135NYR
[CLASS] launchbutton
[CLASSLOC] launcher.vcx
[BASECLASS] commandbutton
[OBJNAME] cmdAcreedores
[PARENT] launchform
[START PROPERTIES]
Top = 12
Left = 12
Picture = ..\..\comunes\image\modulos\acreedores.ico
Caption = "\<Acreedores"
TabIndex = 1
cappname = prCCAcre.exe
nid = 1
Name = "cmdAcreedores"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2UG135NZM
[CLASS] launchbutton
[CLASSLOC] launcher.vcx
[BASECLASS] commandbutton
[OBJNAME] cmdUtiles
[PARENT] launchform
[START PROPERTIES]
Top = 192
Left = 372
Picture = ..\..\comunes\image\modulos\utiles.ico
Caption = "\<Utiles"
TabIndex = 10
cappname = prUtiles.exe
nid = 10
Name = "cmdUtiles"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2X10OSRID
[CLASS] launchbutton
[CLASSLOC] launcher.vcx
[BASECLASS] commandbutton
[OBJNAME] cmdArchivos
[PARENT] launchform
[START PROPERTIES]
Top = 72
Left = 12
Picture = ..\..\comunes\image\modulos\archivos.ico
Caption = "A\<rchivos"
TabIndex = 2
cappname = prTraArc.exe
nid = 2
Name = "cmdArchivos"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] RESERVED  
[CLASS] launchbutton
[CLASSLOC] launcher.vcx
[BASECLASS] commandbutton
[OBJNAME] cmdEstadisticas
[PARENT] launchform
[START PROPERTIES]
Top = 312
Left = 12
Picture = ..\..\comunes\image\modulos\estadisticas.ico
Caption = "\<Estadisticas"
TabIndex = 6
cappname = prEstadi.exe
nid = 6
Name = "cmdEstadisticas"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3ZO0L9KYC
[CLASS] launchbutton
[CLASSLOC] launcher.vcx
[BASECLASS] commandbutton
[OBJNAME] cmdHasar
[PARENT] launchform
[START PROPERTIES]
Top = 12
Left = 372
Picture = ..\..\comunes\image\modulos\hasar.ico
Caption = "\<Hasar"
TabIndex = 7
cappname = Hasar.exe
nid = 7
Name = "cmdHasar"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _3ZO0L9KYO
[CLASS] launchbutton
[CLASSLOC] launcher.vcx
[BASECLASS] commandbutton
[OBJNAME] cmdSiap
[PARENT] launchform
[START PROPERTIES]
Top = 72
Left = 372
Picture = ..\..\comunes\image\modulos\siap.ico
Caption = "\<Siap"
TabIndex = 8
cappname = prSiap.exe
nid = 8
Name = "cmdSiap"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _47X0ZGJRI
[CLASS] launchbutton
[CLASSLOC] launcher.vcx
[BASECLASS] commandbutton
[OBJNAME] cmdPedidos
[PARENT] launchform
[START PROPERTIES]
Top = 371
Left = 372
Picture = ..\..\comunes\image\modulos\pedidos.ico
Caption = "Ped\<idos"
TabIndex = 12
TabStop = .T.
cappname = prPedido.exe
nid = 14
Name = "cmdPedidos"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _47X0ZGJRS
[CLASS] launchbutton
[CLASSLOC] launcher.vcx
[BASECLASS] commandbutton
[OBJNAME] cmdCajas
[PARENT] launchform
[START PROPERTIES]
Top = 371
Left = 12
Picture = ..\..\comunes\image\modulos\estadisticas.ico
Caption = "\<Caja"
TabIndex = 6
cappname = Caja.exe
nid = 13
Name = "cmdCajas"
[END PROPERTIES]

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] RESERVED  
[OBJNAME] launchform
[START PROPERTIES]
Arial, 0, 9, 5, 15, 12, 32, 3, 0
Arial, 1, 12, 8, 20, 15, 42, 4, 1
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _37X0OAOV9
[CLASS] launcher
[CLASSLOC] launcher.vcx
[BASECLASS] form
[OBJNAME] launchboard
[START PROPERTIES]
DoCreate = .T.
Name = "launchboard"
imgLogo.Name = "imgLogo"
Label1.Name = "Label1"
Label2.Name = "Label2"
cmdCancel.Name = "cmdCancel"
[END PROPERTIES]
[START RESERVED1]
Class[END RESERVED1]
[START RESERVED2]
1[END RESERVED2]
[START RESERVED6]
Pixels[END RESERVED6]

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] RESERVED  
[OBJNAME] launchboard
[START PROPERTIES]
Arial, 0, 9, 5, 15, 12, 32, 3, 0
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _37X0OBYWM
[CLASS] launchbutton
[CLASSLOC] launcher.vcx
[BASECLASS] commandbutton
[OBJNAME] launchboardbutton
[START PROPERTIES]
nrecno = 0
_memberdata = <VFPData><memberdata name="nrecno" display="nRecno"/></VFPData>
Name = "launchboardbutton"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
NoDefault

ENDPROC
PROCEDURE Init
DoDefault()

ENDPROC
PROCEDURE ccurrentdirectory_access
Return DoDefault()
ENDPROC
PROCEDURE cwindowstittle_access
Return DoDefault()
ENDPROC
PROCEDURE nnivel_assign
lparameters tnNivel

DoDefault( tnNivel )
ENDPROC
PROCEDURE setnivel
Lparameters tnNivel As Integer

DoDefault( tnNivel )
ENDPROC
[END METHODS]
[START RESERVED1]
Class[END RESERVED1]
[START RESERVED2]
1[END RESERVED2]
[START RESERVED3]
nrecno
[END RESERVED3]
[START RESERVED6]
Pixels[END RESERVED6]

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] RESERVED  
[OBJNAME] launchboardbutton
[START PROPERTIES]
Arial, 1, 12, 8, 20, 15, 42, 4, 1
[END PROPERTIES]
[EOF]
