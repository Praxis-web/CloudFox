SCCTEXT Version 4.0.0.2
PLATFORM C(8,0),UNIQUEID C(10,0),TIMESTAMP N(10,0),CLASS M(4,0),CLASSLOC M(4,0),BASECLASS M(4,0),OBJNAME M(4,0),PARENT M(4,0),PROPERTIES M(4,0),PROTECTED M(4,0),METHODS M(4,0),OBJCODE M(4,0),OLE M(4,0),OLE2 M(4,0),RESERVED1 M(4,0),RESERVED2 M(4,0),RESERVED3 M(4,0),RESERVED4 M(4,0),RESERVED5 M(4,0),RESERVED6 M(4,0),RESERVED7 M(4,0),RESERVED8 M(4,0),USER M(4,0)
1252

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] Screen    
[START RESERVED1]
VERSION =   3.00[END RESERVED1]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2SX0TWJXS
[CLASS] dataenvironment
[BASECLASS] dataenvironment
[OBJNAME] Dataenvironment
[START PROPERTIES]
Top = 0
Left = 0
Width = 0
Height = 0
DataSource = .NULL.
Name = "Dataenvironment"
[END PROPERTIES]
[START RESERVED2]
1[END RESERVED2]
[START RESERVED4]
1[END RESERVED4]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2SX0TWJXT
[CLASS] form
[BASECLASS] form
[OBJNAME] frmachoice
[START PROPERTIES]
BorderStyle = 2
Height = 175
Width = 169
DoCreate = .T.
Caption = "Seleccione Una Opcion"
ControlBox = .F.
Closable = .F.
FontBold = .F.
FontItalic = .F.
FontName = "Arial"
FontSize = 9
MaxButton = .F.
MinButton = .F.
KeyPreview = .T.
TitleBar = 0
WindowType = 1
AlwaysOnTop = .T.
nitem = 0
_memberdata =      653<VFPData><memberdata name="nitem" display="nItem"/><memberdata name="ocolitems" display="oColItems"/><memberdata name="aitems" display="aItems"/><memberdata name="fontname" display="FontName"/><memberdata name="fontname_assign" display="FontName_Assign"/><memberdata name="fontsize" display="FontSize"/><memberdata name="fontsize_assign" display="FontSize_Assign"/><memberdata name="fontbold" display="FontBold"/><memberdata name="fontbold_assign" display="FontBold_Assign"/><memberdata name="fontitalic" display="FontItalic"/><memberdata name="fontitalic_assign" display="FontItalic_Assign"/><memberdata name="nselected" display="nSelected"/></VFPData>
ocolitems = .NULL.
nselected = 0
Name = "frmachoice"
[END PROPERTIES]
[START METHODS]
PROCEDURE Init
Lparameters taArray, toParam As Object, tnCol As Integer

Local lnLen As Integer,;
	lnLengh As Integer,;
	lnWidth As Integer,;
	i As Integer,;
	lnOrder As Integer,;
	lnSelected As Integer

Local loColItems As Collection
Local loItem As Object


Try

	Thisform.Top = toParam.nTop
	Thisform.Left = toParam.nLeft

	If Vartype( tnCol ) # "N"
		tnCol = 0
	Endif

	lnSelected = 0

	Inkey()

	If !Pemstatus( toParam, "oColItems", 5 )
		loColItems = Createobject( "Collection" )

		lnLen = Alen( taArray, 1 )

		For i = 1 To lnLen
			loItem = Createobject( "Empty" )

			If Empty( tnCol )
				AddProperty( loItem, "Caption", taArray[ i ] )

			Else
				AddProperty( loItem, "Caption", taArray[ i, tnCol ] )

			Endif

			AddProperty( loItem, "Id", i )
			AddProperty( loItem, "Visible", .T. )
			AddProperty( loItem, "Order", i )

			*!*				loColItems.Add( loItem, loItem.Id )
			loColItems.Add( loItem, Transform( i ) )

			loItem = Null
		Endfor

	Else
		* RA 2013-08-05(10:51:17)
		* Si se manda la colección, debe venir validada
		loColItems = toParam.oColItems

	Endif

	Thisform.oColItems = loColItems

	Local loColAux As Collection
	loColAux = Createobject( "Collection" )

	lnLen = 0
	For i = 1 To loColItems.Count
		loItem = loColItems.Item( i )

		If loItem.Visible
			lnLen = lnLen + 1
			loColAux.Add( loItem )
		Endif
	Endfor

	Local Array laItems[ lnLen ], laItem_Id[ lnLen ]

	lnOrder = 0

	For i = 1 To lnLen
		loItem = loColAux.Item( i )
		laItems[ i ] = loItem.Caption
		laItem_Id[ i ] = loItem.Id
	Endfor

	Thisform.lstItems.BoundColumn = 2
	Thisform.lstItems.BoundTo = .T.
	Thisform.lstItems.ColumnCount = 1

	Thisform.lstItems.RowSourceType = 0
	Thisform.lstItems.RowSource = ""

	*	lnLen = Alen( taArray )
	lnLengh = 0
	lnWidth = 0


	For i = 1 To lnLen
		Thisform.lstItems.AddItem( laItems[ i ] )
		Thisform.lstItems.List( Thisform.lstItems.NewIndex, 2 ) = Transform( laItem_Id[ i ] )

		lnLengh = Max( lnLengh, Len( laItems[ i ] ))
		lnWidth = Max( lnWidth, Thisform.TextWidth( laItems[ i ] ))
	Endfor

	Thisform.lstItems.Width = lnWidth

	lnSelected = 0
	For i = 1 To lnLen
		If Transform( laItem_Id[ i ] ) == Transform( toParam.nSelected )
			lnSelected = i
		Endif
	Endfor

	Thisform.lstItems.ListItemId = lnSelected
	Thisform.nSelected = lnSelected

	*!*		If Type( "toParam.nSelected" ) = "N"
	*!*			lnSelected = 0
	*!*			For i = 1 To lnLen
	*!*				If laItem_Id[ i ] = toParam.nSelected
	*!*					lnSelected = i
	*!*				EndIf
	*!*			Endfor

	*!*			Thisform.lstItems.ListItemId = lnSelected
	*!*			Thisform.nSelected = lnSelected
	*!*		Endif

	Thisform.lstItems.Width =  Thisform.lstItems.Width + 20
	Thisform.lstItems.Height = ( ( Min( lnLen, 20 ) + 1 ) * Fontmetric( 1, Thisform.lstItems.FontName, Thisform.lstItems.FontSize ) ) + Iif( Thisform.TitleBar = 1, 50, 30 )

	Thisform.Width = Thisform.lstItems.Width
	Thisform.Height = Thisform.lstItems.Height


	Local laMembers[ 1 ] As String
	Local lcProperty As String
	If Vartype( toParam ) == "O"
		Amembers( laMembers, toParam )

		For Each lcProperty In laMembers
			Try
				This.&lcProperty = toParam.&lcProperty

			Catch To oErr
				* No hago nada
			Finally

			Endtry
		Endfor

	Endif

	If Thisform.TitleBar = 1
		Thisform.Width = Max( Thisform.Width, Max( Thisform.TextWidth( Replicate( "W", Len( Thisform.Caption ))), Thisform.lstItems.Width ))
		*lnLengh = Max( lnLengh, Len( Thisform.Caption ))
	Endif

	Thisform.lstItems.Width = Thisform.Width

	If toParam.nTop < 0 Or toParam.nLeft < 0
		Thisform.AutoCenter = .T.

		If toParam.nTop >= 0
			Thisform.Top = toParam.nTop
		Endif

		If toParam.nLeft >= 0
			Thisform.Left = toParam.nLeft
		Endif

	Endif

	Thisform.Visible = .T.

Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"

	loError = Newobject( "ErrorHandler", "Tools\ErrorHandler\Prg\ErrorHandler.prg" )
	loError.Process( oErr )

Finally

Endtry


ENDPROC
PROCEDURE KeyPress
Lparameters nKeyCode, nShiftAltCtrl

#INCLUDE "FW\Comunes\Include\Praxis.h"

Do Case
	Case nKeyCode = KEY_ESCAPE
		Thisform.nItem = 0
		_Screen.oApp.nKeyCode = nKeyCode
		Thisform.Release()

	Case nKeyCode = KEY_ENTER
*!*			If !Empty( Thisform.lstItems.ListItemId )
*!*				Thisform.nItem = Thisform.lstItems.ListItemId
*!*				
*!*			Else
*!*				Thisform.nItem = Thisform.nSelected
*!*				
*!*			EndIf
*!*			
*!*			Set Step On
		
		Thisform.nItem = Val( Transform( Thisform.lstItems.Value ))

		If !Empty( Thisform.nSelected ) Or !Empty( Thisform.nItem )
			_Screen.oApp.nKeyCode = nKeyCode
			Thisform.Release()
		EndIf		

	Case nKeyCode = KEY_FLECHA_IZQUIERDA
		If !Empty( Thisform.lstItems.ListItemId )
			Thisform.nItem = Thisform.lstItems.ListItemId
			
		Else
			Thisform.nItem = Thisform.nSelected
			
		EndIf
		
		_Screen.oApp.nKeyCode = KEY_FLECHA_ARRIBA
		Thisform.Release()

	Otherwise

Endcase

ENDPROC
PROCEDURE Load
Thisform.Hide()
ENDPROC
PROCEDURE Unload

Local lcCommand As String
Local lnItem As Integer,;
	i As Integer

Local loColItems As Collection
Local loItem As Object

Try

	lcCommand = ""
	lnItem = Thisform.nItem
*!*		loColItems = Thisform.oColItems

*!*		* RA 2013-08-05(10:54:33)
*!*		* nItem trae el valor de loItem.Order
*!*		* hay que devolver el subindice de la coleccion
*!*		For i = 1 To loColItems.Count
*!*			loItem = loColItems.Item( i )

*!*			If loItem.Order = lnItem
*!*				Thisform.nItem = loItem.Id
*!*			Endif
*!*		EndFor
	
Catch To oErr
	Local loError As ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	loError = Newobject( "ErrorHandler", "Tools\ErrorHandler\Prg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )

Finally


Endtry

Return This.nItem

ENDPROCPROCEDURE fontbold_assign
lparameters tFontBold
This.FontBold = tFontBold
ThisForm.lstItems.FontBold = tFontBold
ENDPROC
PROCEDURE fontitalic_assign
lparameters tFontItalic
This.FontItalic = tFontItalic
ThisForm.lstItems.FontItalic = tFontItalic
ENDPROC
PROCEDURE fontname_assign
lparameters tFontName
This.FontName = tFontName
ThisForm.lstItems.FontName = tFontName
ENDPROC
PROCEDURE fontsize_assign
lparameters tFontSize
This.FontSize = tFontSize
ThisForm.lstItems.FontSize = tFontSize
ENDPROC
[END METHODS]
[START RESERVED3]
nitem
_memberdata XML Metadata for customizable properties
ocolitems
nselected Valor inicial del ListBox
^aitems[1,1] 
*fontname_assign 
*fontsize_assign 
*fontbold_assign 
*fontitalic_assign 
[END RESERVED3]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2SX0WPVNP
[CLASS] listbox
[BASECLASS] listbox
[OBJNAME] lstItems
[PARENT] frmachoice
[START PROPERTIES]
Anchor = 15
BoundColumn = 2
Height = 170
Left = 0
Top = 0
Width = 168
IntegralHeight = .T.
ItemTips = .T.
BoundTo = .T.
AutoHideScrollbar = 1
Name = "lstItems"
[END PROPERTIES]
[START METHODS]
PROCEDURE DblClick
*!*	Thisform.nItem = Thisform.lstItems.ListItemId
Thisform.nItem = Val( Transform( Thisform.lstItems.Value ))
Thisform.Release()


ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] RESERVED  
[START PROPERTIES]
Arial, 0, 9, 5, 15, 12, 32, 3, 0
[END PROPERTIES]
[START RESERVED1]
 ! ..\..\fw\comunes\include\praxis.h†Ós~\V! ..\..\fw\comunes\include\foxpro.hŽÔÊrûF" ..\..\fw\comunes\include\strings.h–ÕZŠOJ' ..\..\tools\namespaces\include\system.hžÖ±ÙF[END RESERVED1]
[EOF]
