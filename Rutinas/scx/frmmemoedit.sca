SCCTEXT Version 4.0.0.2
PLATFORM C(8,0),UNIQUEID C(10,0),TIMESTAMP N(10,0),CLASS M(4,0),CLASSLOC M(4,0),BASECLASS M(4,0),OBJNAME M(4,0),PARENT M(4,0),PROPERTIES M(4,0),PROTECTED M(4,0),METHODS M(4,0),OBJCODE M(4,0),OLE M(4,0),OLE2 M(4,0),RESERVED1 M(4,0),RESERVED2 M(4,0),RESERVED3 M(4,0),RESERVED4 M(4,0),RESERVED5 M(4,0),RESERVED6 M(4,0),RESERVED7 M(4,0),RESERVED8 M(4,0),USER M(4,0)
1252

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] Screen    
[START RESERVED1]
VERSION =   3.00[END RESERVED1]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2TW0PRVYB
[CLASS] dataenvironment
[BASECLASS] dataenvironment
[OBJNAME] Dataenvironment
[START PROPERTIES]
Top = 0
Left = 0
Width = 0
Height = 0
DataSource = .NULL.
Name = "Dataenvironment"
[END PROPERTIES]
[START RESERVED2]
1[END RESERVED2]
[START RESERVED4]
1[END RESERVED4]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2TW0PRVYC
[CLASS] form
[BASECLASS] form
[OBJNAME] FRMMEMOEDIT
[START PROPERTIES]
Top = -1
Left = 0
Height = 276
Width = 710
DoCreate = .T.
Caption = ""
FontName = "Lucida Console"
FontSize = 11
WindowType = 1
_memberdata =      869<VFPData><memberdata name="changefont" display="ChangeFont"/><memberdata name="process" display="Process"/><memberdata name="outputdbf" display="OutputDBF"/><memberdata name="outputexcel" display="OutputExcel"/><memberdata name="outputpreview" display="OutputPreview"/><memberdata name="outputreport" display="OutputReport"/><memberdata name="changecolor" display="ChangeColor"/><memberdata name="outputxml" type="method" display="OutputXML"/><memberdata name="omemoedit" display="oMemoEdit"/><memberdata name="oreturn" display="oReturn"/><memberdata name="outputfrx" display="OutputFRX"/><memberdata name="outputcalc" display="OutputCalc"/><memberdata name="copytoclipboard" display="CopyToClipboard"/><memberdata name="outputtxt" display="OutputTxt"/><memberdata name="calias" display="cAlias"/><memberdata name="coutputfilename" display="cOutputFileName"/></VFPData>
omemoedit = .NULL.
oreturn = .NULL.
calias = 
coutputfilename = 
Name = "FRMMEMOEDIT"
[END PROPERTIES]
[START METHODS]
PROCEDURE Destroy
Try

	If Vartype( Thisform.oMemoEdit ) = "O"

		If Pemstatus( Thisform.oMemoEdit, "oReport", 5 )

			If IsRuntime() And !FileExist( "DoNotDestroyFrx.Tag" )
				If Vartype( Thisform.oMemoEdit.oReport ) = "C"
					lcFrxFullName = Thisform.oMemoEdit.oReport
					If Addbs(Justpath( lcFrxFullName )) = Addbs( DRVC )
						Erase ( lcFrxFullName + ".Frx" )
						Erase ( lcFrxFullName + ".Frt" )
					Endif
				Endif
			Endif

			If Vartype( Thisform.oMemoEdit.oReport ) = "O"
				Thisform.oMemoEdit.oReport.Destroy()
			Endif
			Thisform.oMemoEdit.oReport = Null
		EndIf
		
		Thisform.oMemoEdit = Null
	Endif

Catch To oErr
	Local loError As   Errorhandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"

	loError = Newobject( "  Errorhandler", "Tools\ErrorHandler\Prg\ErrorHandler.prg" )
	loError.Process( oErr )
	Throw loError

Finally

Endtry

ENDPROCPROCEDURE Init
Lparameters toMemoEdit As Object, tcAlias As String, tcFileName As String

Local lcText As String
Local llCanEdit As Boolean
Local loReturnObject As Object
Local llOk As Boolean
Local locboOutput As ComboBox
Local lcFrxFullName As String,;
	lcCommand As String

Try

	llOk = .T.
	lcCommand = ""

	This.oMemoEdit = toMemoEdit
	This.cAlias = IfEmpty( tcAlias, "cReporte" )
	This.cOutputFileName = Proper( IfEmpty( tcFileName, DateMask( " MM yyyy" ) ) )

	If Vartype( toMemoEdit.oReport ) = "C"
		lcFrxFullName 	= Addbs( toMemoEdit.cFrxFolder ) + toMemoEdit.oReport + ".Frx"

	Else
		lcFrxFullName 	= Addbs( DRVC ) + toMemoEdit.cFrxName + ".Frx"

	Endif

	loReturnObject = Createobject( "Empty" )

	AddProperty( loReturnObject, "nBoton", 0 )
	AddProperty( loReturnObject, "cText", "" )

	Thisform.oReturn = loReturnObject

	Thisform.AutoCenter = .T.

	Thisform.Edit1.Value = Thisform.oMemoEdit.cArch
	Thisform.Edit1.ReadOnly = !Thisform.oMemoEdit.lCanEdit

	If toMemoEdit.lLaunchFrx
		Thisform.Edit1.FontName	= "Lucida Console"
		Thisform.Edit1.FontSize = 8
		Thisform.MinHeight 		= 200
		Thisform.MinWidth 		= 650

	Else
		Thisform.Edit1.FontName 	= _Screen.oApp.FontName
		Thisform.Edit1.FontSize 	= _Screen.oApp.FontSize
		Thisform.cmdFont.Visible 	= .F.
		Thisform.cboOutput.Visible 	= .F.
		Thisform.Label1.Visible 	= .F.
		Thisform.cmdColor.Visible 	= .F.

	Endif

	locboOutput = Thisform.cboOutput

	locboOutput.AddItem( "" )

	If Vartype( toMemoEdit.oReport ) = "O"  Or  FileExist( lcFrxFullName )
		locboOutput.AddItem( "Vista Previa" )
		locboOutput.AddItem( "Impresora Predeterminada" )
		locboOutput.AddItem( "Seleccionar Impresora" )
	Endif

	locboOutput.AddItem( "Txt" )
	locboOutput.AddItem( "Excel" )
	locboOutput.AddItem( "Calc" )
	locboOutput.AddItem( "Dbf" )
	locboOutput.AddItem( "Xml" )
	locboOutput.AddItem( "Copiar al Portapapeles" )


	If PemStatus( This.oMemoEdit, "oAction", 5 ) And !Empty( This.oMemoEdit.oAction.Method )

		If !Empty( This.oMemoEdit.oAction.Parameters )
			TEXT To lcCommand NoShow TextMerge Pretext 15
			Thisform.<<This.oMemoEdit.oAction.Method>>( <<This.oMemoEdit.oAction.Parameters>> )
			ENDTEXT

		Else
			TEXT To lcCommand NoShow TextMerge Pretext 15
			Thisform.OutputFrx( )
			ENDTEXT

		Endif

		&lcCommand

	Endif

Catch To oErr
	Local loError As   ErrorHandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"
	llOk = .F.
	loError = Newobject( "  ErrorHandler", "Tools\ErrorHandler\Prg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )

Finally
	loReturnObject = Null
	toMemoEdit = Null
	locboOutput = Null

Endtry

Return llOk

ENDPROC
PROCEDURE KeyPress
Lparameters nKeyCode, nShiftAltCtrl

Do Case
	Case nKeyCode = 27
		Thisform.oReturn.nBoton = 2
		Thisform.Release()

	Case nKeyCode = 13
		Thisform.oReturn.nBoton = 1
		Thisform.oReturn.cText = Thisform.Edit1.Value
		Thisform.Release()

	Otherwise

Endcase

ENDPROC
PROCEDURE Unload
Try

	If Vartype( Thisform.oMemoEdit ) = "O"

		If Pemstatus( Thisform.oMemoEdit, "oReport", 5 )

			If IsRuntime()
				If Vartype( Thisform.oMemoEdit.oReport ) = "C"
					lcFrxFullName = Thisform.oMemoEdit.oReport
					If Addbs(Justpath( lcFrxFullName )) = Addbs( DRVC )
						Erase ( lcFrxFullName + ".Frx" )
						Erase ( lcFrxFullName + ".Frt" )
					Endif
				Endif
			Endif

			If Vartype( Thisform.oMemoEdit.oReport ) = "O"
				Thisform.oMemoEdit.oReport.Destroy()
			Endif
			Thisform.oMemoEdit.oReport = Null
		EndIf
		
		Thisform.oMemoEdit = Null
	Endif

Catch To oErr
	Local loError As   Errorhandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"

	loError = Newobject( "  Errorhandler", "Tools\ErrorHandler\Prg\ErrorHandler.prg" )
	loError.Process( oErr )
	Throw loError

Finally

Endtry

Return Thisform.oReturn

ENDPROC
PROCEDURE changecolor
Local lnColor As Integer

Try

	lnColor = Getcolor( Thisform.Edit1.ForeColor )

	If lnColor > 0
		Thisform.Edit1.ForeColor = lnColor
	Endif


Catch To oErr
	Local loError As   Errorhandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"

	loError = Newobject( "  Errorhandler", "Tools\ErrorHandler\Prg\ErrorHandler.prg" )
	loError.Process( oErr )
	Throw loError

Finally

Endtry

ENDPROC
PROCEDURE changefont
Local lcFontName As String
Local lnFontSize as Integer
Local lcFontStyle As String
Local lnFontCharSet as Integer
Local lcFontLayout  As String

Try


	lcFontName 		= ThisForm.Edit1.FontName
	lnFontSize 		= ThisForm.Edit1.FontSize
	lcFontStyle 	= Iif( ThisForm.Edit1.FontBold, "B", "" ) + Iif( ThisForm.Edit1.FontBold, "I", "" )
*!*		lnFontCharSet 	= ThisForm.Edit1.FontCharSet


	lcFontLayout = Getfont( lcFontName, lnFontSize, lcFontStyle )

	If !Empty( lcFontLayout )
		lcFontName 		= Getwordnum( lcFontLayout, 1, "," )
		lnFontSize 		= Int( Val( Getwordnum( lcFontLayout, 2, "," )))
		lcFontStyle 	= Getwordnum( lcFontLayout, 3, "," )
*!*			lnFontCharSet 	= Int( Val( Getwordnum( lcFontLayout, 1, "," )))

		ThisForm.Edit1.FontName = lcFontName
		ThisForm.Edit1.FontSize = lnFontSize
*!*			ThisForm.Edit1.FontCharSet = lnFontCharSet
		ThisForm.Edit1.FontBold = "B"$lcFontStyle
		ThisForm.Edit1.FontItalic = "I"$lcFontStyle
		
	Endif


Catch To oErr
	Local loError As   Errorhandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"

	loError = Newobject( "  Errorhandler", "Tools\ErrorHandler\Prg\ErrorHandler.prg" )
	loError.Process( oErr )
	Throw loError

Finally

Endtry

ENDPROC
PROCEDURE copytoclipboard
Try

	_Cliptext = ThisForm.Edit1.Value
	
	Inform( "Copiado al Portapapeles" )

Catch To oErr
	Local loError as   Errorhandler OF "Tools\ErrorHandler\Prg\ErrorHandler.prg"

	loError = NewObject( "  Errorhandler", "Tools\ErrorHandler\Prg\ErrorHandler.prg" )
	loError.Process( oErr )
	Throw loError

Finally

EndTry

ENDPROC
PROCEDURE outputcalc
#INCLUDE "FW\Comunes\Include\Excel.h"

#Define TITLEFONT_COLOR	-8566497
#Define TITLEFONT_NAME	"Cambria"
#Define TITLEFONT_SIZE	18
#Define OFFICE_2007 	"12.0"

Local lcFileName As String
Local loExcel As "Excel.application"
Local i As Integer
Local lcDec As String
Local lnColumns As Integer
Local lnRows As Integer
Local lcHeader as String

Try

	If Used( Alias( This.cAlias ))
		Dbf2Calc( This.cAlias )
		
	Else
		Warning( "No Existe el Cursor " + This.cAlias )

	Endif


Catch To oErr
	Local loError As   Errorhandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"

	loError = Newobject( "  Errorhandler", "Tools\ErrorHandler\Prg\ErrorHandler.prg" )
	loError.Process( oErr )
	Throw loError

Finally
	loExcel = Null

Endtry

ENDPROC
PROCEDURE outputdbf
Local lcFileName As String
Local lcTitulo As String

Try

	If Used( Alias( This.cAlias ))

		lcFileName = Putfile( "", This.cOutputFileName, "DBF" )

		If !Empty( lcFileName )
			If Used( "cGlobal" )
				lcTitulo = Addbs( Justpath( lcFileName ) )
				lcTitulo = lcTitulo + Juststem( lcFileName ) + "_Titulo."
				lcTitulo = lcTitulo + Justext( lcFileName )
				
				Select cGlobal
				Copy To ( lcTitulo )
			Endif

			Select Alias( This.cAlias )
			Copy To ( lcFileName )

			Use ( lcFileName ) In 0
			Browse

		Endif

	Else
		Warning( "No Existe el Cursor " + This.cAlias )

	Endif


Catch To oErr
	Local loError As   Errorhandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"

	loError = Newobject( "  Errorhandler", "Tools\ErrorHandler\Prg\ErrorHandler.prg" )
	loError.Process( oErr )
	Throw loError

Finally
	If !Empty( lcFileName )
		Use In Select( Juststem( lcFileName ))
	Endif

Endtry

ENDPROC
PROCEDURE outputexcel
#INCLUDE "FW\Comunes\Include\Excel.h"

#Define TITLEFONT_COLOR	-8566497
#Define TITLEFONT_NAME	"Cambria"
#Define TITLEFONT_SIZE	18
#Define OFFICE_2007 	"12.0"

Local lcFileName As String
Local loExcel As "Excel.application"
Local i As Integer
Local lcDec As String
Local lnColumns As Integer
Local lnRows As Integer
Local lcHeader As String

Try

	If Used( Alias( This.cAlias ))

		Output2Xls( This.cAlias, This.cOutputFileName )

		*!*			lcFileName = Putfile( "", This.cOutputFileName, "XLS" )

		*!*			If !Empty( lcFileName )


		*!*				Select Alias( This.cAlias )
		*!*				Copy To ( lcFileName ) Type Xl5

		*!*				Wait Window "Abriendo Excel" Nowait
		*!*				loExcel = Createobject("Excel.application")

		*!*				If Vartype( loExcel ) = "O"
		*!*					loExcel.Visible = .F.

		*!*					Wait Window "Abriendo " + lcFileName  Nowait
		*!*					loExcel.Workbooks.Open( lcFileName )

		*!*					Try

		*!*						* Formatear Font

		*!*						loExcel.Cells.Select

		*!*						loExcel.Selection.Font.Bold = Thisform.Edit1.FontBold
		*!*						loExcel.Selection.Font.Italic = Thisform.Edit1.FontItalic

		*!*						With loExcel.Selection.Font
		*!*							.Color = Thisform.Edit1.ForeColor
		*!*							.Name = Thisform.Edit1.FontName
		*!*							.Size = Thisform.Edit1.FontSize

		*!*							If loExcel.Version = OFFICE_2007
		*!*								.TintAndShade = 0
		*!*							Endif

		*!*						Endwith

		*!*						lnColumns = Afields( laFields, This.cAlias )
		*!*						lnRows = Reccount( This.cAlias ) + 1

		*!*						For i = 1 To lnColumns
		*!*							loExcel.Columns( xlsCols( i, i ) ).Select

		*!*							Do Case
		*!*							Case Inlist( laFields[ i, 2 ], "D", "T" )
		*!*								*loExcel.Selection.NumberFormat = "yyyy-mm-dd;@"
		*!*								loExcel.Selection.NumberFormat = "dd-mm-yyyy;@"

		*!*							Case Inlist( laFields[ i, 2 ], "Y", "I", "N" )
		*!*								If Empty( laFields[ i, 4 ] )
		*!*									loExcel.Selection.NumberFormat = "#,##0_ ;[Red]-#,##0 "

		*!*								Else
		*!*									lcDec = Replicate( "0", laFields[ i, 4 ] )

		*!*									TEXT To lcCommand NoShow TextMerge Pretext 15
		*!*										loExcel.Selection.NumberFormat = "#,##0.<<lcDec>>_ ;[Red]-#,##0.<<lcDec>> "
		*!*									ENDTEXT

		*!*									&lcCommand

		*!*								Endif

		*!*							Otherwise

		*!*							Endcase

		*!*							loExcel.Range( xlsColumn( i ) + "1").Select
		*!*
		*!*							lcHeader = Proper( Strtran( laFields[ i, 1 ], "_", " " ))
		*!*							loExcel.ActiveCell.FormulaR1C1 = lcHeader
		*!*	*!*							loExcel.ActiveCell.FormulaR1C1 = Proper( laFields[ i, 1 ])
		*!*						Endfor


		*!*						* Formatear Titulo
		*!*						Wait Window "Formatear Titulo" Nowait

		*!*						loExcel.Rows("1:1").Select
		*!*						loExcel.Selection.Font.Bold = True
		*!*						With loExcel.Selection.Font
		*!*							.Color = TITLEFONT_COLOR
		*!*							.Name = TITLEFONT_NAME
		*!*							.Size = TITLEFONT_SIZE

		*!*							If loExcel.Version = OFFICE_2007
		*!*								.TintAndShade = 0
		*!*							Endif

		*!*						Endwith


		*!*						* Seleccionar las columnas de la primer fila
		*!*						loExcel.Range( xlsColumn( 1 ) + "1:" + xlsColumn( lnColumns ) + "1").Select
		*!*						With loExcel.Selection.Interior
		*!*							.Pattern = xlSolid
		*!*							.PatternColorIndex = xlAutomatic


		*!*							If loExcel.Version = OFFICE_2007
		*!*								.TintAndShade = -4.99893185216834E-02
		*!*								.ThemeColor = xlThemeColorDark1
		*!*								.PatternTintAndShade = 0
		*!*							Endif

		*!*						Endwith

		*!*						With loExcel.Selection.BorderS(xlEdgeBottom)
		*!*							.LineStyle = xlContinuous
		*!*							.ColorIndex = 0
		*!*							.Weight = xlThick

		*!*							If loExcel.Version = OFFICE_2007
		*!*								.TintAndShade = 0
		*!*							Endif

		*!*						Endwith

		*!*						* Marcar las líneas verticales y la de abajo

		*!*						loExcel.Range( xlsColumn( 1 ) + "1:" + xlsColumn( lnColumns ) + Transform( lnRows ) ).Select

		*!*						With loExcel.Selection.BorderS(xlEdgeLeft)
		*!*							.LineStyle = xlContinuous
		*!*							.ColorIndex = xlAutomatic
		*!*							.Weight = xlThin

		*!*							If loExcel.Version = OFFICE_2007
		*!*								.TintAndShade = 0
		*!*							Endif

		*!*						Endwith
		*!*						With loExcel.Selection.BorderS(xlEdgeRight)
		*!*							.LineStyle = xlContinuous
		*!*							.ColorIndex = xlAutomatic
		*!*							.Weight = xlThin

		*!*							If loExcel.Version = OFFICE_2007
		*!*								.TintAndShade = 0
		*!*							Endif

		*!*						Endwith
		*!*						With loExcel.Selection.BorderS(xlInsideVertical)
		*!*							.LineStyle = xlContinuous
		*!*							.ColorIndex = xlAutomatic
		*!*							.Weight = xlThin

		*!*							If loExcel.Version = OFFICE_2007
		*!*								.TintAndShade = 0
		*!*							Endif

		*!*						Endwith


		*!*						loExcel.Range( xlsColumn( 1 ) + Transform( lnRows ) + ":" + xlsColumn( lnColumns ) + Transform( lnRows ) ).Select
		*!*						With loExcel.Selection.BorderS(xlEdgeBottom)
		*!*							.LineStyle = xlContinuous
		*!*							.ColorIndex = xlAutomatic
		*!*							.Weight = xlThin

		*!*							If loExcel.Version = OFFICE_2007
		*!*								.TintAndShade = 0
		*!*							Endif

		*!*						Endwith


		*!*						* Color de Fondo
		*!*						loExcel.Range( xlsColumn( 1 ) + "2:" + xlsColumn( lnColumns ) + Transform( lnRows ) ).Select
		*!*						With loExcel.Selection.Interior
		*!*							.Pattern = xlSolid
		*!*							.PatternColorIndex = xlAutomatic
		*!*							.Color = Int( Rgb( 235, 255, 255 ))

		*!*							If loExcel.Version = OFFICE_2007
		*!*								.TintAndShade = 0
		*!*								.PatternTintAndShade = 0
		*!*							Endif

		*!*						Endwith

		*!*						With loExcel.ActiveWindow
		*!*							.SplitColumn = 0
		*!*							.SplitRow = 1
		*!*						Endwith
		*!*						loExcel.ActiveWindow.FreezePanes = True

		*!*					Catch To oErr
		*!*						Local loError As PrxErrorHandler Of "fw\ErrorHandler\prxErrorHandler.prg"

		*!*						loError = Newobject( "PrxErrorHandler", "prxErrorHandler.prg" )
		*!*						loError.Remark = "Error al Formatear Excel"
		*!*						loError.lShowError = .F.
		*!*						loError.lLogError = .T.
		*!*						loError.Process( oErr )

		*!*					Finally

		*!*					Endtry

		*!*					* Auto Ajustar Columnas
		*!*					Wait Window "Auto Ajustar Columnas" Nowait

		*!*					loExcel.Cells.Select
		*!*					loExcel.Selection.Columns.AutoFit

		*!*					* Grabar y Mostrar
		*!*					loExcel.Range("A1").Select
		*!*					loExcel.Visible = .T.
		*!*					loExcel.ActiveWorkbook.Save

		*!*					Wait Clear

		*!*				Endif


		*!*			Endif

	Else
		Warning( "No Existe el Cursor " + This.cAlias )

	Endif


Catch To oErr
	Local loError As   Errorhandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"

	loError = Newobject( "  Errorhandler", "Tools\ErrorHandler\Prg\ErrorHandler.prg" )
	loError.Process( oErr )
	Throw loError

Finally
	loExcel = Null

Endtry

ENDPROC
PROCEDURE outputfrx
Lparameters lnOpcion As Integer

#INCLUDE "FW\Comunes\Include\Praxis.h"


*!*	#Define _FRX_PREVIEW			1
*!*	#Define _FRX_PRINTER			2
*!*	#Define _FRX_DEFAULT_PRINTER	3

Local lcFrxName As String
Local lcFrxFolder As String
Local loMemoEdit As Object
Local lcFrxFullName As String
Local lcCommand As String
Local loReport As BaseReport Of "Fw\rb\Common\BaseReport.prg"

Try

	lcPoint= Set("Point" )
	lcSeparator = Set("Separator")
	
	Set Point To [,]
	Set Separator To [.]

	lcCommand 	= ""
	loMemoEdit 	= Thisform.oMemoEdit

	lcFrxName 		= loMemoEdit.cFrxName
	lcFrxFolder 	= loMemoEdit.cFrxFolder
	lcFrxFullName 	= Addbs( lcFrxFolder ) + lcFrxName && + ".Frx"
	loReport 		= loMemoEdit.oReport

*!*		If .T. && ! FileExist( lcFrxFullName + ".Frx" )
*!*			loReport.CreateFrxFile( lcFrxFullName )
*!*		Endif

	Do Case
	Case Vartype( loReport ) == "O"
		lcFrxFolder = DRVC
		lcFrxFullName = Addbs( lcFrxFolder ) + lcFrxName
		loReport.CreateFrxFile( lcFrxFullName )
		Thisform.oMemoEdit.oReport.Destroy()
		loMemoEdit.oReport = lcFrxFullName
		
	Case Vartype( loReport ) == "C"
		lcFrxFullName = Addbs( lcFrxFolder ) + loReport

	Otherwise
		lcFrxFullName = ""
		
	EndCase

	If !Empty( lcFrxFullName )
		Do Case
			Case lnOpcion = _FRX_PREVIEW
				TEXT To lcCommand NoShow TextMerge Pretext 15
				Report Form "<<lcFrxFullName>>" To Printer Prompt Nodialog Preview
				ENDTEXT

			Case lnOpcion = _FRX_PRINTER
				TEXT To lcCommand NoShow TextMerge Pretext 15
				Report Form "<<lcFrxFullName>>" To Printer Prompt Nodialog
				ENDTEXT

			Case lnOpcion = _FRX_DEFAULT_PRINTER
				TEXT To lcCommand NoShow TextMerge Pretext 15
				Report Form "<<lcFrxFullName>>" To Printer Nodialog
				ENDTEXT

			Otherwise
				TEXT To lcCommand NoShow TextMerge Pretext 15
				Error "Opcion No Reconocida"
				ENDTEXT

		Endcase

		Select Alias( This.cAlias )
		Locate

		&lcCommand


	Else
		Warning( "Proceso Cancelado", "Impresion de Informes", 2 )

	Endif


Catch To oErr
	Local loError As   Errorhandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"

	loError = Newobject( "  Errorhandler", "Tools\ErrorHandler\Prg\ErrorHandler.prg" )
	loError.Cremark = lcCommand
	loError.Process( oErr )
	Throw loError

Finally
	loReport = Null
	loMemoEdit = Null
	Set Point To &lcPoint
	Set Separator To &lcSeparator


Endtry

ENDPROC
PROCEDURE outputtxt
Local lcFileName As String
Local lcExt as String

Try

		lcFileName = Putfile( "", This.cOutputFileName, "TXT" )

		If !Empty( lcFileName )
			lcExt = JustExt( lcFileName )
			
			If Empty( lcExt )
				lcFileName = lcFileName + ".txt"
			EndIf
			
			StrToFile( ThisForm.Edit1.Value, lcFileName )

		Endif


Catch To oErr
	Local loError As   Errorhandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"

	loError = Newobject( "  Errorhandler", "Tools\ErrorHandler\Prg\ErrorHandler.prg" )
	loError.Process( oErr )
	Throw loError

Finally

Endtry

ENDPROC
PROCEDURE outputxml
Local lcFileName As String
Local loXA As prxXMLAdapter Of "FW\TierAdapter\Comun\PrxXmlAdapter.prg"
Local lcXML as String

Try

	If Used( Alias( This.cAlias ))

		lcFileName = Putfile( "", This.cOutputFileName, "XML" )

		If !Empty( lcFileName )

			loXA = Newobject("prxXMLAdapter","prxXMLAdapter.prg")

			loXA.AddTableSchema( This.cAlias )

			If Used( "cTitulo" )
				loXA.AddTableSchema( "cTitulo" )
			Endif

			If Used( "cGlobal" )
				loXA.AddTableSchema( "cGlobal" )
			Endif

			loXA.PreserveWhiteSpace = .T.
			loXA.ToXML( lcFileName,"", .T. )

		Endif

	Else
		Warning( "No Existe el Cursor " + This.cAlias )

	Endif


Catch To oErr
	Local loError As   Errorhandler Of "Tools\ErrorHandler\Prg\ErrorHandler.prg"

	loError = Newobject( "  Errorhandler", "Tools\ErrorHandler\Prg\ErrorHandler.prg" )
	loError.Process( oErr )
	Throw loError

Finally
	loXA = Null

Endtry

ENDPROC
PROCEDURE process
#Define _FRX_PREVIEW			1
#Define _FRX_PRINTER			2
#Define _FRX_DEFAULT_PRINTER	3

Local loCbo as ComboBox

Try

	loCbo = ThisForm.cboOutput

	Do Case
	Case ThisForm.oMemoEdit.lLaunchFrx = .F.
		Thisform.Release()
	
	Case loCbo.DisplayValue = "Vista Previa"
		Thisform.OutputFrx( _FRX_PREVIEW )

	Case loCbo.DisplayValue = "Impresora Predeterminada"
		Thisform.OutputFrx( _FRX_DEFAULT_PRINTER )

	Case loCbo.DisplayValue = "Seleccionar Impresora"
		Thisform.OutputFrx( _FRX_PRINTER )
		
	Case loCbo.DisplayValue = "Txt"
		Thisform.OutputTxt()

	Case loCbo.DisplayValue = "Excel"
		Thisform.OutputExcel()
	
	Case loCbo.DisplayValue = "Calc"
		Thisform.OutputCalc()

	Case loCbo.DisplayValue = "Dbf"
		Thisform.OutputDBF()

	Case loCbo.DisplayValue = "Xml"
		Thisform.OutputXML()

	Case loCbo.DisplayValue = "Copiar al Portapapeles" 	
		Thisform.CopyToClipboard()
		
	
	Otherwise
		Warning( "No se seleccionó ninguna opción", "Exportar Informe" )
		
	EndCase

Catch To oErr
	Local loError as   Errorhandler OF "Tools\ErrorHandler\Prg\ErrorHandler.prg"

	loError = NewObject( "  Errorhandler", "Tools\ErrorHandler\Prg\ErrorHandler.prg" )
	loError.Process( oErr )

Finally
*!*		Thisform.Release()
	
EndTry

ENDPROC
[END METHODS]
[START RESERVED3]
_memberdata XML Metadata for customizable properties
omemoedit
oreturn
calias Nombre del cursor asociado al listado
coutputfilename Nombre del archivo de salida
*changefont 
*process 
*outputdbf 
*outputexcel 
*outputpreview 
*outputreport 
*changecolor 
*outputxml 
*outputfrx 
*outputcalc 
*copytoclipboard 
*outputtxt 
[END RESERVED3]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2TW0PRVYD
[CLASS] editbox
[BASECLASS] editbox
[OBJNAME] Edit1
[PARENT] FRMMEMOEDIT
[START PROPERTIES]
Anchor = 15
Height = 216
Left = 12
Top = 12
Width = 684
Name = "Edit1"
[END PROPERTIES]
[START METHODS]
PROCEDURE Init
This.DisabledBackColor = This.BackColor
This.DisabledForeColor = This.ForeColor
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2TW0PRVYE
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] cmdCancelar
[PARENT] FRMMEMOEDIT
[START PROPERTIES]
Top = 237
Left = 14
Height = 27
Width = 84
Anchor = 6
Cancel = .T.
Caption = "Cancelar"
Name = "cmdCancelar"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
Thisform.oReturn.nBoton = 2
Thisform.Release()

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2TW0PRVYF
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] cmdAceptar
[PARENT] FRMMEMOEDIT
[START PROPERTIES]
Top = 237
Left = 612
Height = 27
Width = 84
Anchor = 12
Caption = "Aceptar"
Default = .T.
Name = "cmdAceptar"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
Thisform.oReturn.nBoton = 1
Thisform.oReturn.cText = Thisform.Edit1.Value
Thisform.Process()

ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2TW0PRVYB
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] cmdFont
[PARENT] FRMMEMOEDIT
[START PROPERTIES]
Top = 237
Left = 98
Height = 27
Width = 84
Anchor = 6
Picture = ..\..\fw\comunes\image\bmp\label.bmp
Caption = "Fuente"
PicturePosition = 1
Name = "cmdFont"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
Thisform.ChangeFont()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2XN11F6Z0
[CLASS] combobox
[BASECLASS] combobox
[OBJNAME] cboOutput
[PARENT] FRMMEMOEDIT
[START PROPERTIES]
Anchor = 12
Height = 24
Left = 456
Top = 240
Width = 150
Name = "cboOutput"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2XN11F6Z1
[CLASS] label
[BASECLASS] label
[OBJNAME] Label1
[PARENT] FRMMEMOEDIT
[START PROPERTIES]
AutoSize = .T.
Anchor = 12
BackStyle = 0
Caption = "Seleccione Salida"
Height = 17
Left = 351
Top = 244
Width = 101
Name = "Label1"
[END PROPERTIES]

[ RECORD]
[PLATFORM] WINDOWS 
[UNIQUEID] _2XO0O1CEY
[CLASS] commandbutton
[BASECLASS] commandbutton
[OBJNAME] cmdColor
[PARENT] FRMMEMOEDIT
[START PROPERTIES]
Top = 237
Left = 182
Height = 27
Width = 84
Anchor = 6
Picture = ..\..\fw\comunes\image\bmp\collection.bmp
Caption = "Color"
PicturePosition = 1
Name = "cmdColor"
[END PROPERTIES]
[START METHODS]
PROCEDURE Click
Thisform.ChangeColor()
ENDPROC
[END METHODS]

[ RECORD]
[PLATFORM] COMMENT 
[UNIQUEID] RESERVED  
[START PROPERTIES]
Lucida Console, 0, 11, 9, 15, 12, 9, 3, 0
Arial, 0, 9, 5, 15, 12, 32, 3, 0
[END PROPERTIES]
[START RESERVED1]
   ..\..\fw\comunes\include\excel.hî–ñY9N! ..\..\fw\comunes\include\praxis.hö—s~\V! ..\..\fw\comunes\include\foxpro.hþ˜ÊrûF" ..\..\fw\comunes\include\strings.hšZŠOJ' ..\..\tools\namespaces\include\system.h›±ÙF[END RESERVED1]
[EOF]
